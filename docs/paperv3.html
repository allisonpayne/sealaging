<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Reproduction frequency and offspring survival decline in elephant seals past prime age</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="paperv3_files/libs/clipboard/clipboard.min.js"></script>
<script src="paperv3_files/libs/quarto-html/quarto.js"></script>
<script src="paperv3_files/libs/quarto-html/popper.min.js"></script>
<script src="paperv3_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="paperv3_files/libs/quarto-html/anchor.min.js"></script>
<link href="paperv3_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="paperv3_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="paperv3_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="paperv3_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="paperv3_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a>
  <ul class="collapse">
  <li><a href="#raw-data" id="toc-raw-data" class="nav-link" data-scroll-target="#raw-data">Raw data</a></li>
  <li><a href="#h1-reproductive-senescence" id="toc-h1-reproductive-senescence" class="nav-link" data-scroll-target="#h1-reproductive-senescence">H1: Reproductive senescence</a></li>
  <li><a href="#h2-maternal-effect-senescence" id="toc-h2-maternal-effect-senescence" class="nav-link" data-scroll-target="#h2-maternal-effect-senescence">H2: Maternal effect senescence</a></li>
  <li><a href="#h3-changes-in-pup-sex-ratio-with-increased-maternal-age" id="toc-h3-changes-in-pup-sex-ratio-with-increased-maternal-age" class="nav-link" data-scroll-target="#h3-changes-in-pup-sex-ratio-with-increased-maternal-age">H3: Changes in pup sex ratio with increased maternal age</a></li>
  <li><a href="#h4-phenology" id="toc-h4-phenology" class="nav-link" data-scroll-target="#h4-phenology">H4: Phenology</a></li>
  </ul></li>
  <li><a href="#supplemental-material" id="toc-supplemental-material" class="nav-link" data-scroll-target="#supplemental-material">Supplemental Material</a>
  <ul class="collapse">
  <li><a href="#detailed-model-outputs" id="toc-detailed-model-outputs" class="nav-link" data-scroll-target="#detailed-model-outputs">Detailed model outputs</a>
  <ul class="collapse">
  <li><a href="#h1-reproductive-senescence-1" id="toc-h1-reproductive-senescence-1" class="nav-link" data-scroll-target="#h1-reproductive-senescence-1">H1: Reproductive senescence</a></li>
  <li><a href="#h2-maternal-effect-senescence-1" id="toc-h2-maternal-effect-senescence-1" class="nav-link" data-scroll-target="#h2-maternal-effect-senescence-1">H2: Maternal effect senescence</a></li>
  <li><a href="#h3-offspring-sex-ratio" id="toc-h3-offspring-sex-ratio" class="nav-link" data-scroll-target="#h3-offspring-sex-ratio">H3: Offspring sex ratio</a></li>
  <li><a href="#h4-phenology-1" id="toc-h4-phenology-1" class="nav-link" data-scroll-target="#h4-phenology-1">H4: Phenology</a></li>
  </ul></li>
  <li><a href="#models-sensitivity-to-age-of-senescence" id="toc-models-sensitivity-to-age-of-senescence" class="nav-link" data-scroll-target="#models-sensitivity-to-age-of-senescence">Models’ sensitivity to age of senescence</a></li>
  <li><a href="#selective-appearance-and-disappearance" id="toc-selective-appearance-and-disappearance" class="nav-link" data-scroll-target="#selective-appearance-and-disappearance">Selective appearance and disappearance</a></li>
  <li><a href="#chronological-versus-biological-age" id="toc-chronological-versus-biological-age" class="nav-link" data-scroll-target="#chronological-versus-biological-age">Chronological versus biological age</a></li>
  <li><a href="#detection-frequency" id="toc-detection-frequency" class="nav-link" data-scroll-target="#detection-frequency">Detection frequency</a></li>
  <li><a href="#breakpoint-vs-quadratic" id="toc-breakpoint-vs-quadratic" class="nav-link" data-scroll-target="#breakpoint-vs-quadratic">Breakpoint vs quadratic</a>
  <ul class="collapse">
  <li><a href="#h1-reproductive-senescence-2" id="toc-h1-reproductive-senescence-2" class="nav-link" data-scroll-target="#h1-reproductive-senescence-2">H1: Reproductive senescence</a></li>
  <li><a href="#h2-maternal-effect-senescence-2" id="toc-h2-maternal-effect-senescence-2" class="nav-link" data-scroll-target="#h2-maternal-effect-senescence-2">H2: Maternal effect senescence</a></li>
  <li><a href="#aic-comparison" id="toc-aic-comparison" class="nav-link" data-scroll-target="#aic-comparison">AIC Comparison</a></li>
  </ul></li>
  <li><a href="#nursing-duration" id="toc-nursing-duration" class="nav-link" data-scroll-target="#nursing-duration">Nursing duration</a></li>
  <li><a href="#population-dynamics" id="toc-population-dynamics" class="nav-link" data-scroll-target="#population-dynamics">Population dynamics</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Reproduction frequency and offspring survival decline in elephant seals past prime age</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Our hypotheses:</p>
<ol type="1">
<li><p>Elephant seal reproductive success declines with age.</p></li>
<li><p>Reproductive declines persist to the next generation (maternal effect senescence).&nbsp;That is, offspring survival and reproduction decrease with maternal age.</p></li>
<li><p>Offspring sex ratios shift towards males with old age.</p></li>
<li><p>Annual cycle phenology - specifically, the duration of the molt haulout - will shift for older animals.</p></li>
</ol>
</section>
<section id="results" class="level1">
<h1>Results</h1>
<p>n = 1203 distinct animals, with 4404 total observations.</p>
<section id="raw-data" class="level3">
<h3 class="anchored" data-anchor-id="raw-data">Raw data</h3>
<div class="cell">
<div class="cell-output-display">
<div id="fig-raw-data" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-raw-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="paperv3_files/figure-html/fig-raw-data-1.png" class="img-fluid figure-img" width="864">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-raw-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: A large number of elephant seals from each cohort are tagged during their birth year (yellow) and observations take place for the rest of their lives so that breeding status (greens and blues) can be assigned and compared to age. A: Raw longitudinal data for 1,203 known-age female elephant seals and their observations from birth, to recruitment, to death. B: Histogram of the number of seals in each age class in the dataset.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="h1-reproductive-senescence" class="level3">
<h3 class="anchored" data-anchor-id="h1-reproductive-senescence">H1: Reproductive senescence</h3>
<p>We predicted that breeding success would decline with age. Based on the literature, we chose age 11 to be the end of prime age and indicate the onset of senescence. If breeding success declined with age, we would expect to see a negative slope post-senescence (<a href="#fig-breeding-mod" class="quarto-xref">Figure&nbsp;2</a>).</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>                    Estimate Std. Error   z value     Pr(&gt;|z|)
(Intercept)         3.278317  0.2015442 16.265990 1.720643e-59
age10:age_catYoung  1.032185  0.2615077  3.947052 7.911929e-05
age10:age_catOld   -1.398506  0.4319223 -3.237866 1.204275e-03</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  mean_breed
       &lt;dbl&gt;
1      0.950</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 17 × 9
     age age_cat predicted predicted_pop conf_lo conf_hi     n perc_pop
   &lt;dbl&gt; &lt;fct&gt;       &lt;dbl&gt;         &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt;    &lt;dbl&gt;
 1     4 Young       0.909         0.928   0.879   0.932   786  0.179  
 2     5 Young       0.917         0.935   0.891   0.938   731  0.166  
 3     6 Young       0.925         0.941   0.901   0.943   609  0.138  
 4     7 Young       0.932         0.946   0.910   0.948   505  0.115  
 5     8 Young       0.938         0.951   0.917   0.954   399  0.0907 
 6     9 Young       0.944         0.956   0.924   0.959   331  0.0753 
 7    10 Young       0.949         0.960   0.929   0.964   253  0.0575 
 8    11 Old         0.954         0.964   0.933   0.968   202  0.0459 
 9    12 Old         0.947         0.958   0.926   0.962   159  0.0362 
10    13 Old         0.940         0.953   0.916   0.957   122  0.0277 
11    14 Old         0.931         0.946   0.904   0.951    93  0.0211 
12    15 Old         0.922         0.938   0.887   0.946    63  0.0143 
13    16 Old         0.911         0.930   0.867   0.941    55  0.0125 
14    17 Old         0.899         0.920   0.842   0.937    35  0.00796
15    18 Old         0.886         0.909   0.813   0.932    27  0.00614
16    19 Old         0.871         0.897   0.779   0.928    20  0.00455
17    20 Old         0.854         0.883   0.740   0.923     8  0.00182
# ℹ 1 more variable: pred_pups &lt;dbl&gt;</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-breeding-mod" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-breeding-mod-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="paperv3_files/figure-html/fig-breeding-mod-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-breeding-mod-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Breeding probability for adult female elephant seals increased up to age 11, and decreased above it, providing evidence for reproductive senescence. Black points and error bars show the mean and 95% CI of breeding rates. Sample sizes for each age class are included above the points. Thin gray lines show the mean response for each year of the study (i.e., including the random effect of year). The thick solid lines and shaded areas show the mean response and 95% confidence interval of the fitted model, weighted by the number of seals observed in each year. The unweighted fitted model is shown by the dotted gray line. The weighted model is emphasized because of the large impact of the random effect of year.
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0006021375</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 7
    age age10 age_cat predicted    se pred_lwr pred_upr
  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
1    11   0   Old         0.964 0.196    0.948    0.975
2    19   0.8 Old         0.897 0.331    0.819    0.943</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 6
    age age10 age_cat year_fct `(Intercept)` predicted
  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;            &lt;dbl&gt;     &lt;dbl&gt;
1    11   0   Old     2018             -1.22     0.887
2    11   0   Old     2001              1.00     0.986
3    19   0.8 Old     2018             -1.22     0.719
4    19   0.8 Old     2001              1.00     0.959</code></pre>
</div>
</div>
<p>Sample size n = 4404 observations of 1203 individuals.</p>
</section>
<section id="h2-maternal-effect-senescence" class="level3">
<h3 class="anchored" data-anchor-id="h2-maternal-effect-senescence">H2: Maternal effect senescence</h3>
<p>We predicted that reproductive declines would carry over to the next generation - that is, pups born to older mothers would have decreased survival (for female and male pups) and reproductive success (for female pups). Pup survival significantly decreased with maternal age, but pup reproduction did not (<a href="#fig-repro-age" class="quarto-xref">Figure&nbsp;3</a>).</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Survival"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                     Estimate Std. Error   z value     Pr(&gt;|z|)
(Intercept)        -0.8329501  0.1785913 -4.664002 3.101178e-06
age10:age_catYoung  0.5222230  0.3031062  1.722904 8.490582e-02
age10:age_catOld   -1.8111152  0.7595061 -2.384596 1.709788e-02</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Recruitment"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                       Estimate Std. Error    z value     Pr(&gt;|z|)
(Intercept)        -1.703041082  0.2776611 -6.1335235 8.595372e-10
age10:age_catYoung -0.005417824  0.5125904 -0.0105695 9.915669e-01
age10:age_catOld   -2.384120453  1.6957258 -1.4059587 1.597364e-01</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.008548941</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.07986819</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-repro-age" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-repro-age-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="paperv3_files/figure-html/fig-repro-age-1.png" class="img-fluid figure-img" width="768">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-repro-age-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Elephant seal pup survival (A) but not recruitment (B) decreased with maternal age above the threshold age of 11 years. Both males and females were included in the survival analysis, but only females were included for recruitment. This caused some values of recruitment to be higher than survival at the same maternal age. Black points and error bars show means and 95% CI of survival or recruitment for each maternal age. Sample sizes for each age class are included above the points. Thin gray lines show the mean response for each year of the study (i.e., including the random effect of year). Thick dashed and solid lines show the weighted mean response and 95% CI, with solid lines indicating significant trends. The unweighted fitted model is indicated by a dotted gray line. The weighted model is emphasized because of the large impact of the random effect of year.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Sample size for offspring survival was n = 1335 observations of 618 individuals. Sample size for offspring recruitment was n = 636 observations of 421 female individuals.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 7
    age age10 age_cat predicted    se pred_lwr pred_upr
  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
1    11   0   Old        0.303  0.176   0.236     0.380
2    19   0.8 Old        0.0926 0.556   0.0332    0.233</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 6
    age age10 age_cat year_fct `(Intercept)` predicted
  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;            &lt;dbl&gt;     &lt;dbl&gt;
1    11   0   Old     1994            -0.616    0.190 
2    11   0   Old     2016             0.817    0.496 
3    19   0.8 Old     1994            -0.616    0.0523
4    19   0.8 Old     2016             0.817    0.188 </code></pre>
</div>
</div>
</section>
<section id="h3-changes-in-pup-sex-ratio-with-increased-maternal-age" class="level3">
<h3 class="anchored" data-anchor-id="h3-changes-in-pup-sex-ratio-with-increased-maternal-age">H3: Changes in pup sex ratio with increased maternal age</h3>
<p>We found that as maternal age increases, the pup sex ratio does not change (<a href="#fig-sex-ratio" class="quarto-xref">Figure&nbsp;4</a>).</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>                    Estimate Std. Error   z value  Pr(&gt;|z|)
(Intercept)        0.1736333  0.1103369 1.5736657 0.1155647
age10:age_catYoung 0.2377261  0.2258396 1.0526322 0.2925096
age10:age_catOld   0.1382212  0.4465079 0.3095605 0.7568952</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6215524</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-sex-ratio" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-sex-ratio-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="paperv3_files/figure-html/fig-sex-ratio-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-sex-ratio-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Offspring sex ratio trended towards more males with maternal age above the age threshold, but the trend was not significant. Black points and error bars show the mean and 95% CI. Sample sizes for each age class are included above the points. Thin gray lines show the mean response for each year of the study (i.e., including the random effect of year). Thick dashed lines show the weighted mean response and 95% CI; neither trend was significant. The unweighted fitted model is indicated by a dotted gray line. The weighted model is emphasized because of the large impact of the random effect of year.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Sample size n = 1786 observations of 796 individuals.</p>
<p><strong>Note</strong>: In the above figure, the population-level and weighted-average lie directly on top of each other. This is because the random effect of year has very little impact on offspring sex ratio, which makes sense biologically. It’s easy to imagine scenarios where reproduction would vary year-to-year, but harder to think of a mechanism linking year and offspring sex ratio.</p>
</section>
<section id="h4-phenology" class="level3">
<h3 class="anchored" data-anchor-id="h4-phenology">H4: Phenology</h3>
<p>Does the timing of breeding and molting suggest a mechanistic explanation for observed patterns in reproductive and maternal-effect senescence?</p>
<p>We fit a generalized linear mixed-effects model with the duration of a phase (molting or breeding) as the response variable and age, interacting with phase, as the predictor, using year as a random effect. We attempted to fit a model with random effects for both year and individual, but that failed to converge. We assumed the effect of year on phase duration (molting or breeding) was greater than the effect of individual, so we retained year as the random effect.</p>
<p><span class="math display">\[
\begin{align}
d &amp;\sim NB(\mu, k) \\
e^\mu &amp;= \beta_0 + \beta_p a + Zy
\end{align}
\]</span></p>
<p>Where: <span class="math inline">\(d\)</span> is the duration of the phase in days, <span class="math inline">\(NB\)</span> is the negative binomial distribution with location <span class="math inline">\(\mu\)</span> and dispersion <span class="math inline">\(k\)</span>, <span class="math inline">\(\beta_0\)</span> is the intercept, <span class="math inline">\(\beta_p\)</span> is the coefficient for age (<span class="math inline">\(a\)</span>) by phase (i.e., for <span class="math inline">\(p\)</span> in “molting” or “breeding”), <span class="math inline">\(y\)</span> is the year, and <span class="math inline">\(Z\)</span> is the design matrix relating <span class="math inline">\(y\)</span> to <span class="math inline">\(e^\mu\)</span>.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 6
    age phase    age_cat dur_days dur_days_lwr dur_days_upr
  &lt;dbl&gt; &lt;chr&gt;    &lt;fct&gt;      &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;
1     4 moltdur  Young       32.2         30.9         33.5
2     4 breeddur Young       25.6         24.6         26.6
3    10 moltdur  Young       28.4         27.3         29.6
4    10 breeddur Young       27.5         26.4         28.6</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-phen" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-phen-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="paperv3_files/figure-html/fig-phen-1.png" class="img-fluid figure-img" width="768">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-phen-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Neither molting nor breeding haul out duration changed with old age. A: Raw data plotting the observed annual time allocation averaged over all n = 387 individuals. B &amp; C: Points and error bars represent the mean and CI for haul out durations. Sample sizes for each age class are included above the points. Thin gray lines show the mean response for each year of the study (i.e., including the random effect of year). Thick solid and dashed lines represent the mean response and 95% CI of the fitted model, weighted by the number of seals observed per year, with solid lines indicating significant trends. The unweighted fitted model is indicated by a dotted gray line. The weighted model is emphasized because of the large impact of the random effect of year.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Sample size n = 1122 observations of 387 individuals.</p>
</section>
</section>
<section id="supplemental-material" class="level1">
<h1>Supplemental Material</h1>
<section id="detailed-model-outputs" class="level2">
<h2 class="anchored" data-anchor-id="detailed-model-outputs">Detailed model outputs</h2>
<section id="h1-reproductive-senescence-1" class="level3">
<h3 class="anchored" data-anchor-id="h1-reproductive-senescence-1">H1: Reproductive senescence</h3>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Generalized linear mixed model fit by maximum likelihood (Laplace
  Approximation) [glmerMod]
 Family: binomial  ( logit )
Formula: observed_int ~ age10:age_cat + (1 | animalID) + (1 | year_fct)
   Data: sealdat
Control: glmerControl(optimizer = "bobyqa")

     AIC      BIC   logLik deviance df.resid 
  2565.7   2597.7  -1277.9   2555.7     4399 

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-5.9645  0.1771  0.2558  0.3516  0.7488 

Random effects:
 Groups   Name        Variance Std.Dev.
 animalID (Intercept) 0.4471   0.6687  
 year_fct (Intercept) 0.6126   0.7827  
Number of obs: 4404, groups:  animalID, 1203; year_fct, 36

Fixed effects:
                   Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)          3.2783     0.2015  16.266  &lt; 2e-16 ***
age10:age_catYoung   1.0322     0.2615   3.947 7.91e-05 ***
age10:age_catOld    -1.3985     0.4319  -3.238   0.0012 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
            (Intr) a10:_Y
ag10:g_ctYn  0.604       
ag10:g_ctOl -0.373 -0.498</code></pre>
</div>
</div>
</section>
<section id="h2-maternal-effect-senescence-1" class="level3">
<h3 class="anchored" data-anchor-id="h2-maternal-effect-senescence-1">H2: Maternal effect senescence</h3>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Generalized linear mixed model fit by maximum likelihood (Laplace
  Approximation) [glmerMod]
 Family: binomial  ( logit )
Formula: pup_surv_int ~ age10:age_cat + (1 | animalID) + (1 | year_fct)
   Data: surv_recr_data
Control: glmerControl(optimizer = "bobyqa")

     AIC      BIC   logLik deviance df.resid 
  1541.3   1567.3   -765.6   1531.3     1330 

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-0.9900 -0.6116 -0.5005  1.1413  2.6166 

Random effects:
 Groups   Name        Variance Std.Dev.
 animalID (Intercept) 0.0352   0.1876  
 year_fct (Intercept) 0.2827   0.5317  
Number of obs: 1335, groups:  animalID, 618; year_fct, 29

Fixed effects:
                   Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)         -0.8330     0.1786  -4.664  3.1e-06 ***
age10:age_catYoung   0.5222     0.3031   1.723   0.0849 .  
age10:age_catOld    -1.8111     0.7595  -2.385   0.0171 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
            (Intr) a10:_Y
ag10:g_ctYn  0.693       
ag10:g_ctOl -0.403 -0.461</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Generalized linear mixed model fit by maximum likelihood (Laplace
  Approximation) [glmerMod]
 Family: binomial  ( logit )
Formula: pup_recr_int ~ age10:age_cat + (1 | year_fct)
   Data: filter(surv_recr_data, pupsex == "F")
Control: glmerControl(optimizer = "bobyqa")

     AIC      BIC   logLik deviance df.resid 
   574.0    591.8   -283.0    566.0      632 

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-0.5851 -0.4778 -0.3937 -0.3399  3.8709 

Random effects:
 Groups   Name        Variance Std.Dev.
 year_fct (Intercept) 0.2695   0.5191  
Number of obs: 636, groups:  year_fct, 29

Fixed effects:
                    Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)        -1.703041   0.277661  -6.134  8.6e-10 ***
age10:age_catYoung -0.005418   0.512590  -0.011    0.992    
age10:age_catOld   -2.384120   1.695726  -1.406    0.160    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
            (Intr) a10:_Y
ag10:g_ctYn  0.793       
ag10:g_ctOl -0.401 -0.384</code></pre>
</div>
</div>
</section>
<section id="h3-offspring-sex-ratio" class="level3">
<h3 class="anchored" data-anchor-id="h3-offspring-sex-ratio">H3: Offspring sex ratio</h3>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Generalized linear mixed model fit by maximum likelihood (Laplace
  Approximation) [glmerMod]
 Family: binomial  ( logit )
Formula: is_male ~ age10:age_cat + (1 | animalID) + (1 | year_fct)
   Data: pup_sex_data

     AIC      BIC   logLik deviance df.resid 
  2479.0   2506.5  -1234.5   2469.0     1781 

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-1.2156 -1.0311  0.8629  0.9579  1.0761 

Random effects:
 Groups   Name        Variance Std.Dev.
 animalID (Intercept) 0.002551 0.05051 
 year_fct (Intercept) 0.022499 0.15000 
Number of obs: 1786, groups:  animalID, 796; year_fct, 36

Fixed effects:
                   Estimate Std. Error z value Pr(&gt;|z|)
(Intercept)          0.1736     0.1103   1.574    0.116
age10:age_catYoung   0.2377     0.2258   1.053    0.293
age10:age_catOld     0.1382     0.4465   0.310    0.757

Correlation of Fixed Effects:
            (Intr) a10:_Y
ag10:g_ctYn  0.858       
ag10:g_ctOl -0.509 -0.462</code></pre>
</div>
</div>
</section>
<section id="h4-phenology-1" class="level3">
<h3 class="anchored" data-anchor-id="h4-phenology-1">H4: Phenology</h3>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Generalized linear mixed model fit by maximum likelihood (Laplace
  Approximation) [glmerMod]
 Family: Gamma  ( log )
Formula: dur_days ~ age10:phase:age_cat + (1 | year_fct) + (1 | animalID)
   Data: .

     AIC      BIC   logLik deviance df.resid 
 16956.6  17002.3  -8470.3  16940.6     2236 

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-2.6990 -0.4623  0.0828  0.5862  8.0632 

Random effects:
 Groups   Name        Variance Std.Dev.
 animalID (Intercept) 0.012680 0.11260 
 year_fct (Intercept) 0.001418 0.03765 
 Residual             0.117176 0.34231 
Number of obs: 2244, groups:  animalID, 387; year_fct, 13

Fixed effects:
                                  Estimate Std. Error t value Pr(&gt;|z|)    
(Intercept)                       3.326023   0.034249  97.112  &lt; 2e-16 ***
age10:phasebreeddur:age_catYoung  0.120730   0.048599   2.484    0.013 *  
age10:phasemoltdur:age_catYoung  -0.209050   0.048721  -4.291 1.78e-05 ***
age10:phasebreeddur:age_catOld   -0.007083   0.101576  -0.070    0.944    
age10:phasemoltdur:age_catOld     0.021409   0.102118   0.210    0.834    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
             (Intr) ag10:phsb:_Y ag10:phsm:_Y ag10:phsb:_O
ag10:phsb:_Y  0.633                                       
ag10:phsm:_Y  0.626  0.767                                
ag10:phsb:_O -0.208 -0.246       -0.245                   
ag10:phsm:_O -0.209 -0.248       -0.247        0.390      </code></pre>
</div>
</div>
</section>
</section>
<section id="models-sensitivity-to-age-of-senescence" class="level2">
<h2 class="anchored" data-anchor-id="models-sensitivity-to-age-of-senescence">Models’ sensitivity to age of senescence</h2>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 13%">
<col style="width: 17%">
<col style="width: 18%">
<col style="width: 22%">
<col style="width: 28%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">age_cutoff</th>
<th style="text-align: right;">H1 (breeding)</th>
<th style="text-align: right;">H2a (survival)</th>
<th style="text-align: right;">H2b (recruitment)</th>
<th style="text-align: right;">H3 (sex ratio; 2 tail)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: right;">0.5117111</td>
<td style="text-align: right;">0.4491951</td>
<td style="text-align: right;">0.2354988</td>
<td style="text-align: right;">0.0479728</td>
</tr>
<tr class="even">
<td style="text-align: right;">7</td>
<td style="text-align: right;">0.1733864</td>
<td style="text-align: right;">0.3380594</td>
<td style="text-align: right;">0.4814068</td>
<td style="text-align: right;">0.0169887</td>
</tr>
<tr class="odd">
<td style="text-align: right;">8</td>
<td style="text-align: right;">0.1062985</td>
<td style="text-align: right;">0.3617117</td>
<td style="text-align: right;">0.6345090</td>
<td style="text-align: right;">0.0669467</td>
</tr>
<tr class="even">
<td style="text-align: right;">9</td>
<td style="text-align: right;">0.0039155</td>
<td style="text-align: right;">0.1926554</td>
<td style="text-align: right;">0.1386555</td>
<td style="text-align: right;">0.0358102</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10</td>
<td style="text-align: right;">0.0025105</td>
<td style="text-align: right;">0.0207648</td>
<td style="text-align: right;">0.0588221</td>
<td style="text-align: right;">0.0641891</td>
</tr>
<tr class="even">
<td style="text-align: right;">11</td>
<td style="text-align: right;">0.0012043</td>
<td style="text-align: right;">0.0152245</td>
<td style="text-align: right;">0.1597364</td>
<td style="text-align: right;">0.1395860</td>
</tr>
<tr class="odd">
<td style="text-align: right;">12</td>
<td style="text-align: right;">0.0012043</td>
<td style="text-align: right;">0.0152245</td>
<td style="text-align: right;">0.1597364</td>
<td style="text-align: right;">0.1395860</td>
</tr>
<tr class="even">
<td style="text-align: right;">13</td>
<td style="text-align: right;">0.0011623</td>
<td style="text-align: right;">0.0147789</td>
<td style="text-align: right;">0.2300386</td>
<td style="text-align: right;">0.2274869</td>
</tr>
<tr class="odd">
<td style="text-align: right;">14</td>
<td style="text-align: right;">0.0021477</td>
<td style="text-align: right;">0.0264679</td>
<td style="text-align: right;">0.2638768</td>
<td style="text-align: right;">0.4642742</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 15%">
<col style="width: 19%">
<col style="width: 20%">
<col style="width: 24%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">age_cutoff</th>
<th style="text-align: right;">H1 (breeding)</th>
<th style="text-align: right;">H2a (survival)</th>
<th style="text-align: right;">H2b (recruitment)</th>
<th style="text-align: right;">H3 (sex ratio)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: right;">0.0039001</td>
<td style="text-align: right;">0.0096280</td>
<td style="text-align: right;">0.0590115</td>
<td style="text-align: right;">0.0820588</td>
</tr>
<tr class="even">
<td style="text-align: right;">7</td>
<td style="text-align: right;">0.0084730</td>
<td style="text-align: right;">0.0113946</td>
<td style="text-align: right;">0.0517889</td>
<td style="text-align: right;">0.1928457</td>
</tr>
<tr class="odd">
<td style="text-align: right;">8</td>
<td style="text-align: right;">0.0060296</td>
<td style="text-align: right;">0.0103127</td>
<td style="text-align: right;">0.0520724</td>
<td style="text-align: right;">0.0979501</td>
</tr>
<tr class="even">
<td style="text-align: right;">9</td>
<td style="text-align: right;">0.1613791</td>
<td style="text-align: right;">0.0165146</td>
<td style="text-align: right;">0.1070672</td>
<td style="text-align: right;">0.1702957</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10</td>
<td style="text-align: right;">0.1216003</td>
<td style="text-align: right;">0.1486893</td>
<td style="text-align: right;">0.3179810</td>
<td style="text-align: right;">0.1377776</td>
</tr>
<tr class="even">
<td style="text-align: right;">11</td>
<td style="text-align: right;">0.1839577</td>
<td style="text-align: right;">0.2185474</td>
<td style="text-align: right;">0.1215008</td>
<td style="text-align: right;">0.0929731</td>
</tr>
<tr class="odd">
<td style="text-align: right;">12</td>
<td style="text-align: right;">0.1839577</td>
<td style="text-align: right;">0.2185474</td>
<td style="text-align: right;">0.1215008</td>
<td style="text-align: right;">0.0929731</td>
</tr>
<tr class="even">
<td style="text-align: right;">13</td>
<td style="text-align: right;">0.2125363</td>
<td style="text-align: right;">0.2344281</td>
<td style="text-align: right;">0.0874106</td>
<td style="text-align: right;">0.0729546</td>
</tr>
<tr class="odd">
<td style="text-align: right;">14</td>
<td style="text-align: right;">0.1181662</td>
<td style="text-align: right;">0.1319379</td>
<td style="text-align: right;">0.0816666</td>
<td style="text-align: right;">0.0601711</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-mod-sens" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-mod-sens-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="paperv3_files/figure-html/fig-mod-sens-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-mod-sens-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: Model sensitivity to onset of senescence. Age at onset of senescence on the x-axis, p-value for the coefficient of the interaction (age category = post-senescence) x (response variable) on the y-axis. Statistical significance (p = 0.05) indicated by dashed line. Hypotheses H1 (reproductive senescence), H2b (maternal-effect senescence; offspring recruitment), and H3 (offspring sex ratio) were insensitive to choice of age for onset of senescence. Hypothesis H2a (maternal-effect senescence; offspring survival) was significantly supported for onset of senescence age 11+. At age 10, the p-vale for the coefficient of the interaction (age category = post-senescence) x (offspring survival) was 0.058.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="selective-appearance-and-disappearance" class="level2">
<h2 class="anchored" data-anchor-id="selective-appearance-and-disappearance">Selective appearance and disappearance</h2>
<p>Age-dependent life history shifts can result from within- or between-animal changes <span class="citation" data-cites="vandepol2006">(<a href="#ref-vandepol2006" role="doc-biblioref">Pol and Verhulst 2006</a>)</span>. We hypothesized age-dependent changes in reproduction were due to senescence, i.e.&nbsp;within-animal changes. However, it is possible that selective appearance or disappearance of animals in the population can create the same pattern. For example, if animals the breed more frequently have lower survival, then older animals will reproduce less frequently not because of senescence but rather because infrequent breeders disproportionately survive to older ages (i.e.&nbsp;selective disappearance). We tested whether our significant results (reproductive senescence, maternal effect senescence in pup survival) were influenced by selective appearance and disappearance, following the methods of <span class="citation" data-cites="vandepol2006">Pol and Verhulst (<a href="#ref-vandepol2006" role="doc-biblioref">2006</a>)</span>, by adding terms for age at first and last reproduction, respectively. If our results are due to selective appearance/disappearance instead of senescence, then the 95% CI for the coefficient of age in the old age class in these models will overlap 0.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-selective" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-selective-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="paperv3_files/figure-html/fig-selective-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-selective-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: The coefficient for age in the old age class in models accounting for selective appearance and disappearance. Red and blue indicate reproductive senescence (H1) and maternal effect senescence (H2a), respectively. Compared to the base model, the appearance model includes a term for age at first reproduction, the disappearance model includes a term for age at last reproduction, and the combined model includes both.
</figcaption>
</figure>
</div>
</div>
</div>
<p>There was no evidence for selective appearance or disappearance influencing the relationship between maternal age and probability of reproduction or offspring survival. The 95% CI of the coefficient for age in the old age class did not overlap 0 for either hypothesis in any of the selective (dis)appearance models <a href="#fig-selective" class="quarto-xref">Figure&nbsp;7</a>. Therefore the observed patterns are consistent with the senescence hypothesis (i.e., within-animal change with age).</p>
</section>
<section id="chronological-versus-biological-age" class="level2">
<h2 class="anchored" data-anchor-id="chronological-versus-biological-age">Chronological versus biological age</h2>
<p>The chronological age of an individual may not reflect their biological age because aging rates vary within populations <span class="citation" data-cites="martin2011">(<a href="#ref-martin2011" role="doc-biblioref">Martin and Festa-Bianchet 2011</a>)</span>. Years-to-death, a proxy for biological age, may therefore be a better predictor for senescence patterns than chronological age. We repeated our analysis for the reproductive senescence hypothesis using biological age, setting the breakpoint for senescence at biological age -7 years (i.e.&nbsp;7 years prior to final observation), based on visual inspection of the raw data. This required us to limit our sample to animals with known longevity (i.e., last observation in 2020 or earlier), which reduced our sample size to 3167 observations of 934 distinct animals. Subsequently, we fit the model for breakpoints at all biological ages -12 to -3 years, to assess whether our results were sensitive to the choice of breakpoint. Finally, we re-fit the chronological reproductive senescence model using the known-longevity dataset and compared chronological versus biological age models using AIC.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>                          Estimate Std. Error   z value     Pr(&gt;|z|)
(Intercept)               3.198640  0.2603267 12.287021 1.063540e-34
bioage10:bioage_catOld   -1.245722  0.4544522 -2.741150 6.122454e-03
bioage10:bioage_catYoung  1.249348  0.6161820  2.027563 4.260489e-02</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 2
   `Biological age threshold` `p value`
                        &lt;int&gt;     &lt;dbl&gt;
 1                        -12   0.122  
 2                        -11   0.0860 
 3                        -10   0.0389 
 4                         -9   0.0192 
 5                         -8   0.00658
 6                         -7   0.00306
 7                         -6   0.00259
 8                         -5   0.00534
 9                         -4   0.00576
10                         -3   0.0172 </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">model</th>
<th style="text-align: right;">AIC</th>
<th style="text-align: right;">dAIC</th>
<th style="text-align: right;">weight</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Biological age</td>
<td style="text-align: right;">1177.197</td>
<td style="text-align: right;">4.134696</td>
<td style="text-align: right;">0.1123112</td>
</tr>
<tr class="even">
<td style="text-align: left;">Chronological age</td>
<td style="text-align: right;">1173.062</td>
<td style="text-align: right;">0.000000</td>
<td style="text-align: right;">0.8876888</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-bio-age" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-bio-age-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="paperv3_files/figure-html/fig-bio-age-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-bio-age-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8: Breeding probability over biological age. Points and error bars are the mean ± SE of observed breeding proportions within age classes. The vertical dashed line indicates the threshold for senescence. Solid lines and ribbons are the mean and 95% CI of the population-level breeding probability, estimated by a GLMM with random effects for individual and year. The dashed lines represent the mean of yearly breeding probabilities, weighted by the number of seals observed each year, which should match the observed data more closely than the population-level probabilities.
</figcaption>
</figure>
</div>
</div>
</div>
<p>The biological age model did not support the reproductive senescence hypothesis. The coefficient for biological age among older animals (biological age &gt; -7 years) was -1.246 (-2.136 - -0.355) (95% CI) which was not significantly different than 0 (<em>p</em> = 0.997). Choice of breakpoint for senescence did not affect the significance of this coefficient. For breakpoints -12 to -3 years, <em>p</em> reached a minimum at biological age -7 years (see table above).</p>
<p>The chronological age model outperformed the biological age model according to AIC.</p>
<p>Based on these results, we find there is evidence to support the reproductive senescence hypothesis based on chronological age. The biological age proxy, years-to-death, should be a better predictor of senescence than chronological age if most mortality is age-related. However, adult elephant seal mortality is largely influenced by extrinsic factors, primarily food availability <span class="citation" data-cites="colegrove2005 holser2021">(<a href="#ref-colegrove2005" role="doc-biblioref">Colegrove, Greig, and Gulland 2005</a>; <a href="#ref-holser2021" role="doc-biblioref">Holser et al. 2021</a>)</span>. Poor foraging conditions during El Niño years, for example, may increase mortality rates among animals whose biological age is not yet advanced. As result, the years-to-death proxy for biological age likely conflates many biologically young and old animals that died due to extrinsic factors. More accurate measures of biological age, such as telomere length <span class="citation" data-cites="jylhävä2017">(<a href="#ref-jylhävä2017" role="doc-biblioref">Jylhävä, Pedersen, and Hägg 2017</a>)</span>, may be necessary to investigate senescence in elephant seals and other species with high extrinsic sources of mortality from a non-chronological perspective.</p>
</section>
<section id="detection-frequency" class="level2">
<h2 class="anchored" data-anchor-id="detection-frequency">Detection frequency</h2>
<p>Not all seals were detected in all years. A non-detection year during the seal’s lifespan (i.e.&nbsp;an unobserved year between the first and last observed years) could represent an unobserved animal at Año Nuevo or temporary emigration. In either case, the animal may or may not have reproduced that year. By excluding these unobserved animals, our inferences for H1 (reproductive senescence) may be biased if detectability varies with age and/or by breeding state. Here, we assess those potential biases.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Generalized linear mixed model fit by maximum likelihood (Laplace
  Approximation) [glmerMod]
 Family: binomial  ( logit )
Formula: observed ~ age10:age_cat + (1 | year_fct) + (1 | animalID)
   Data: detection_seals

     AIC      BIC   logLik deviance df.resid 
  3923.1   3954.4  -1956.6   3913.1     3813 

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-4.4441 -0.5583  0.3442  0.5188  3.3715 

Random effects:
 Groups   Name        Variance Std.Dev.
 animalID (Intercept) 0.8842   0.9403  
 year_fct (Intercept) 0.9135   0.9558  
Number of obs: 3818, groups:  animalID, 561; year_fct, 35

Fixed effects:
                   Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)          1.0008     0.1933   5.177 2.26e-07 ***
age10:age_catYoung  -0.9252     0.2104  -4.397 1.10e-05 ***
age10:age_catOld    -0.5619     0.3908  -1.438     0.15    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
            (Intr) a10:_Y
ag10:g_ctYn  0.424       
ag10:g_ctOl -0.251 -0.423</code></pre>
</div>
</div>
<p>First, we tested whether detection probability was related to age. We found detection probalities decreased with age (i.e., older seals are less likely to be detected). For this analysis, we excluded the last year each animal was observed. Then, for all years between animals’ age 4 year to the year prior to final observation, we determined whether each animal was detected. We estimated the effect of age on detection probability using a GLMM (binomial response, logit link) with an interaction between age and age category (young = age &lt; 11, old = age &gt; 11) and random effects for year and animal (<a href="#fig-unobserved" class="quarto-xref">Figure&nbsp;9</a>). The coefficient for age was not significantly different than 0 for animals older than 11, but detection probability decreased significantly with age up to age 11. The change in detection probability from age 11 to 19 was 70.1% (61.7 - 77.3%) to 59.9% (44.4% - 73.7%).</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-unobserved" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-unobserved-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="paperv3_files/figure-html/fig-unobserved-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-unobserved-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9: Detection probabilities decreased with age for young, but not old, animals. Points and error bars represent the proportion of detected animals with 95% CI. The green and pink lines and shaded areas are the mean and 95% CI probability of an animal being detected (GLMM with random effect of year, weighted by number of seals observed each year), color-coded by age category. The dotted line is the mean response of the unweighted predictions. Numbers at the top indicate number of seals of each age. See text for model details.
</figcaption>
</figure>
</div>
</div>
</div>
<p>The pattern of unobserved animals decreasing with age means it is highly unlikely our inferences about reproductive senescence are due to partial detection.</p>
<p>Among the animals in this study, breeders hauled out for longer than non-breeders (1st - 3rd quartile: breeders 25 - 31 days; non-breeders 10 - 26 days). This extended period of time on the beach makes them more accessible to observers. Furthermore, northern elephant seals exhibit a high degree of site fidelity. Once they recruit to a breeding colony, temporary emigration is rare. Breeding animals were resighted 18.9 (7 - 28) times per year, compared to 8.6 (3 - 12) for non-breeders (mean, 1st - 3rd quartile), which suggests that breeders are more readily observable than non-breeders.</p>
</section>
<section id="breakpoint-vs-quadratic" class="level2">
<h2 class="anchored" data-anchor-id="breakpoint-vs-quadratic">Breakpoint vs quadratic</h2>
<section id="h1-reproductive-senescence-2" class="level3">
<h3 class="anchored" data-anchor-id="h1-reproductive-senescence-2">H1: Reproductive senescence</h3>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>                              Estimate Std. Error   z value     Pr(&gt;|z|)
(Intercept)                  3.0829669  0.1803523 17.094141 1.640961e-65
poly(age10, 2, raw = TRUE)1 -0.1134344  0.1829231 -0.620121 5.351781e-01
poly(age10, 2, raw = TRUE)2 -1.3154889  0.3381634 -3.890098 1.002036e-04</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Age peak (H1) = 10.6"</code></pre>
</div>
</div>
</section>
<section id="h2-maternal-effect-senescence-2" class="level3">
<h3 class="anchored" data-anchor-id="h2-maternal-effect-senescence-2">H2: Maternal effect senescence</h3>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>                              Estimate Std. Error   z value     Pr(&gt;|z|)
(Intercept)                 -1.0176772  0.1530649 -6.648666 2.957613e-11
poly(age10, 2, raw = TRUE)1 -0.4693668  0.3134354 -1.497491 1.342655e-01
poly(age10, 2, raw = TRUE)2 -1.0817482  0.5584824 -1.936942 5.275240e-02</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Age peak (H2a) = 8.8"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                              Estimate Std. Error    z value     Pr(&gt;|z|)
(Intercept)                 -1.8873468  0.2308794 -8.1745989 2.968517e-16
poly(age10, 2, raw = TRUE)1 -0.8114974  0.6472607 -1.2537413 2.099361e-01
poly(age10, 2, raw = TRUE)2 -0.7712672  1.0382858 -0.7428274 4.575862e-01</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Age peak (H2b) = 5.7"</code></pre>
</div>
</div>
</section>
<section id="aic-comparison" class="level3">
<h3 class="anchored" data-anchor-id="aic-comparison">AIC Comparison</h3>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">hypothesis</th>
<th style="text-align: left;">model</th>
<th style="text-align: right;">AIC</th>
<th style="text-align: right;">weight</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">H1</td>
<td style="text-align: left;">Breakpoint</td>
<td style="text-align: right;">2565.7492</td>
<td style="text-align: right;">0.6436862</td>
</tr>
<tr class="even">
<td style="text-align: left;">H1</td>
<td style="text-align: left;">Quadratic</td>
<td style="text-align: right;">2566.9320</td>
<td style="text-align: right;">0.3563138</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H2a</td>
<td style="text-align: left;">Breakpoint</td>
<td style="text-align: right;">1541.2724</td>
<td style="text-align: right;">0.7949337</td>
</tr>
<tr class="even">
<td style="text-align: left;">H2a</td>
<td style="text-align: left;">Quadratic</td>
<td style="text-align: right;">1543.9823</td>
<td style="text-align: right;">0.2050663</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H2b</td>
<td style="text-align: left;">Breakpoint</td>
<td style="text-align: right;">573.9538</td>
<td style="text-align: right;">0.6367572</td>
</tr>
<tr class="even">
<td style="text-align: left;">H2b</td>
<td style="text-align: left;">Quadratic</td>
<td style="text-align: right;">575.0764</td>
<td style="text-align: right;">0.3632428</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="nursing-duration" class="level2">
<h2 class="anchored" data-anchor-id="nursing-duration">Nursing duration</h2>
<p>What’s the mean and 95% CI duration of nursing? <span class="citation" data-cites="reiter1981">(<a href="#ref-reiter1981" role="doc-biblioref">Reiter, Panken, and Le Boeuf 1981</a>)</span> provide the following information in Table III:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 8%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
<th>9</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>22±0</p>
<p>(1)</p></td>
<td><p>23.7±1.6</p>
<p>(9)</p></td>
<td><p>26.6±1.6</p>
<p>(24)</p></td>
<td><p>26.1±1.9</p>
<p>(12)</p></td>
<td><p>26.5±2.2</p>
<p>(6)</p></td>
<td><p>27.1±1.2</p>
<p>(8)</p></td>
<td><p>28.2±0.8</p>
<p>(5)</p></td>
<td><p>28.5±0.7</p>
<p>(2)</p></td>
</tr>
</tbody>
</table>
<p>Where the column names are the age of the seal in years, and row values indicate mean±SD (n). To get the mean and 95% CI duration of nursing, we pooled the samples for mothers age 4 and up (i.e., excluded 2- and 3-year olds).</p>
<p>The formulas we used for pooling the variances come from <span class="citation" data-cites="oneill2014">(<a href="#ref-oneill2014" role="doc-biblioref">O’Neill 2014</a>)</span>.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "26.8 (95%CI: 23.5 - 30.1)"</code></pre>
</div>
</div>
</section>
<section id="population-dynamics" class="level2">
<h2 class="anchored" data-anchor-id="population-dynamics">Population dynamics</h2>
<p>What effect does senescence have on reproduction and offspring survival? First, calculate the total pup production of the age-structured population in one year. Then, let’s pretend senescence <em>doesn’t happen</em>. In this hypothetical population, all animals older than 11 years old reproduce like an 11 year old. How many more pups would that population produce? And how many more of those pups would survive to reproductive age?</p>
<p>The observed pup production (in the age-structured population) is:</p>
<p><span class="math display">\[
\pi_{1a} = \frac{\sum_{a=4}^{20} b_a n_a}{\sum_{a=4}^{20} n_a}
\]</span></p>
<p>Where <span class="math inline">\(\pi_1\)</span> is pup production per mother per year by the age-structured population. <span class="math inline">\(a\)</span> is age, <span class="math inline">\(b\)</span> is estimated breeding percentage, and <span class="math inline">\(n\)</span> is the number of mothers in that age class.</p>
<p>Hypothetical pup production in a non-senescing population is:</p>
<p><span class="math display">\[
\pi_{2a} = \frac{\sum_{a=4}^{11} b_a n_a + \sum_{a=12}^{20} b_{11} n_a}{\sum_{a=4}^{20}n_a}
\]</span></p>
<p>I.e., <span class="math inline">\(b\)</span> does not decline post-age 11.</p>
<p>Similarly, the observed and hypothetical quantity of pups that survive to adulthood adds a term <span class="math inline">\(s\)</span> for offspring survival.</p>
<p><span class="math display">\[
\pi_{1b} = \frac{\sum_{a=4}^{20} b_a n_a s_a}{\sum_{a=4}^{20} n_a}
\]</span></p>
<p><span class="math display">\[
\pi_{2b} = \frac{\sum_{a=4}^{11} b_a n_a s_a + \sum_{a=12}^{20} b_{11} n_a s_{11}}{\sum_{a=4}^{20} n_a}
\]</span></p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>pi1a: 0.94248
pi2a: 0.94529
pi1b: 0.23559
pi2b: 0.24871</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>delta pi a -0.3%,
delta pi b -5.28%</code></pre>
</div>
</div>
<!-- -->


</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-colegrove2005" class="csl-entry" role="listitem">
Colegrove, Kathleen M., Denise J. Greig, and Frances M. D. Gulland. 2005. <span>“Causes of Live Strandings of Northern Elephant Seals (&lt;I&gt;Mirounga Angustirostris&lt;/I&gt;) and Pacific Harbor Seals (&lt;I&gt;Phoca Vitulina&lt;/I&gt;) Along the Central California Coast, 1992-2001.”</span> <em>Aquatic Mammals</em> 31 (1): 1–10. <a href="https://doi.org/10.1578/am.31.1.2005.1">https://doi.org/10.1578/am.31.1.2005.1</a>.
</div>
<div id="ref-holser2021" class="csl-entry" role="listitem">
Holser, Rachel R., Daniel E. Crocker, Patrick W. Robinson, Richard Condit, and Daniel P. Costa. 2021. <span>“Density-Dependent Effects on Reproductive Output in a Capital Breeding Carnivore, the Northern Elephant Seal (<span><em>Mirounga Angustirostris</em></span>).”</span> <em>Proceedings of the Royal Society B: Biological Sciences</em> 288 (1960). <a href="https://doi.org/10.1098/rspb.2021.1258">https://doi.org/10.1098/rspb.2021.1258</a>.
</div>
<div id="ref-jylhävä2017" class="csl-entry" role="listitem">
Jylhävä, Juulia, Nancy L. Pedersen, and Sara Hägg. 2017. <span>“Biological Age Predictors.”</span> <em>EBioMedicine</em> 21 (July): 29–36. <a href="https://doi.org/10.1016/j.ebiom.2017.03.046">https://doi.org/10.1016/j.ebiom.2017.03.046</a>.
</div>
<div id="ref-martin2011" class="csl-entry" role="listitem">
Martin, Julien G. A., and Marco Festa-Bianchet. 2011. <span>“Age-Independent and Age-Dependent Decreases in Reproduction of Females.”</span> <em>Ecology Letters</em> 14 (6): 576–81. <a href="https://doi.org/10.1111/j.1461-0248.2011.01621.x">https://doi.org/10.1111/j.1461-0248.2011.01621.x</a>.
</div>
<div id="ref-oneill2014" class="csl-entry" role="listitem">
O’Neill, B. 2014. <span>“Some Useful Moment Results in Sampling Problems.”</span> <em>The American Statistician</em> 68 (4): 282–96. <a href="https://doi.org/10.1080/00031305.2014.966589">https://doi.org/10.1080/00031305.2014.966589</a>.
</div>
<div id="ref-vandepol2006" class="csl-entry" role="listitem">
Pol, M. van de, and S. Verhulst. 2006. <span>“Age<span>-</span>Dependent Traits: A New Statistical Model to Separate Within<span>-</span> and Between<span>-</span>Individual Effects.”</span> <em>The American Naturalist</em> 167 (5): 766–73. <a href="https://doi.org/10.1086/503331">https://doi.org/10.1086/503331</a>.
</div>
<div id="ref-reiter1981" class="csl-entry" role="listitem">
Reiter, Joanne, Kathy J. Panken, and Burney J. Le Boeuf. 1981. <span>“Female Competition and Reproductive Success in Northern Elephant Seals.”</span> <em>Animal Behaviour</em> 29 (3): 670–87. <a href="https://doi.org/10.1016/s0003-3472(81)80002-4">https://doi.org/10.1016/s0003-3472(81)80002-4</a>.
</div>
</div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb35" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Reproduction frequency and offspring survival decline in elephant seals past prime age"</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co">  html: </span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co">    echo: false</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co">    fig-width: 7</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co">    fig-height: 5</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="co">    warning: false</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="an">bibliography:</span><span class="co"> references.bib</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: setup</span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false  </span></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggthemes)</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmerTest) <span class="co"># Loading this library will automatically append p-values to lmer models estimated using something called Satterthwaite's method</span></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(merTools)</span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggeffects)</span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggridges)</span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"R/format.R"</span>))</span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_few</span>(<span class="at">base_size =</span> <span class="dv">13</span>))</span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a>age_senesce <span class="ot">&lt;-</span> <span class="dv">11</span></span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a>sealdat <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data/raw/128L pull 2023_12_05.csv"</span>), </span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a>                    <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">observed =</span> <span class="fu">if_else</span>(observed <span class="sc">==</span> <span class="st">"B"</span>, <span class="st">"Breeder"</span>, <span class="st">"Non-breeder"</span>), </span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a>         <span class="at">observed_int =</span> <span class="fu">if_else</span>(observed <span class="sc">==</span> <span class="st">"Breeder"</span>, <span class="dv">1</span>, <span class="dv">0</span>), </span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a>         <span class="at">pup_survived =</span> pupseeneveragain <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(age <span class="sc">&gt;</span> <span class="dv">3</span>, </span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a>         year <span class="sc">&gt;</span> <span class="dv">1987</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-42"><a href="#cb35-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">animalID =</span> <span class="fu">factor</span>(animalID),</span>
<span id="cb35-43"><a href="#cb35-43" aria-hidden="true" tabindex="-1"></a>         <span class="at">year_fct =</span> <span class="fu">factor</span>(year),</span>
<span id="cb35-44"><a href="#cb35-44" aria-hidden="true" tabindex="-1"></a>         <span class="at">age10 =</span> (age <span class="sc">-</span> age_senesce) <span class="sc">/</span> <span class="dv">10</span>,</span>
<span id="cb35-45"><a href="#cb35-45" aria-hidden="true" tabindex="-1"></a>         <span class="at">age_cat =</span> <span class="fu">factor</span>(age <span class="sc">&gt;=</span> age_senesce, </span>
<span id="cb35-46"><a href="#cb35-46" aria-hidden="true" tabindex="-1"></a>                          <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Young"</span>, <span class="st">"Old"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb35-47"><a href="#cb35-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(animalID) <span class="sc">%&gt;%</span> </span>
<span id="cb35-48"><a href="#cb35-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">firstrepro =</span> <span class="fu">ifelse</span>(<span class="fu">max</span>(year) <span class="sc">&lt;</span> <span class="dv">2020</span> <span class="sc">&amp;&amp;</span> <span class="fu">any</span>(observed_int <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb35-49"><a href="#cb35-49" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">min</span>(age[observed_int <span class="sc">==</span> <span class="dv">1</span>]),</span>
<span id="cb35-50"><a href="#cb35-50" aria-hidden="true" tabindex="-1"></a>                             <span class="cn">NA</span>),</span>
<span id="cb35-51"><a href="#cb35-51" aria-hidden="true" tabindex="-1"></a>         <span class="at">lastrepro =</span> <span class="fu">ifelse</span>(<span class="fu">max</span>(year) <span class="sc">&lt;</span> <span class="dv">2020</span> <span class="sc">&amp;&amp;</span> <span class="fu">any</span>(observed_int <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb35-52"><a href="#cb35-52" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">max</span>(age[observed_int <span class="sc">==</span> <span class="dv">1</span>]),</span>
<span id="cb35-53"><a href="#cb35-53" aria-hidden="true" tabindex="-1"></a>                            <span class="cn">NA</span>),</span>
<span id="cb35-54"><a href="#cb35-54" aria-hidden="true" tabindex="-1"></a>         <span class="at">lastobs =</span> <span class="fu">ifelse</span>(<span class="fu">max</span>(year) <span class="sc">&lt;</span> <span class="dv">2020</span>, <span class="fu">max</span>(age), <span class="cn">NA</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb35-55"><a href="#cb35-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb35-56"><a href="#cb35-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-57"><a href="#cb35-57" aria-hidden="true" tabindex="-1"></a>resight <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data/raw/fullresights.csv"</span>), </span>
<span id="cb35-58"><a href="#cb35-58" aria-hidden="true" tabindex="-1"></a>                    <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-59"><a href="#cb35-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(animalID, resightID, season, date, timeofyear, calyear, yday) <span class="sc">%&gt;%</span> </span>
<span id="cb35-60"><a href="#cb35-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">animalID =</span> <span class="fu">as.factor</span>(animalID))</span>
<span id="cb35-61"><a href="#cb35-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-62"><a href="#cb35-62" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-63"><a href="#cb35-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-64"><a href="#cb35-64" aria-hidden="true" tabindex="-1"></a><span class="fu"># Introduction</span></span>
<span id="cb35-65"><a href="#cb35-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-66"><a href="#cb35-66" aria-hidden="true" tabindex="-1"></a>Our hypotheses:</span>
<span id="cb35-67"><a href="#cb35-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-68"><a href="#cb35-68" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Elephant seal reproductive success declines with age.</span>
<span id="cb35-69"><a href="#cb35-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-70"><a href="#cb35-70" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Reproductive declines persist to the next generation (maternal effect senescence).&nbsp;That is, offspring survival and reproduction decrease with maternal age.</span>
<span id="cb35-71"><a href="#cb35-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-72"><a href="#cb35-72" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Offspring sex ratios shift towards males with old age.</span>
<span id="cb35-73"><a href="#cb35-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-74"><a href="#cb35-74" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>Annual cycle phenology - specifically, the duration of the molt haulout - will shift for older animals.</span>
<span id="cb35-75"><a href="#cb35-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-76"><a href="#cb35-76" aria-hidden="true" tabindex="-1"></a><span class="fu"># Results</span></span>
<span id="cb35-77"><a href="#cb35-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-78"><a href="#cb35-78" aria-hidden="true" tabindex="-1"></a>n = <span class="in">`r n_distinct(sealdat$animalID)`</span> distinct animals, with <span class="in">`r n_distinct(sealdat)`</span> total observations.</span>
<span id="cb35-79"><a href="#cb35-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-80"><a href="#cb35-80" aria-hidden="true" tabindex="-1"></a><span class="fu">### Raw data</span></span>
<span id="cb35-81"><a href="#cb35-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-84"><a href="#cb35-84" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-85"><a href="#cb35-85" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-raw-data</span></span>
<span id="cb35-86"><a href="#cb35-86" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 9</span></span>
<span id="cb35-87"><a href="#cb35-87" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "A large number of elephant seals from each cohort are tagged during their birth year (yellow) and observations take place for the rest of their lives so that breeding status (greens and blues) can be assigned and compared to age. A: Raw longitudinal data for 1,203 known-age female elephant seals and their observations from birth, to recruitment, to death. B: Histogram of the number of seals in each age class in the dataset."</span></span>
<span id="cb35-88"><a href="#cb35-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-89"><a href="#cb35-89" aria-hidden="true" tabindex="-1"></a>sighting_img <span class="ot">&lt;-</span> sealdat <span class="sc">%&gt;%</span> </span>
<span id="cb35-90"><a href="#cb35-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(animalID) <span class="sc">%&gt;%</span> </span>
<span id="cb35-91"><a href="#cb35-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">yearborn =</span> yearborn[<span class="dv">1</span>],</span>
<span id="cb35-92"><a href="#cb35-92" aria-hidden="true" tabindex="-1"></a>            <span class="at">first_obs =</span> <span class="fu">min</span>(year),</span>
<span id="cb35-93"><a href="#cb35-93" aria-hidden="true" tabindex="-1"></a>            <span class="at">last_obs =</span> <span class="fu">max</span>(year),</span>
<span id="cb35-94"><a href="#cb35-94" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"keep"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-95"><a href="#cb35-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">yearborn =</span> yearborn,</span>
<span id="cb35-96"><a href="#cb35-96" aria-hidden="true" tabindex="-1"></a>          <span class="at">year =</span> yearborn<span class="sc">:</span>last_obs,</span>
<span id="cb35-97"><a href="#cb35-97" aria-hidden="true" tabindex="-1"></a>          <span class="at">age =</span> year <span class="sc">-</span> yearborn,</span>
<span id="cb35-98"><a href="#cb35-98" aria-hidden="true" tabindex="-1"></a>          <span class="at">prerecruit =</span> year <span class="sc">&lt;</span> first_obs) <span class="sc">%&gt;%</span> </span>
<span id="cb35-99"><a href="#cb35-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(sealdat <span class="sc">%&gt;%</span> </span>
<span id="cb35-100"><a href="#cb35-100" aria-hidden="true" tabindex="-1"></a>              <span class="fu">group_by</span>(animalID, year) <span class="sc">%&gt;%</span> </span>
<span id="cb35-101"><a href="#cb35-101" aria-hidden="true" tabindex="-1"></a>              <span class="fu">summarize</span>(<span class="at">observed_int =</span> <span class="fu">max</span>(observed_int),</span>
<span id="cb35-102"><a href="#cb35-102" aria-hidden="true" tabindex="-1"></a>                        <span class="at">.groups =</span> <span class="st">"drop"</span>),</span>
<span id="cb35-103"><a href="#cb35-103" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"animalID"</span>, <span class="st">"year"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb35-104"><a href="#cb35-104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb35-105"><a href="#cb35-105" aria-hidden="true" tabindex="-1"></a>    <span class="at">observed =</span> <span class="fu">case_when</span>(</span>
<span id="cb35-106"><a href="#cb35-106" aria-hidden="true" tabindex="-1"></a>      age <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Born"</span>,</span>
<span id="cb35-107"><a href="#cb35-107" aria-hidden="true" tabindex="-1"></a>      prerecruit <span class="sc">~</span> <span class="st">"Pre-recruit"</span>,</span>
<span id="cb35-108"><a href="#cb35-108" aria-hidden="true" tabindex="-1"></a>      observed_int <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Non-breeder"</span>,</span>
<span id="cb35-109"><a href="#cb35-109" aria-hidden="true" tabindex="-1"></a>      observed_int <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Breeder"</span>,</span>
<span id="cb35-110"><a href="#cb35-110" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(observed_int) <span class="sc">~</span> <span class="st">"Unobserved"</span></span>
<span id="cb35-111"><a href="#cb35-111" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb35-112"><a href="#cb35-112" aria-hidden="true" tabindex="-1"></a>    <span class="at">observed =</span> <span class="fu">factor</span>(observed, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Born"</span>,</span>
<span id="cb35-113"><a href="#cb35-113" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">"Pre-recruit"</span>,</span>
<span id="cb35-114"><a href="#cb35-114" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">"Non-breeder"</span>,</span>
<span id="cb35-115"><a href="#cb35-115" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">"Breeder"</span>,</span>
<span id="cb35-116"><a href="#cb35-116" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">"Unobserved"</span>))</span>
<span id="cb35-117"><a href="#cb35-117" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb35-118"><a href="#cb35-118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(animalID) <span class="sc">%&gt;%</span> </span>
<span id="cb35-119"><a href="#cb35-119" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lastrepro =</span> <span class="fu">max</span>(age),</span>
<span id="cb35-120"><a href="#cb35-120" aria-hidden="true" tabindex="-1"></a>         <span class="at">yearborn =</span> <span class="fu">na.omit</span>(yearborn)[<span class="dv">1</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb35-121"><a href="#cb35-121" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb35-122"><a href="#cb35-122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(yearborn, lastrepro, animalID) <span class="sc">%&gt;%</span> </span>
<span id="cb35-123"><a href="#cb35-123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">animalID =</span> <span class="fu">factor</span>(animalID, <span class="at">levels =</span> <span class="fu">unique</span>(animalID))) <span class="sc">%&gt;%</span> </span>
<span id="cb35-124"><a href="#cb35-124" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;</span> <span class="dv">1987</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-125"><a href="#cb35-125" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(year, animalID)) <span class="sc">+</span></span>
<span id="cb35-126"><a href="#cb35-126" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_raster</span>(<span class="fu">aes</span>(<span class="at">fill =</span> observed)) <span class="sc">+</span></span>
<span id="cb35-127"><a href="#cb35-127" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"YlGnBu"</span>, <span class="at">direction =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb35-128"><a href="#cb35-128" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">position =</span> <span class="st">"inside"</span>, </span>
<span id="cb35-129"><a href="#cb35-129" aria-hidden="true" tabindex="-1"></a>                             <span class="at">direction =</span> <span class="st">"horizontal"</span>,</span>
<span id="cb35-130"><a href="#cb35-130" aria-hidden="true" tabindex="-1"></a>                             <span class="at">ncol =</span> <span class="dv">1</span>,</span>
<span id="cb35-131"><a href="#cb35-131" aria-hidden="true" tabindex="-1"></a>                             <span class="at">byrow =</span> <span class="cn">TRUE</span>)) <span class="sc">+</span></span>
<span id="cb35-132"><a href="#cb35-132" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span><span class="st">"Individual"</span>) <span class="sc">+</span></span>
<span id="cb35-133"><a href="#cb35-133" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb35-134"><a href="#cb35-134" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb35-135"><a href="#cb35-135" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb35-136"><a href="#cb35-136" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb35-137"><a href="#cb35-137" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.95</span>),</span>
<span id="cb35-138"><a href="#cb35-138" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb35-139"><a href="#cb35-139" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb35-140"><a href="#cb35-140" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">4</span>, <span class="st">"mm"</span>),</span>
<span id="cb35-141"><a href="#cb35-141" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>))</span>
<span id="cb35-142"><a href="#cb35-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-143"><a href="#cb35-143" aria-hidden="true" tabindex="-1"></a>age_dist <span class="ot">&lt;-</span> sealdat <span class="sc">%&gt;%</span> </span>
<span id="cb35-144"><a href="#cb35-144" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(age <span class="sc">&lt;</span> <span class="dv">22</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-145"><a href="#cb35-145" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age) <span class="sc">%&gt;%</span> </span>
<span id="cb35-146"><a href="#cb35-146" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(age) <span class="sc">%&gt;%</span> </span>
<span id="cb35-147"><a href="#cb35-147" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> n)) <span class="sc">+</span> </span>
<span id="cb35-148"><a href="#cb35-148" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"grey50"</span>) <span class="sc">+</span> </span>
<span id="cb35-149"><a href="#cb35-149" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age (Years)"</span>, <span class="at">y =</span> <span class="st">"Number of individuals"</span>) <span class="sc">+</span> </span>
<span id="cb35-150"><a href="#cb35-150" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>()</span>
<span id="cb35-151"><a href="#cb35-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-152"><a href="#cb35-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-153"><a href="#cb35-153" aria-hidden="true" tabindex="-1"></a>(sighting_img <span class="sc">|</span> age_dist) <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">widths =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>)) <span class="sc">+</span> <span class="fu">plot_annotation</span>(<span class="at">tag_levels =</span> <span class="st">"A"</span>)</span>
<span id="cb35-154"><a href="#cb35-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-155"><a href="#cb35-155" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-156"><a href="#cb35-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-157"><a href="#cb35-157" aria-hidden="true" tabindex="-1"></a><span class="fu">### H1: Reproductive senescence</span></span>
<span id="cb35-158"><a href="#cb35-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-159"><a href="#cb35-159" aria-hidden="true" tabindex="-1"></a>We predicted that breeding success would decline with age. Based on the literature, we chose age <span class="in">`r age_senesce`</span> to be the end of prime age and indicate the onset of senescence. If breeding success declined with age, we would expect to see a negative slope post-senescence (@fig-breeding-mod).</span>
<span id="cb35-160"><a href="#cb35-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-163"><a href="#cb35-163" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-164"><a href="#cb35-164" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: breeding-mod</span></span>
<span id="cb35-165"><a href="#cb35-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-166"><a href="#cb35-166" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit GLMMs to the data with binary variable indicating before and after onset # of senescence. We a priori chose age 11 for senescence (age_senesce).</span></span>
<span id="cb35-167"><a href="#cb35-167" aria-hidden="true" tabindex="-1"></a>breed_age_mod <span class="ot">&lt;-</span> <span class="fu">glmer</span>(</span>
<span id="cb35-168"><a href="#cb35-168" aria-hidden="true" tabindex="-1"></a>  observed_int <span class="sc">~</span> age10 <span class="sc">:</span> age_cat <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> animalID) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> year_fct),</span>
<span id="cb35-169"><a href="#cb35-169" aria-hidden="true" tabindex="-1"></a>  sealdat,</span>
<span id="cb35-170"><a href="#cb35-170" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="st">"binomial"</span>,</span>
<span id="cb35-171"><a href="#cb35-171" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">glmerControl</span>(<span class="at">optimizer =</span> <span class="st">"bobyqa"</span>)</span>
<span id="cb35-172"><a href="#cb35-172" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-173"><a href="#cb35-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-174"><a href="#cb35-174" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(breed_age_mod)<span class="sc">$</span>coefficients</span>
<span id="cb35-175"><a href="#cb35-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-176"><a href="#cb35-176" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-177"><a href="#cb35-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-180"><a href="#cb35-180" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-181"><a href="#cb35-181" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-breeding-mod</span></span>
<span id="cb35-182"><a href="#cb35-182" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Breeding probability for adult female elephant seals increased up to age 11, and decreased above it, providing evidence for reproductive senescence. Black points and error bars show the mean and 95% CI of breeding rates. Sample sizes for each age class are included above the points. Thin gray lines show the mean response for each year of the study (i.e., including the random effect of year). The thick solid lines and shaded areas show the mean response and 95% confidence interval of the fitted model, weighted by the number of seals observed in each year. The unweighted fitted model is shown by the dotted gray line. The weighted model is emphasized because of the large impact of the random effect of year."</span></span>
<span id="cb35-183"><a href="#cb35-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-184"><a href="#cb35-184" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize the raw data</span></span>
<span id="cb35-185"><a href="#cb35-185" aria-hidden="true" tabindex="-1"></a>breed_nonbreed <span class="ot">&lt;-</span> sealdat <span class="sc">%&gt;%</span></span>
<span id="cb35-186"><a href="#cb35-186" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age) <span class="sc">%&gt;%</span></span>
<span id="cb35-187"><a href="#cb35-187" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n_observed =</span> <span class="fu">n</span>(),</span>
<span id="cb35-188"><a href="#cb35-188" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_breed =</span> <span class="fu">sum</span>(observed_int),</span>
<span id="cb35-189"><a href="#cb35-189" aria-hidden="true" tabindex="-1"></a>            <span class="at">perc_breed =</span> n_breed <span class="sc">/</span> n_observed,</span>
<span id="cb35-190"><a href="#cb35-190" aria-hidden="true" tabindex="-1"></a>            <span class="at">breed_lwr =</span> <span class="fu">binom.test</span>(n_breed, n_observed)<span class="sc">$</span>conf.int[<span class="dv">1</span>],</span>
<span id="cb35-191"><a href="#cb35-191" aria-hidden="true" tabindex="-1"></a>            <span class="at">breed_upr =</span> <span class="fu">binom.test</span>(n_breed, n_observed)<span class="sc">$</span>conf.int[<span class="dv">2</span>]) <span class="sc">%&gt;%</span></span>
<span id="cb35-192"><a href="#cb35-192" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(age <span class="sc">&lt;=</span> <span class="dv">20</span>)</span>
<span id="cb35-193"><a href="#cb35-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-194"><a href="#cb35-194" aria-hidden="true" tabindex="-1"></a><span class="co">#Create sample size data frame</span></span>
<span id="cb35-195"><a href="#cb35-195" aria-hidden="true" tabindex="-1"></a>n_breed <span class="ot">&lt;-</span> sealdat <span class="sc">%&gt;%</span> </span>
<span id="cb35-196"><a href="#cb35-196" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(age <span class="sc">&lt;=</span> <span class="dv">20</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-197"><a href="#cb35-197" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(age)</span>
<span id="cb35-198"><a href="#cb35-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-199"><a href="#cb35-199" aria-hidden="true" tabindex="-1"></a><span class="co"># Create ANNUAL (i.e. rand effect of year only) predictions</span></span>
<span id="cb35-200"><a href="#cb35-200" aria-hidden="true" tabindex="-1"></a>breed_pred_years <span class="ot">&lt;-</span> <span class="fu">ggpredict</span>(</span>
<span id="cb35-201"><a href="#cb35-201" aria-hidden="true" tabindex="-1"></a>  breed_age_mod, </span>
<span id="cb35-202"><a href="#cb35-202" aria-hidden="true" tabindex="-1"></a>  <span class="at">terms =</span> <span class="fu">c</span>(<span class="st">"age10 [all]"</span>, <span class="st">"age_cat"</span>, <span class="st">"year_fct"</span>),</span>
<span id="cb35-203"><a href="#cb35-203" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"random"</span></span>
<span id="cb35-204"><a href="#cb35-204" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-205"><a href="#cb35-205" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb35-206"><a href="#cb35-206" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age =</span> x <span class="sc">*</span> <span class="dv">10</span> <span class="sc">+</span> age_senesce,</span>
<span id="cb35-207"><a href="#cb35-207" aria-hidden="true" tabindex="-1"></a>         <span class="at">age_cat =</span> <span class="fu">factor</span>(group, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Young"</span>, <span class="st">"Old"</span>)),</span>
<span id="cb35-208"><a href="#cb35-208" aria-hidden="true" tabindex="-1"></a>         <span class="at">year_fct =</span> <span class="fu">factor</span>(facet)) <span class="sc">%&gt;%</span> </span>
<span id="cb35-209"><a href="#cb35-209" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>((age_cat <span class="sc">==</span> <span class="st">"Young"</span> <span class="sc">&amp;</span> age <span class="sc">&lt;</span> age_senesce) <span class="sc">|</span></span>
<span id="cb35-210"><a href="#cb35-210" aria-hidden="true" tabindex="-1"></a>           (age_cat <span class="sc">==</span> <span class="st">"Old"</span> <span class="sc">&amp;</span> age <span class="sc">&gt;=</span> age_senesce),</span>
<span id="cb35-211"><a href="#cb35-211" aria-hidden="true" tabindex="-1"></a>         age <span class="sc">&lt;=</span> <span class="dv">20</span>)</span>
<span id="cb35-212"><a href="#cb35-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-213"><a href="#cb35-213" aria-hidden="true" tabindex="-1"></a><span class="co"># Create WEIGHTED-AVERAGE predictions using years' random effects</span></span>
<span id="cb35-214"><a href="#cb35-214" aria-hidden="true" tabindex="-1"></a><span class="co"># ggpredict can't do that for confidence intervals</span></span>
<span id="cb35-215"><a href="#cb35-215" aria-hidden="true" tabindex="-1"></a><span class="co"># create prediction grid</span></span>
<span id="cb35-216"><a href="#cb35-216" aria-hidden="true" tabindex="-1"></a>breed_grid <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(</span>
<span id="cb35-217"><a href="#cb35-217" aria-hidden="true" tabindex="-1"></a>  <span class="at">age =</span> <span class="dv">4</span><span class="sc">:</span><span class="dv">20</span>,</span>
<span id="cb35-218"><a href="#cb35-218" aria-hidden="true" tabindex="-1"></a>  <span class="at">year_fct =</span> <span class="fu">factor</span>(<span class="dv">1988</span><span class="sc">:</span><span class="dv">2023</span>)</span>
<span id="cb35-219"><a href="#cb35-219" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-220"><a href="#cb35-220" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age10 =</span> (age <span class="sc">-</span> age_senesce) <span class="sc">/</span> <span class="dv">10</span>,</span>
<span id="cb35-221"><a href="#cb35-221" aria-hidden="true" tabindex="-1"></a>         <span class="at">age_cat =</span> <span class="fu">factor</span>(<span class="fu">ifelse</span>(age <span class="sc">&lt;</span> age_senesce, <span class="st">"Young"</span>, <span class="st">"Old"</span>),</span>
<span id="cb35-222"><a href="#cb35-222" aria-hidden="true" tabindex="-1"></a>                          <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Young"</span>, <span class="st">"Old"</span>)))</span>
<span id="cb35-223"><a href="#cb35-223" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-224"><a href="#cb35-224" aria-hidden="true" tabindex="-1"></a>seal_years <span class="ot">&lt;-</span> <span class="fu">count</span>(sealdat, year_fct)</span>
<span id="cb35-225"><a href="#cb35-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-226"><a href="#cb35-226" aria-hidden="true" tabindex="-1"></a>breed_pred_wgt <span class="ot">&lt;-</span> breed_grid <span class="sc">%&gt;%</span> </span>
<span id="cb35-227"><a href="#cb35-227" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">predicted =</span> <span class="fu">predict</span>(breed_age_mod, </span>
<span id="cb35-228"><a href="#cb35-228" aria-hidden="true" tabindex="-1"></a>                             <span class="at">newdata =</span> breed_grid,</span>
<span id="cb35-229"><a href="#cb35-229" aria-hidden="true" tabindex="-1"></a>                             <span class="at">re.form =</span> <span class="sc">~</span> (<span class="dv">1</span> <span class="sc">|</span> year_fct)),</span>
<span id="cb35-230"><a href="#cb35-230" aria-hidden="true" tabindex="-1"></a>         <span class="at">predicted_se =</span> <span class="fu">suppressWarnings</span>(</span>
<span id="cb35-231"><a href="#cb35-231" aria-hidden="true" tabindex="-1"></a>           <span class="co"># warning: "se.fit computation uses an approximation to estimate the sampling distribution of the parameters"</span></span>
<span id="cb35-232"><a href="#cb35-232" aria-hidden="true" tabindex="-1"></a>           <span class="fu">predict</span>(breed_age_mod, </span>
<span id="cb35-233"><a href="#cb35-233" aria-hidden="true" tabindex="-1"></a>                   <span class="at">newdata =</span> breed_grid,</span>
<span id="cb35-234"><a href="#cb35-234" aria-hidden="true" tabindex="-1"></a>                   <span class="at">re.form =</span> <span class="cn">NA</span>,</span>
<span id="cb35-235"><a href="#cb35-235" aria-hidden="true" tabindex="-1"></a>                   <span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb35-236"><a href="#cb35-236" aria-hidden="true" tabindex="-1"></a>         )<span class="sc">$</span>se.fit,</span>
<span id="cb35-237"><a href="#cb35-237" aria-hidden="true" tabindex="-1"></a>         <span class="at">predicted_pop =</span> <span class="fu">predict</span>(breed_age_mod, </span>
<span id="cb35-238"><a href="#cb35-238" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">newdata =</span> breed_grid,</span>
<span id="cb35-239"><a href="#cb35-239" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">re.form =</span> <span class="cn">NA</span>),</span>
<span id="cb35-240"><a href="#cb35-240" aria-hidden="true" tabindex="-1"></a>         <span class="at">conf_lo =</span> predicted <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> predicted_se,</span>
<span id="cb35-241"><a href="#cb35-241" aria-hidden="true" tabindex="-1"></a>         <span class="at">conf_hi =</span> predicted <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> predicted_se) <span class="sc">%&gt;%</span> </span>
<span id="cb35-242"><a href="#cb35-242" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(seal_years, <span class="at">by =</span> <span class="st">"year_fct"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-243"><a href="#cb35-243" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age, age_cat) <span class="sc">%&gt;%</span> </span>
<span id="cb35-244"><a href="#cb35-244" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">c</span>(predicted, predicted_pop, conf_lo, conf_hi), </span>
<span id="cb35-245"><a href="#cb35-245" aria-hidden="true" tabindex="-1"></a>                   \(x) <span class="fu">weighted.mean</span>(x, n)),</span>
<span id="cb35-246"><a href="#cb35-246" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-247"><a href="#cb35-247" aria-hidden="true" tabindex="-1"></a>  <span class="co"># invert logit</span></span>
<span id="cb35-248"><a href="#cb35-248" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(predicted, predicted_pop, conf_lo, conf_hi), </span>
<span id="cb35-249"><a href="#cb35-249" aria-hidden="true" tabindex="-1"></a>                <span class="fu">family</span>(breed_age_mod)<span class="sc">$</span>linkinv)) <span class="sc">%&gt;%</span> </span>
<span id="cb35-250"><a href="#cb35-250" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(n_breed, <span class="at">by =</span> <span class="st">"age"</span>) </span>
<span id="cb35-251"><a href="#cb35-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-252"><a href="#cb35-252" aria-hidden="true" tabindex="-1"></a>breed_pred_wgt <span class="sc">%&gt;%</span> <span class="fu">filter</span>(age <span class="sc">&gt;</span> <span class="dv">9</span>, </span>
<span id="cb35-253"><a href="#cb35-253" aria-hidden="true" tabindex="-1"></a>                          age <span class="sc">&lt;</span><span class="dv">13</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-254"><a href="#cb35-254" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_breed =</span> <span class="fu">mean</span>(predicted))</span>
<span id="cb35-255"><a href="#cb35-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-256"><a href="#cb35-256" aria-hidden="true" tabindex="-1"></a>breed_pred_wgt <span class="sc">%&gt;%</span> </span>
<span id="cb35-257"><a href="#cb35-257" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">perc_pop =</span> n<span class="sc">/</span><span class="fu">sum</span>(n), </span>
<span id="cb35-258"><a href="#cb35-258" aria-hidden="true" tabindex="-1"></a>         <span class="at">pred_pups =</span> n <span class="sc">*</span> predicted)</span>
<span id="cb35-259"><a href="#cb35-259" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-260"><a href="#cb35-260" aria-hidden="true" tabindex="-1"></a>breed_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(breed_pred_wgt, <span class="fu">aes</span>(age, predicted)) <span class="sc">+</span></span>
<span id="cb35-261"><a href="#cb35-261" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Predictions for individual years</span></span>
<span id="cb35-262"><a href="#cb35-262" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> <span class="fu">interaction</span>(age_cat, year_fct)),</span>
<span id="cb35-263"><a href="#cb35-263" aria-hidden="true" tabindex="-1"></a>            breed_pred_years,</span>
<span id="cb35-264"><a href="#cb35-264" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb35-265"><a href="#cb35-265" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Weighted model (CI and mean response)</span></span>
<span id="cb35-266"><a href="#cb35-266" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">fill =</span> age_cat, <span class="at">ymin =</span> conf_lo, <span class="at">ymax =</span> conf_hi), </span>
<span id="cb35-267"><a href="#cb35-267" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb35-268"><a href="#cb35-268" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> age_cat),</span>
<span id="cb35-269"><a href="#cb35-269" aria-hidden="true" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb35-270"><a href="#cb35-270" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Population-level mean response</span></span>
<span id="cb35-271"><a href="#cb35-271" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> predicted_pop, <span class="at">group =</span> age_cat),</span>
<span id="cb35-272"><a href="#cb35-272" aria-hidden="true" tabindex="-1"></a>            <span class="at">linetype =</span> <span class="st">"dotted"</span>,</span>
<span id="cb35-273"><a href="#cb35-273" aria-hidden="true" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="fl">1.2</span>,</span>
<span id="cb35-274"><a href="#cb35-274" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb35-275"><a href="#cb35-275" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Summarized raw data</span></span>
<span id="cb35-276"><a href="#cb35-276" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">y =</span> perc_breed,</span>
<span id="cb35-277"><a href="#cb35-277" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ymin =</span> breed_lwr,</span>
<span id="cb35-278"><a href="#cb35-278" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ymax =</span> breed_upr),</span>
<span id="cb35-279"><a href="#cb35-279" aria-hidden="true" tabindex="-1"></a>                  breed_nonbreed) <span class="sc">+</span></span>
<span id="cb35-280"><a href="#cb35-280" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> age_senesce <span class="sc">-</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb35-281"><a href="#cb35-281" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Breeding probability"</span>, </span>
<span id="cb35-282"><a href="#cb35-282" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> scales<span class="sc">::</span>percent,</span>
<span id="cb35-283"><a href="#cb35-283" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="fl">0.4</span>, <span class="fl">1.0</span>, <span class="at">by =</span> <span class="fl">0.1</span>)) <span class="sc">+</span></span>
<span id="cb35-284"><a href="#cb35-284" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#7fbc41"</span>, <span class="st">"#de77ae"</span>)) <span class="sc">+</span></span>
<span id="cb35-285"><a href="#cb35-285" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#7fbc41"</span>, <span class="st">"#de77ae"</span>)) <span class="sc">+</span></span>
<span id="cb35-286"><a href="#cb35-286" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">0.68</span>, <span class="fl">1.02</span>)) <span class="sc">+</span></span>
<span id="cb35-287"><a href="#cb35-287" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age (years)"</span>) <span class="sc">+</span></span>
<span id="cb35-288"><a href="#cb35-288" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span> </span>
<span id="cb35-289"><a href="#cb35-289" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> n), <span class="at">y =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>)</span>
<span id="cb35-290"><a href="#cb35-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-291"><a href="#cb35-291" aria-hidden="true" tabindex="-1"></a>breed_plot</span>
<span id="cb35-292"><a href="#cb35-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-293"><a href="#cb35-293" aria-hidden="true" tabindex="-1"></a><span class="co">#ggsave("outputs/repro_senesce.svg", breed_plot, width = 13, height = 6, units = "in")</span></span>
<span id="cb35-294"><a href="#cb35-294" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-295"><a href="#cb35-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-298"><a href="#cb35-298" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-299"><a href="#cb35-299" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: h1-pred-deets</span></span>
<span id="cb35-300"><a href="#cb35-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-301"><a href="#cb35-301" aria-hidden="true" tabindex="-1"></a><span class="fu">pnorm</span>(<span class="fu">summary</span>(breed_age_mod)<span class="sc">$</span>coef[<span class="st">"age10:age_catOld"</span>, <span class="st">"z value"</span>])</span>
<span id="cb35-302"><a href="#cb35-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-303"><a href="#cb35-303" aria-hidden="true" tabindex="-1"></a><span class="co">#Overall decline 11-19</span></span>
<span id="cb35-304"><a href="#cb35-304" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">age =</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">19</span>),</span>
<span id="cb35-305"><a href="#cb35-305" aria-hidden="true" tabindex="-1"></a>       <span class="at">age10 =</span> (age <span class="sc">-</span> age_senesce) <span class="sc">/</span> <span class="dv">10</span>,</span>
<span id="cb35-306"><a href="#cb35-306" aria-hidden="true" tabindex="-1"></a>       <span class="at">age_cat =</span> <span class="st">"Old"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-307"><a href="#cb35-307" aria-hidden="true" tabindex="-1"></a>  <span class="co"># logit-scale predictions</span></span>
<span id="cb35-308"><a href="#cb35-308" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">predicted =</span> <span class="fu">predict</span>(breed_age_mod, </span>
<span id="cb35-309"><a href="#cb35-309" aria-hidden="true" tabindex="-1"></a>                             <span class="at">newdata =</span> .,</span>
<span id="cb35-310"><a href="#cb35-310" aria-hidden="true" tabindex="-1"></a>                             <span class="at">re.form =</span> <span class="cn">NA</span>),</span>
<span id="cb35-311"><a href="#cb35-311" aria-hidden="true" tabindex="-1"></a>         <span class="at">se =</span> <span class="fu">suppressWarnings</span>(<span class="fu">predict</span>(breed_age_mod, </span>
<span id="cb35-312"><a href="#cb35-312" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">newdata =</span> .,</span>
<span id="cb35-313"><a href="#cb35-313" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">se.fit =</span> <span class="cn">TRUE</span>,</span>
<span id="cb35-314"><a href="#cb35-314" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">re.form =</span> <span class="cn">NA</span>)<span class="sc">$</span>se.fit),</span>
<span id="cb35-315"><a href="#cb35-315" aria-hidden="true" tabindex="-1"></a>         <span class="at">pred_lwr =</span> predicted <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> se,</span>
<span id="cb35-316"><a href="#cb35-316" aria-hidden="true" tabindex="-1"></a>         <span class="at">pred_upr =</span> predicted <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> se,</span>
<span id="cb35-317"><a href="#cb35-317" aria-hidden="true" tabindex="-1"></a>         <span class="co"># Invert the logit</span></span>
<span id="cb35-318"><a href="#cb35-318" aria-hidden="true" tabindex="-1"></a>         <span class="fu">across</span>(<span class="fu">c</span>(predicted, pred_upr, pred_lwr), </span>
<span id="cb35-319"><a href="#cb35-319" aria-hidden="true" tabindex="-1"></a>                <span class="fu">family</span>(breed_age_mod)<span class="sc">$</span>linkinv))</span>
<span id="cb35-320"><a href="#cb35-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-321"><a href="#cb35-321" aria-hidden="true" tabindex="-1"></a><span class="co">#Difference between years </span></span>
<span id="cb35-322"><a href="#cb35-322" aria-hidden="true" tabindex="-1"></a>best_worst_yr <span class="ot">&lt;-</span> <span class="fu">ranef</span>(breed_age_mod)<span class="sc">$</span>year_fct <span class="sc">%&gt;%</span> </span>
<span id="cb35-323"><a href="#cb35-323" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="st">"year_fct"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-324"><a href="#cb35-324" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="st">`</span><span class="at">(Intercept)</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-325"><a href="#cb35-325" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(.))</span>
<span id="cb35-326"><a href="#cb35-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-327"><a href="#cb35-327" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">age =</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">19</span>),</span>
<span id="cb35-328"><a href="#cb35-328" aria-hidden="true" tabindex="-1"></a>       <span class="at">age10 =</span> (age <span class="sc">-</span> age_senesce) <span class="sc">/</span> <span class="dv">10</span>,</span>
<span id="cb35-329"><a href="#cb35-329" aria-hidden="true" tabindex="-1"></a>       <span class="at">age_cat =</span> <span class="st">"Old"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-330"><a href="#cb35-330" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cross_join</span>(best_worst_yr) <span class="sc">%&gt;%</span> </span>
<span id="cb35-331"><a href="#cb35-331" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">predicted =</span> <span class="fu">predict</span>(breed_age_mod, </span>
<span id="cb35-332"><a href="#cb35-332" aria-hidden="true" tabindex="-1"></a>                             <span class="at">newdata =</span> .,</span>
<span id="cb35-333"><a href="#cb35-333" aria-hidden="true" tabindex="-1"></a>                             <span class="at">type =</span> <span class="st">"response"</span>, </span>
<span id="cb35-334"><a href="#cb35-334" aria-hidden="true" tabindex="-1"></a>                             <span class="at">re.form =</span> <span class="sc">~</span> (<span class="dv">1</span> <span class="sc">|</span> year_fct)))</span>
<span id="cb35-335"><a href="#cb35-335" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-336"><a href="#cb35-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-337"><a href="#cb35-337" aria-hidden="true" tabindex="-1"></a>Sample size n = <span class="in">`r nrow(sealdat)`</span> observations of <span class="in">`r n_distinct(sealdat$animalID)`</span> individuals.</span>
<span id="cb35-338"><a href="#cb35-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-339"><a href="#cb35-339" aria-hidden="true" tabindex="-1"></a><span class="fu">### H2: Maternal effect senescence</span></span>
<span id="cb35-340"><a href="#cb35-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-341"><a href="#cb35-341" aria-hidden="true" tabindex="-1"></a>We predicted that reproductive declines would carry over to the next generation - that is, pups born to older mothers would have decreased survival (for female and male pups) and reproductive success (for female pups). Pup survival significantly decreased with maternal age, but pup reproduction did not (@fig-repro-age).</span>
<span id="cb35-342"><a href="#cb35-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-345"><a href="#cb35-345" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-346"><a href="#cb35-346" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: repro-age</span></span>
<span id="cb35-347"><a href="#cb35-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-348"><a href="#cb35-348" aria-hidden="true" tabindex="-1"></a><span class="co"># Isolate pup survival/recruitment </span></span>
<span id="cb35-349"><a href="#cb35-349" aria-hidden="true" tabindex="-1"></a>surv_recr_data <span class="ot">&lt;-</span> sealdat <span class="sc">%&gt;%</span> </span>
<span id="cb35-350"><a href="#cb35-350" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(pupID) <span class="sc">%&gt;%</span> </span>
<span id="cb35-351"><a href="#cb35-351" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Only pups born 2016 or earlier (otherwise survival biased)</span></span>
<span id="cb35-352"><a href="#cb35-352" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(pupyearborn <span class="sc">&lt;=</span> <span class="dv">2016</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-353"><a href="#cb35-353" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(age <span class="sc">&lt;</span> <span class="dv">20</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-354"><a href="#cb35-354" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pup_surv_int =</span> <span class="fu">as.integer</span>(pup_survived),</span>
<span id="cb35-355"><a href="#cb35-355" aria-hidden="true" tabindex="-1"></a>         <span class="at">pup_recr_int =</span> <span class="fu">as.integer</span>(puprecruited)) </span>
<span id="cb35-356"><a href="#cb35-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-357"><a href="#cb35-357" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit pup *survival* model</span></span>
<span id="cb35-358"><a href="#cb35-358" aria-hidden="true" tabindex="-1"></a>pup_surv_mod <span class="ot">&lt;-</span> <span class="fu">glmer</span>(</span>
<span id="cb35-359"><a href="#cb35-359" aria-hidden="true" tabindex="-1"></a>  pup_surv_int <span class="sc">~</span> age10 <span class="sc">:</span> age_cat <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> animalID) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> year_fct),</span>
<span id="cb35-360"><a href="#cb35-360" aria-hidden="true" tabindex="-1"></a>  surv_recr_data,</span>
<span id="cb35-361"><a href="#cb35-361" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="st">"binomial"</span>,</span>
<span id="cb35-362"><a href="#cb35-362" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">glmerControl</span>(<span class="at">optimizer =</span> <span class="st">"bobyqa"</span>)</span>
<span id="cb35-363"><a href="#cb35-363" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-364"><a href="#cb35-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-365"><a href="#cb35-365" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit pup *recruitment* model (female offspring only)</span></span>
<span id="cb35-366"><a href="#cb35-366" aria-hidden="true" tabindex="-1"></a>pup_recr_mod <span class="ot">&lt;-</span> <span class="fu">glmer</span>(</span>
<span id="cb35-367"><a href="#cb35-367" aria-hidden="true" tabindex="-1"></a>  <span class="co"># </span><span class="al">NOTE</span><span class="co">: no random effect for individual bc singular fit</span></span>
<span id="cb35-368"><a href="#cb35-368" aria-hidden="true" tabindex="-1"></a>  <span class="co"># In survival model, 93 individuals (15%) had &gt;3 pups (male+female pups)</span></span>
<span id="cb35-369"><a href="#cb35-369" aria-hidden="true" tabindex="-1"></a>  <span class="co"># In recruit model, only 17 individuals (4%) had &gt;3 pups (female pups only)</span></span>
<span id="cb35-370"><a href="#cb35-370" aria-hidden="true" tabindex="-1"></a>  pup_recr_int <span class="sc">~</span> age10 <span class="sc">:</span> age_cat <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> year_fct),</span>
<span id="cb35-371"><a href="#cb35-371" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(surv_recr_data, pupsex <span class="sc">==</span> <span class="st">"F"</span>),</span>
<span id="cb35-372"><a href="#cb35-372" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="st">"binomial"</span>,</span>
<span id="cb35-373"><a href="#cb35-373" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">glmerControl</span>(<span class="at">optimizer =</span> <span class="st">"bobyqa"</span>)</span>
<span id="cb35-374"><a href="#cb35-374" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-375"><a href="#cb35-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-376"><a href="#cb35-376" aria-hidden="true" tabindex="-1"></a><span class="st">"Survival"</span></span>
<span id="cb35-377"><a href="#cb35-377" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pup_surv_mod)<span class="sc">$</span>coefficients</span>
<span id="cb35-378"><a href="#cb35-378" aria-hidden="true" tabindex="-1"></a><span class="st">"Recruitment"</span></span>
<span id="cb35-379"><a href="#cb35-379" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pup_recr_mod)<span class="sc">$</span>coefficients</span>
<span id="cb35-380"><a href="#cb35-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-381"><a href="#cb35-381" aria-hidden="true" tabindex="-1"></a><span class="co">#survival 1 tailed</span></span>
<span id="cb35-382"><a href="#cb35-382" aria-hidden="true" tabindex="-1"></a><span class="fu">pnorm</span>(<span class="fu">summary</span>(pup_surv_mod)<span class="sc">$</span>coef[<span class="st">"age10:age_catOld"</span>, <span class="st">"z value"</span>])</span>
<span id="cb35-383"><a href="#cb35-383" aria-hidden="true" tabindex="-1"></a><span class="co">#recruit 1 tailed</span></span>
<span id="cb35-384"><a href="#cb35-384" aria-hidden="true" tabindex="-1"></a><span class="fu">pnorm</span>(<span class="fu">summary</span>(pup_recr_mod)<span class="sc">$</span>coef[<span class="st">"age10:age_catOld"</span>, <span class="st">"z value"</span>])</span>
<span id="cb35-385"><a href="#cb35-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-386"><a href="#cb35-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-387"><a href="#cb35-387" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-388"><a href="#cb35-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-391"><a href="#cb35-391" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-392"><a href="#cb35-392" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-repro-age</span></span>
<span id="cb35-393"><a href="#cb35-393" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb35-394"><a href="#cb35-394" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 8</span></span>
<span id="cb35-395"><a href="#cb35-395" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Elephant seal pup survival (A) but not recruitment (B) decreased with maternal age above the threshold age of 11 years. Both males and females were included in the survival analysis, but only females were included for recruitment. This caused some values of recruitment to be higher than survival at the same maternal age. Black points and error bars show means and 95% CI of survival or recruitment for each maternal age. Sample sizes for each age class are included above the points. Thin gray lines show the mean response for each year of the study (i.e., including the random effect of year). Thick dashed and solid lines show the weighted mean response and 95% CI, with solid lines indicating significant trends. The unweighted fitted model is indicated by a dotted gray line. The weighted model is emphasized because of the large impact of the random effect of year."</span></span>
<span id="cb35-396"><a href="#cb35-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-397"><a href="#cb35-397" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize the raw data</span></span>
<span id="cb35-398"><a href="#cb35-398" aria-hidden="true" tabindex="-1"></a>surv_summ <span class="ot">&lt;-</span> surv_recr_data <span class="sc">%&gt;%</span> </span>
<span id="cb35-399"><a href="#cb35-399" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age) <span class="sc">%&gt;%</span> </span>
<span id="cb35-400"><a href="#cb35-400" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(age <span class="sc">&lt;=</span> <span class="dv">19</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-401"><a href="#cb35-401" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n_pups =</span> <span class="fu">n</span>(), </span>
<span id="cb35-402"><a href="#cb35-402" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_surv =</span> <span class="fu">sum</span>(pup_surv_int),</span>
<span id="cb35-403"><a href="#cb35-403" aria-hidden="true" tabindex="-1"></a>            <span class="at">perc_surv =</span> n_surv <span class="sc">/</span> n_pups, </span>
<span id="cb35-404"><a href="#cb35-404" aria-hidden="true" tabindex="-1"></a>            <span class="at">surv_lwr =</span> <span class="fu">binom.test</span>(n_surv, n_pups)<span class="sc">$</span>conf.int[<span class="dv">1</span>],</span>
<span id="cb35-405"><a href="#cb35-405" aria-hidden="true" tabindex="-1"></a>            <span class="at">surv_upr =</span> <span class="fu">binom.test</span>(n_surv, n_pups)<span class="sc">$</span>conf.int[<span class="dv">2</span>])</span>
<span id="cb35-406"><a href="#cb35-406" aria-hidden="true" tabindex="-1"></a>recr_summ <span class="ot">&lt;-</span> surv_recr_data <span class="sc">%&gt;%</span> </span>
<span id="cb35-407"><a href="#cb35-407" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(pupsex <span class="sc">==</span> <span class="st">"F"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-408"><a href="#cb35-408" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age) <span class="sc">%&gt;%</span> </span>
<span id="cb35-409"><a href="#cb35-409" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n_fpups =</span> <span class="fu">n</span>(), </span>
<span id="cb35-410"><a href="#cb35-410" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_recr =</span> <span class="fu">sum</span>(pup_recr_int),</span>
<span id="cb35-411"><a href="#cb35-411" aria-hidden="true" tabindex="-1"></a>            <span class="at">perc_recr =</span> n_recr <span class="sc">/</span> n_fpups, </span>
<span id="cb35-412"><a href="#cb35-412" aria-hidden="true" tabindex="-1"></a>            <span class="at">recr_lwr =</span> <span class="fu">binom.test</span>(n_recr, n_fpups)<span class="sc">$</span>conf.int[<span class="dv">1</span>],</span>
<span id="cb35-413"><a href="#cb35-413" aria-hidden="true" tabindex="-1"></a>            <span class="at">recr_upr =</span> <span class="fu">binom.test</span>(n_recr, n_fpups)<span class="sc">$</span>conf.int[<span class="dv">2</span>])</span>
<span id="cb35-414"><a href="#cb35-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-415"><a href="#cb35-415" aria-hidden="true" tabindex="-1"></a><span class="co">#Create sample size data frame</span></span>
<span id="cb35-416"><a href="#cb35-416" aria-hidden="true" tabindex="-1"></a>n_surv <span class="ot">&lt;-</span> surv_recr_data <span class="sc">%&gt;%</span> </span>
<span id="cb35-417"><a href="#cb35-417" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(age <span class="sc">&lt;=</span> <span class="dv">19</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-418"><a href="#cb35-418" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(age)</span>
<span id="cb35-419"><a href="#cb35-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-420"><a href="#cb35-420" aria-hidden="true" tabindex="-1"></a><span class="co"># Create pup survival predictions (population-level and weighted by year)</span></span>
<span id="cb35-421"><a href="#cb35-421" aria-hidden="true" tabindex="-1"></a>surv_grid <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(</span>
<span id="cb35-422"><a href="#cb35-422" aria-hidden="true" tabindex="-1"></a>  <span class="at">age =</span> <span class="dv">4</span><span class="sc">:</span><span class="dv">19</span>,</span>
<span id="cb35-423"><a href="#cb35-423" aria-hidden="true" tabindex="-1"></a>  <span class="at">year_fct =</span> <span class="fu">factor</span>(<span class="dv">1988</span><span class="sc">:</span><span class="dv">2016</span>)</span>
<span id="cb35-424"><a href="#cb35-424" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-425"><a href="#cb35-425" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age10 =</span> (age <span class="sc">-</span> age_senesce) <span class="sc">/</span> <span class="dv">10</span>,</span>
<span id="cb35-426"><a href="#cb35-426" aria-hidden="true" tabindex="-1"></a>         <span class="at">age_cat =</span> <span class="fu">factor</span>(<span class="fu">ifelse</span>(age <span class="sc">&lt;</span> age_senesce, <span class="st">"Young"</span>, <span class="st">"Old"</span>),</span>
<span id="cb35-427"><a href="#cb35-427" aria-hidden="true" tabindex="-1"></a>                          <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Young"</span>, <span class="st">"Old"</span>)))</span>
<span id="cb35-428"><a href="#cb35-428" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-429"><a href="#cb35-429" aria-hidden="true" tabindex="-1"></a>surv_years <span class="ot">&lt;-</span> <span class="fu">count</span>(surv_recr_data, year_fct)</span>
<span id="cb35-430"><a href="#cb35-430" aria-hidden="true" tabindex="-1"></a>surv_pred_wgt <span class="ot">&lt;-</span> surv_grid <span class="sc">%&gt;%</span> </span>
<span id="cb35-431"><a href="#cb35-431" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">predicted =</span> <span class="fu">predict</span>(pup_surv_mod, </span>
<span id="cb35-432"><a href="#cb35-432" aria-hidden="true" tabindex="-1"></a>                             <span class="at">newdata =</span> surv_grid,</span>
<span id="cb35-433"><a href="#cb35-433" aria-hidden="true" tabindex="-1"></a>                             <span class="at">re.form =</span> <span class="sc">~</span> (<span class="dv">1</span> <span class="sc">|</span> year_fct)),</span>
<span id="cb35-434"><a href="#cb35-434" aria-hidden="true" tabindex="-1"></a>         <span class="at">predicted_se =</span> <span class="fu">suppressWarnings</span>(</span>
<span id="cb35-435"><a href="#cb35-435" aria-hidden="true" tabindex="-1"></a>           <span class="co"># warning: "se.fit computation uses an approximation to estimate the sampling distribution of the parameters"</span></span>
<span id="cb35-436"><a href="#cb35-436" aria-hidden="true" tabindex="-1"></a>           <span class="fu">predict</span>(pup_surv_mod, </span>
<span id="cb35-437"><a href="#cb35-437" aria-hidden="true" tabindex="-1"></a>                   <span class="at">newdata =</span> surv_grid,</span>
<span id="cb35-438"><a href="#cb35-438" aria-hidden="true" tabindex="-1"></a>                   <span class="at">re.form =</span> <span class="cn">NA</span>,</span>
<span id="cb35-439"><a href="#cb35-439" aria-hidden="true" tabindex="-1"></a>                   <span class="at">se.fit =</span> <span class="cn">TRUE</span>),</span>
<span id="cb35-440"><a href="#cb35-440" aria-hidden="true" tabindex="-1"></a>         )<span class="sc">$</span>se.fit,</span>
<span id="cb35-441"><a href="#cb35-441" aria-hidden="true" tabindex="-1"></a>         <span class="at">predicted_pop =</span> <span class="fu">predict</span>(pup_surv_mod, </span>
<span id="cb35-442"><a href="#cb35-442" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">newdata =</span> surv_grid,</span>
<span id="cb35-443"><a href="#cb35-443" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">re.form =</span> <span class="cn">NA</span>),</span>
<span id="cb35-444"><a href="#cb35-444" aria-hidden="true" tabindex="-1"></a>         <span class="at">conf_lo =</span> predicted <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> predicted_se,</span>
<span id="cb35-445"><a href="#cb35-445" aria-hidden="true" tabindex="-1"></a>         <span class="at">conf_hi =</span> predicted <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> predicted_se) <span class="sc">%&gt;%</span> </span>
<span id="cb35-446"><a href="#cb35-446" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(surv_years, <span class="at">by =</span> <span class="st">"year_fct"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-447"><a href="#cb35-447" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age, age_cat) <span class="sc">%&gt;%</span> </span>
<span id="cb35-448"><a href="#cb35-448" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">c</span>(predicted, predicted_pop, conf_lo, conf_hi), </span>
<span id="cb35-449"><a href="#cb35-449" aria-hidden="true" tabindex="-1"></a>                   \(x) <span class="fu">weighted.mean</span>(x, n)),</span>
<span id="cb35-450"><a href="#cb35-450" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-451"><a href="#cb35-451" aria-hidden="true" tabindex="-1"></a>  <span class="co"># invert logit</span></span>
<span id="cb35-452"><a href="#cb35-452" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(predicted, predicted_pop, conf_lo, conf_hi), </span>
<span id="cb35-453"><a href="#cb35-453" aria-hidden="true" tabindex="-1"></a>                <span class="fu">family</span>(pup_surv_mod)<span class="sc">$</span>linkinv)) <span class="sc">%&gt;%</span> </span>
<span id="cb35-454"><a href="#cb35-454" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(n_surv, <span class="at">by =</span> <span class="st">"age"</span>)</span>
<span id="cb35-455"><a href="#cb35-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-456"><a href="#cb35-456" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions for each year (random effect)</span></span>
<span id="cb35-457"><a href="#cb35-457" aria-hidden="true" tabindex="-1"></a>surv_pred_years <span class="ot">&lt;-</span> <span class="fu">ggpredict</span>(</span>
<span id="cb35-458"><a href="#cb35-458" aria-hidden="true" tabindex="-1"></a>  pup_surv_mod,</span>
<span id="cb35-459"><a href="#cb35-459" aria-hidden="true" tabindex="-1"></a>  <span class="at">terms =</span> <span class="fu">c</span>(<span class="st">"age10 [all]"</span>, <span class="st">"age_cat"</span>, <span class="st">"year_fct [all]"</span>),</span>
<span id="cb35-460"><a href="#cb35-460" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"random"</span>,</span>
<span id="cb35-461"><a href="#cb35-461" aria-hidden="true" tabindex="-1"></a>  <span class="at">interval =</span> <span class="st">"confidence"</span></span>
<span id="cb35-462"><a href="#cb35-462" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-463"><a href="#cb35-463" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb35-464"><a href="#cb35-464" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age =</span> x <span class="sc">*</span> <span class="dv">10</span> <span class="sc">+</span> age_senesce,</span>
<span id="cb35-465"><a href="#cb35-465" aria-hidden="true" tabindex="-1"></a>         <span class="at">age_cat =</span> group,</span>
<span id="cb35-466"><a href="#cb35-466" aria-hidden="true" tabindex="-1"></a>         <span class="at">year_fct =</span> facet) <span class="sc">%&gt;%</span> </span>
<span id="cb35-467"><a href="#cb35-467" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>((age_cat <span class="sc">==</span> <span class="st">"Young"</span> <span class="sc">&amp;</span> age <span class="sc">&lt;</span> age_senesce) <span class="sc">|</span></span>
<span id="cb35-468"><a href="#cb35-468" aria-hidden="true" tabindex="-1"></a>           (age_cat <span class="sc">==</span> <span class="st">"Old"</span> <span class="sc">&amp;</span> age <span class="sc">&gt;=</span> age_senesce),</span>
<span id="cb35-469"><a href="#cb35-469" aria-hidden="true" tabindex="-1"></a>         age <span class="sc">&lt;=</span> <span class="dv">20</span>)</span>
<span id="cb35-470"><a href="#cb35-470" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-471"><a href="#cb35-471" aria-hidden="true" tabindex="-1"></a>fig_surv <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(surv_pred_wgt, <span class="fu">aes</span>(age, predicted)) <span class="sc">+</span></span>
<span id="cb35-472"><a href="#cb35-472" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Individual years</span></span>
<span id="cb35-473"><a href="#cb35-473" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> <span class="fu">interaction</span>(age_cat, year_fct)),</span>
<span id="cb35-474"><a href="#cb35-474" aria-hidden="true" tabindex="-1"></a>            surv_pred_years,</span>
<span id="cb35-475"><a href="#cb35-475" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb35-476"><a href="#cb35-476" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Weighted model (confidence interval and mean response)</span></span>
<span id="cb35-477"><a href="#cb35-477" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">fill =</span> age_cat, <span class="at">ymin =</span> conf_lo, <span class="at">ymax =</span> conf_hi), </span>
<span id="cb35-478"><a href="#cb35-478" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb35-479"><a href="#cb35-479" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> age_cat, <span class="at">linetype =</span> age_cat), <span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb35-480"><a href="#cb35-480" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Population-level mean response</span></span>
<span id="cb35-481"><a href="#cb35-481" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> predicted_pop, <span class="at">group =</span> age_cat),</span>
<span id="cb35-482"><a href="#cb35-482" aria-hidden="true" tabindex="-1"></a>            <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">linewidth =</span> <span class="fl">1.2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb35-483"><a href="#cb35-483" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Raw data</span></span>
<span id="cb35-484"><a href="#cb35-484" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">y =</span> perc_surv, </span>
<span id="cb35-485"><a href="#cb35-485" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ymin =</span> surv_lwr, </span>
<span id="cb35-486"><a href="#cb35-486" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ymax =</span> surv_upr),</span>
<span id="cb35-487"><a href="#cb35-487" aria-hidden="true" tabindex="-1"></a>                  surv_summ) <span class="sc">+</span></span>
<span id="cb35-488"><a href="#cb35-488" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Senescence threshold</span></span>
<span id="cb35-489"><a href="#cb35-489" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> age_senesce <span class="sc">-</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb35-490"><a href="#cb35-490" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Offspring survival"</span>, </span>
<span id="cb35-491"><a href="#cb35-491" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb35-492"><a href="#cb35-492" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#7fbc41"</span>, <span class="st">"#de77ae"</span>)) <span class="sc">+</span></span>
<span id="cb35-493"><a href="#cb35-493" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#7fbc41"</span>, <span class="st">"#de77ae"</span>)) <span class="sc">+</span></span>
<span id="cb35-494"><a href="#cb35-494" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dashed"</span>, <span class="st">"solid"</span>)) <span class="sc">+</span></span>
<span id="cb35-495"><a href="#cb35-495" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.6</span>)) <span class="sc">+</span></span>
<span id="cb35-496"><a href="#cb35-496" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>, </span>
<span id="cb35-497"><a href="#cb35-497" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span> </span>
<span id="cb35-498"><a href="#cb35-498" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> n), <span class="at">y =</span> <span class="fl">0.6</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">nudge_x =</span> <span class="fl">0.2</span>)</span>
<span id="cb35-499"><a href="#cb35-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-500"><a href="#cb35-500" aria-hidden="true" tabindex="-1"></a><span class="co">#Create sample size data frame</span></span>
<span id="cb35-501"><a href="#cb35-501" aria-hidden="true" tabindex="-1"></a>n_recruit <span class="ot">&lt;-</span> surv_recr_data <span class="sc">%&gt;%</span> </span>
<span id="cb35-502"><a href="#cb35-502" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(pupsex <span class="sc">==</span> <span class="st">"F"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-503"><a href="#cb35-503" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(age)</span>
<span id="cb35-504"><a href="#cb35-504" aria-hidden="true" tabindex="-1"></a>n_recruit_indiv <span class="ot">&lt;-</span> surv_recr_data <span class="sc">%&gt;%</span> </span>
<span id="cb35-505"><a href="#cb35-505" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(pupsex <span class="sc">==</span> <span class="st">"F"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-506"><a href="#cb35-506" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(animalID)</span>
<span id="cb35-507"><a href="#cb35-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-508"><a href="#cb35-508" aria-hidden="true" tabindex="-1"></a><span class="co"># Create pup recruitment predictions (population-level and weighted by year)</span></span>
<span id="cb35-509"><a href="#cb35-509" aria-hidden="true" tabindex="-1"></a>recr_grid <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(</span>
<span id="cb35-510"><a href="#cb35-510" aria-hidden="true" tabindex="-1"></a>  <span class="at">age =</span> <span class="dv">4</span><span class="sc">:</span><span class="dv">19</span>,</span>
<span id="cb35-511"><a href="#cb35-511" aria-hidden="true" tabindex="-1"></a>  <span class="at">year_fct =</span> <span class="fu">factor</span>(<span class="dv">1988</span><span class="sc">:</span><span class="dv">2016</span>)</span>
<span id="cb35-512"><a href="#cb35-512" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-513"><a href="#cb35-513" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age10 =</span> (age <span class="sc">-</span> age_senesce) <span class="sc">/</span> <span class="dv">10</span>,</span>
<span id="cb35-514"><a href="#cb35-514" aria-hidden="true" tabindex="-1"></a>         <span class="at">age_cat =</span> <span class="fu">factor</span>(<span class="fu">ifelse</span>(age <span class="sc">&lt;</span> age_senesce, <span class="st">"Young"</span>, <span class="st">"Old"</span>),</span>
<span id="cb35-515"><a href="#cb35-515" aria-hidden="true" tabindex="-1"></a>                          <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Young"</span>, <span class="st">"Old"</span>)))</span>
<span id="cb35-516"><a href="#cb35-516" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-517"><a href="#cb35-517" aria-hidden="true" tabindex="-1"></a>recr_years <span class="ot">&lt;-</span> surv_recr_data <span class="sc">%&gt;%</span> </span>
<span id="cb35-518"><a href="#cb35-518" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(pupsex <span class="sc">==</span> <span class="st">"F"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-519"><a href="#cb35-519" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(year_fct)</span>
<span id="cb35-520"><a href="#cb35-520" aria-hidden="true" tabindex="-1"></a>recr_pred <span class="ot">&lt;-</span> recr_grid <span class="sc">%&gt;%</span> </span>
<span id="cb35-521"><a href="#cb35-521" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">predicted =</span> <span class="fu">predict</span>(pup_recr_mod, </span>
<span id="cb35-522"><a href="#cb35-522" aria-hidden="true" tabindex="-1"></a>                             <span class="at">newdata =</span> recr_grid,</span>
<span id="cb35-523"><a href="#cb35-523" aria-hidden="true" tabindex="-1"></a>                             <span class="at">re.form =</span> <span class="sc">~</span> (<span class="dv">1</span> <span class="sc">|</span> year_fct)),</span>
<span id="cb35-524"><a href="#cb35-524" aria-hidden="true" tabindex="-1"></a>         <span class="at">predicted_se =</span> <span class="fu">suppressWarnings</span>(</span>
<span id="cb35-525"><a href="#cb35-525" aria-hidden="true" tabindex="-1"></a>           <span class="co"># warning: "se.fit computation uses an approximation to estimate the sampling distribution of the parameters"</span></span>
<span id="cb35-526"><a href="#cb35-526" aria-hidden="true" tabindex="-1"></a>           <span class="fu">predict</span>(pup_recr_mod, </span>
<span id="cb35-527"><a href="#cb35-527" aria-hidden="true" tabindex="-1"></a>                   <span class="at">newdata =</span> recr_grid,</span>
<span id="cb35-528"><a href="#cb35-528" aria-hidden="true" tabindex="-1"></a>                   <span class="at">re.form =</span> <span class="cn">NA</span>,</span>
<span id="cb35-529"><a href="#cb35-529" aria-hidden="true" tabindex="-1"></a>                   <span class="at">se.fit =</span> <span class="cn">TRUE</span>),</span>
<span id="cb35-530"><a href="#cb35-530" aria-hidden="true" tabindex="-1"></a>         )<span class="sc">$</span>se.fit,</span>
<span id="cb35-531"><a href="#cb35-531" aria-hidden="true" tabindex="-1"></a>         <span class="at">predicted_pop =</span> <span class="fu">predict</span>(pup_recr_mod, </span>
<span id="cb35-532"><a href="#cb35-532" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">newdata =</span> recr_grid,</span>
<span id="cb35-533"><a href="#cb35-533" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">re.form =</span> <span class="cn">NA</span>),</span>
<span id="cb35-534"><a href="#cb35-534" aria-hidden="true" tabindex="-1"></a>         <span class="at">conf_lo =</span> predicted <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> predicted_se,</span>
<span id="cb35-535"><a href="#cb35-535" aria-hidden="true" tabindex="-1"></a>         <span class="at">conf_hi =</span> predicted <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> predicted_se) <span class="sc">%&gt;%</span> </span>
<span id="cb35-536"><a href="#cb35-536" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(recr_years, <span class="at">by =</span> <span class="st">"year_fct"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-537"><a href="#cb35-537" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age, age_cat) <span class="sc">%&gt;%</span> </span>
<span id="cb35-538"><a href="#cb35-538" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">c</span>(predicted, predicted_pop, conf_lo, conf_hi), </span>
<span id="cb35-539"><a href="#cb35-539" aria-hidden="true" tabindex="-1"></a>                   \(x) <span class="fu">weighted.mean</span>(x, n)),</span>
<span id="cb35-540"><a href="#cb35-540" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-541"><a href="#cb35-541" aria-hidden="true" tabindex="-1"></a>  <span class="co"># invert logit</span></span>
<span id="cb35-542"><a href="#cb35-542" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(predicted, predicted_pop, conf_lo, conf_hi), </span>
<span id="cb35-543"><a href="#cb35-543" aria-hidden="true" tabindex="-1"></a>                <span class="fu">family</span>(pup_recr_mod)<span class="sc">$</span>linkinv)) <span class="sc">%&gt;%</span> </span>
<span id="cb35-544"><a href="#cb35-544" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(n_recruit, <span class="at">by =</span> <span class="st">"age"</span>)</span>
<span id="cb35-545"><a href="#cb35-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-546"><a href="#cb35-546" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions for each year (random effect)</span></span>
<span id="cb35-547"><a href="#cb35-547" aria-hidden="true" tabindex="-1"></a>recr_pred_years <span class="ot">&lt;-</span> <span class="fu">ggpredict</span>(</span>
<span id="cb35-548"><a href="#cb35-548" aria-hidden="true" tabindex="-1"></a>  pup_recr_mod,</span>
<span id="cb35-549"><a href="#cb35-549" aria-hidden="true" tabindex="-1"></a>  <span class="at">terms =</span> <span class="fu">c</span>(<span class="st">"age10 [all]"</span>, <span class="st">"age_cat"</span>, <span class="st">"year_fct [all]"</span>),</span>
<span id="cb35-550"><a href="#cb35-550" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"random"</span>,</span>
<span id="cb35-551"><a href="#cb35-551" aria-hidden="true" tabindex="-1"></a>  <span class="at">interval =</span> <span class="st">"confidence"</span></span>
<span id="cb35-552"><a href="#cb35-552" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-553"><a href="#cb35-553" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb35-554"><a href="#cb35-554" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age =</span> x <span class="sc">*</span> <span class="dv">10</span> <span class="sc">+</span> age_senesce,</span>
<span id="cb35-555"><a href="#cb35-555" aria-hidden="true" tabindex="-1"></a>         <span class="at">age_cat =</span> group,</span>
<span id="cb35-556"><a href="#cb35-556" aria-hidden="true" tabindex="-1"></a>         <span class="at">year_fct =</span> facet) <span class="sc">%&gt;%</span> </span>
<span id="cb35-557"><a href="#cb35-557" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>((age_cat <span class="sc">==</span> <span class="st">"Young"</span> <span class="sc">&amp;</span> age <span class="sc">&lt;</span> age_senesce) <span class="sc">|</span></span>
<span id="cb35-558"><a href="#cb35-558" aria-hidden="true" tabindex="-1"></a>           (age_cat <span class="sc">==</span> <span class="st">"Old"</span> <span class="sc">&amp;</span> age <span class="sc">&gt;=</span> age_senesce),</span>
<span id="cb35-559"><a href="#cb35-559" aria-hidden="true" tabindex="-1"></a>         age <span class="sc">&lt;=</span> <span class="dv">20</span>)</span>
<span id="cb35-560"><a href="#cb35-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-561"><a href="#cb35-561" aria-hidden="true" tabindex="-1"></a>fig_recr <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(recr_pred, <span class="fu">aes</span>(age, predicted)) <span class="sc">+</span></span>
<span id="cb35-562"><a href="#cb35-562" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Individual years</span></span>
<span id="cb35-563"><a href="#cb35-563" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> <span class="fu">interaction</span>(age_cat, year_fct)),</span>
<span id="cb35-564"><a href="#cb35-564" aria-hidden="true" tabindex="-1"></a>            recr_pred_years,</span>
<span id="cb35-565"><a href="#cb35-565" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb35-566"><a href="#cb35-566" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Weighted model (confidence interval and mean response)</span></span>
<span id="cb35-567"><a href="#cb35-567" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">fill =</span> age_cat, <span class="at">ymin =</span> conf_lo, <span class="at">ymax =</span> conf_hi), </span>
<span id="cb35-568"><a href="#cb35-568" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb35-569"><a href="#cb35-569" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> age_cat), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb35-570"><a href="#cb35-570" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Population-level mean response</span></span>
<span id="cb35-571"><a href="#cb35-571" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> predicted_pop, <span class="at">group =</span> age_cat),</span>
<span id="cb35-572"><a href="#cb35-572" aria-hidden="true" tabindex="-1"></a>            <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">linewidth =</span> <span class="fl">1.2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb35-573"><a href="#cb35-573" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Raw data</span></span>
<span id="cb35-574"><a href="#cb35-574" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">y =</span> perc_recr, </span>
<span id="cb35-575"><a href="#cb35-575" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ymin =</span> recr_lwr, </span>
<span id="cb35-576"><a href="#cb35-576" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ymax =</span> recr_upr),</span>
<span id="cb35-577"><a href="#cb35-577" aria-hidden="true" tabindex="-1"></a>                  recr_summ) <span class="sc">+</span></span>
<span id="cb35-578"><a href="#cb35-578" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> age_senesce <span class="sc">-</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb35-579"><a href="#cb35-579" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Offspring recruitment"</span>, </span>
<span id="cb35-580"><a href="#cb35-580" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb35-581"><a href="#cb35-581" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#7fbc41"</span>, <span class="st">"#de77ae"</span>)) <span class="sc">+</span></span>
<span id="cb35-582"><a href="#cb35-582" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#7fbc41"</span>, <span class="st">"#de77ae"</span>)) <span class="sc">+</span></span>
<span id="cb35-583"><a href="#cb35-583" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.6</span>)) <span class="sc">+</span></span>
<span id="cb35-584"><a href="#cb35-584" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age (years)"</span>) <span class="sc">+</span></span>
<span id="cb35-585"><a href="#cb35-585" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span> </span>
<span id="cb35-586"><a href="#cb35-586" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> n), <span class="at">y =</span> <span class="fl">0.6</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">nudge_x =</span> <span class="fl">0.2</span>)</span>
<span id="cb35-587"><a href="#cb35-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-588"><a href="#cb35-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-589"><a href="#cb35-589" aria-hidden="true" tabindex="-1"></a>(fig_surv <span class="sc">|</span> fig_recr) <span class="sc">+</span> <span class="fu">plot_annotation</span>(<span class="at">tag_levels =</span> <span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb35-590"><a href="#cb35-590" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-591"><a href="#cb35-591" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-592"><a href="#cb35-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-593"><a href="#cb35-593" aria-hidden="true" tabindex="-1"></a>Sample size for offspring survival was n = <span class="in">`r nrow(surv_recr_data)`</span> observations of <span class="in">`r n_distinct(surv_recr_data$animalID)`</span> individuals. Sample size for offspring recruitment was n = <span class="in">`r n_distinct(n_recruit_indiv)`</span> observations of <span class="in">`r n_distinct(n_recruit_indiv$animalID)`</span> female individuals.</span>
<span id="cb35-594"><a href="#cb35-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-597"><a href="#cb35-597" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-598"><a href="#cb35-598" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: h2-pred-deets</span></span>
<span id="cb35-599"><a href="#cb35-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-600"><a href="#cb35-600" aria-hidden="true" tabindex="-1"></a><span class="co">#Overall decline 11-19</span></span>
<span id="cb35-601"><a href="#cb35-601" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">age =</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">19</span>),</span>
<span id="cb35-602"><a href="#cb35-602" aria-hidden="true" tabindex="-1"></a>       <span class="at">age10 =</span> (age <span class="sc">-</span> age_senesce) <span class="sc">/</span> <span class="dv">10</span>,</span>
<span id="cb35-603"><a href="#cb35-603" aria-hidden="true" tabindex="-1"></a>       <span class="at">age_cat =</span> <span class="st">"Old"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-604"><a href="#cb35-604" aria-hidden="true" tabindex="-1"></a>  <span class="co"># logit-scale predictions</span></span>
<span id="cb35-605"><a href="#cb35-605" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">predicted =</span> <span class="fu">predict</span>(pup_surv_mod, </span>
<span id="cb35-606"><a href="#cb35-606" aria-hidden="true" tabindex="-1"></a>                             <span class="at">newdata =</span> .,</span>
<span id="cb35-607"><a href="#cb35-607" aria-hidden="true" tabindex="-1"></a>                             <span class="at">re.form =</span> <span class="cn">NA</span>),</span>
<span id="cb35-608"><a href="#cb35-608" aria-hidden="true" tabindex="-1"></a>         <span class="at">se =</span> <span class="fu">suppressWarnings</span>(<span class="fu">predict</span>(pup_surv_mod, </span>
<span id="cb35-609"><a href="#cb35-609" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">newdata =</span> .,</span>
<span id="cb35-610"><a href="#cb35-610" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">se.fit =</span> <span class="cn">TRUE</span>,</span>
<span id="cb35-611"><a href="#cb35-611" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">re.form =</span> <span class="cn">NA</span>)<span class="sc">$</span>se.fit),</span>
<span id="cb35-612"><a href="#cb35-612" aria-hidden="true" tabindex="-1"></a>         <span class="at">pred_lwr =</span> predicted <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> se,</span>
<span id="cb35-613"><a href="#cb35-613" aria-hidden="true" tabindex="-1"></a>         <span class="at">pred_upr =</span> predicted <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> se,</span>
<span id="cb35-614"><a href="#cb35-614" aria-hidden="true" tabindex="-1"></a>         <span class="co"># Invert the logit</span></span>
<span id="cb35-615"><a href="#cb35-615" aria-hidden="true" tabindex="-1"></a>         <span class="fu">across</span>(<span class="fu">c</span>(predicted, pred_upr, pred_lwr), </span>
<span id="cb35-616"><a href="#cb35-616" aria-hidden="true" tabindex="-1"></a>                <span class="fu">family</span>(pup_surv_mod)<span class="sc">$</span>linkinv))</span>
<span id="cb35-617"><a href="#cb35-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-618"><a href="#cb35-618" aria-hidden="true" tabindex="-1"></a><span class="co">#Difference between years </span></span>
<span id="cb35-619"><a href="#cb35-619" aria-hidden="true" tabindex="-1"></a>best_worst_yr_surv <span class="ot">&lt;-</span> <span class="fu">ranef</span>(pup_surv_mod)<span class="sc">$</span>year_fct <span class="sc">%&gt;%</span> </span>
<span id="cb35-620"><a href="#cb35-620" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="st">"year_fct"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-621"><a href="#cb35-621" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="st">`</span><span class="at">(Intercept)</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-622"><a href="#cb35-622" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(.))</span>
<span id="cb35-623"><a href="#cb35-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-624"><a href="#cb35-624" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">age =</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">19</span>),</span>
<span id="cb35-625"><a href="#cb35-625" aria-hidden="true" tabindex="-1"></a>       <span class="at">age10 =</span> (age <span class="sc">-</span> age_senesce) <span class="sc">/</span> <span class="dv">10</span>,</span>
<span id="cb35-626"><a href="#cb35-626" aria-hidden="true" tabindex="-1"></a>       <span class="at">age_cat =</span> <span class="st">"Old"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-627"><a href="#cb35-627" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cross_join</span>(best_worst_yr_surv) <span class="sc">%&gt;%</span> </span>
<span id="cb35-628"><a href="#cb35-628" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">predicted =</span> <span class="fu">predict</span>(pup_surv_mod, </span>
<span id="cb35-629"><a href="#cb35-629" aria-hidden="true" tabindex="-1"></a>                             <span class="at">newdata =</span> .,</span>
<span id="cb35-630"><a href="#cb35-630" aria-hidden="true" tabindex="-1"></a>                             <span class="at">type =</span> <span class="st">"response"</span>, </span>
<span id="cb35-631"><a href="#cb35-631" aria-hidden="true" tabindex="-1"></a>                             <span class="at">re.form =</span> <span class="sc">~</span> (<span class="dv">1</span> <span class="sc">|</span> year_fct)))</span>
<span id="cb35-632"><a href="#cb35-632" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-633"><a href="#cb35-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-634"><a href="#cb35-634" aria-hidden="true" tabindex="-1"></a><span class="fu">### H3: Changes in pup sex ratio with increased maternal age</span></span>
<span id="cb35-635"><a href="#cb35-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-636"><a href="#cb35-636" aria-hidden="true" tabindex="-1"></a>We found that as maternal age increases, the pup sex ratio does not change (@fig-sex-ratio).</span>
<span id="cb35-637"><a href="#cb35-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-640"><a href="#cb35-640" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-641"><a href="#cb35-641" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: sex-ratio</span></span>
<span id="cb35-642"><a href="#cb35-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-643"><a href="#cb35-643" aria-hidden="true" tabindex="-1"></a>pup_sex_data <span class="ot">&lt;-</span> sealdat <span class="sc">%&gt;%</span> </span>
<span id="cb35-644"><a href="#cb35-644" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(pupsex <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"M"</span>, <span class="st">"F"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb35-645"><a href="#cb35-645" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">is_male =</span> <span class="fu">as.integer</span>(pupsex <span class="sc">==</span> <span class="st">"M"</span>))</span>
<span id="cb35-646"><a href="#cb35-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-647"><a href="#cb35-647" aria-hidden="true" tabindex="-1"></a>sexrat_age_mod <span class="ot">&lt;-</span> <span class="fu">glmer</span>(</span>
<span id="cb35-648"><a href="#cb35-648" aria-hidden="true" tabindex="-1"></a>  is_male <span class="sc">~</span> age10 <span class="sc">:</span> age_cat <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> animalID) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> year_fct),</span>
<span id="cb35-649"><a href="#cb35-649" aria-hidden="true" tabindex="-1"></a>  pup_sex_data,</span>
<span id="cb35-650"><a href="#cb35-650" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="st">"binomial"</span></span>
<span id="cb35-651"><a href="#cb35-651" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-652"><a href="#cb35-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-653"><a href="#cb35-653" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(sexrat_age_mod)<span class="sc">$</span>coefficients</span>
<span id="cb35-654"><a href="#cb35-654" aria-hidden="true" tabindex="-1"></a><span class="fu">pnorm</span>(<span class="fu">summary</span>(sexrat_age_mod)<span class="sc">$</span>coef[<span class="st">"age10:age_catOld"</span>, <span class="st">"z value"</span>])</span>
<span id="cb35-655"><a href="#cb35-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-656"><a href="#cb35-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-657"><a href="#cb35-657" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-658"><a href="#cb35-658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-661"><a href="#cb35-661" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-662"><a href="#cb35-662" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-sex-ratio</span></span>
<span id="cb35-663"><a href="#cb35-663" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Offspring sex ratio trended towards more males with maternal age above the age threshold, but the trend was not significant. Black points and error bars show the mean and 95% CI. Sample sizes for each age class are included above the points. Thin gray lines show the mean response for each year of the study (i.e., including the random effect of year). Thick dashed lines show the weighted mean response and 95% CI; neither trend was significant. The unweighted fitted model is indicated by a dotted gray line. The weighted model is emphasized because of the large impact of the random effect of year."</span></span>
<span id="cb35-664"><a href="#cb35-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-665"><a href="#cb35-665" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize the raw data</span></span>
<span id="cb35-666"><a href="#cb35-666" aria-hidden="true" tabindex="-1"></a>sexrat_summ <span class="ot">&lt;-</span> pup_sex_data <span class="sc">%&gt;%</span> </span>
<span id="cb35-667"><a href="#cb35-667" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age) <span class="sc">%&gt;%</span> </span>
<span id="cb35-668"><a href="#cb35-668" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n_observed =</span> <span class="fu">n</span>(), </span>
<span id="cb35-669"><a href="#cb35-669" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_male =</span> <span class="fu">sum</span>(is_male),</span>
<span id="cb35-670"><a href="#cb35-670" aria-hidden="true" tabindex="-1"></a>            <span class="at">perc_male =</span> n_male <span class="sc">/</span> n_observed, </span>
<span id="cb35-671"><a href="#cb35-671" aria-hidden="true" tabindex="-1"></a>            <span class="at">male_lwr =</span> <span class="fu">binom.test</span>(n_male, n_observed)<span class="sc">$</span>conf.int[<span class="dv">1</span>], </span>
<span id="cb35-672"><a href="#cb35-672" aria-hidden="true" tabindex="-1"></a>            <span class="at">male_upr =</span> <span class="fu">binom.test</span>(n_male, n_observed)<span class="sc">$</span>conf.int[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb35-673"><a href="#cb35-673" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(age <span class="sc">&lt;=</span> <span class="dv">20</span>)</span>
<span id="cb35-674"><a href="#cb35-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-675"><a href="#cb35-675" aria-hidden="true" tabindex="-1"></a><span class="co">#Make sample size data frame</span></span>
<span id="cb35-676"><a href="#cb35-676" aria-hidden="true" tabindex="-1"></a>n_sexrat <span class="ot">&lt;-</span> pup_sex_data <span class="sc">%&gt;%</span> </span>
<span id="cb35-677"><a href="#cb35-677" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(age)</span>
<span id="cb35-678"><a href="#cb35-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-679"><a href="#cb35-679" aria-hidden="true" tabindex="-1"></a><span class="co"># Create offspring sex ratio predictions (population-level and weighted by year)</span></span>
<span id="cb35-680"><a href="#cb35-680" aria-hidden="true" tabindex="-1"></a>sexrat_grid <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(</span>
<span id="cb35-681"><a href="#cb35-681" aria-hidden="true" tabindex="-1"></a>  <span class="at">age =</span> <span class="dv">4</span><span class="sc">:</span><span class="dv">20</span>,</span>
<span id="cb35-682"><a href="#cb35-682" aria-hidden="true" tabindex="-1"></a>  <span class="at">year_fct =</span> <span class="fu">factor</span>(<span class="dv">1988</span><span class="sc">:</span><span class="dv">2023</span>)</span>
<span id="cb35-683"><a href="#cb35-683" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-684"><a href="#cb35-684" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age10 =</span> (age <span class="sc">-</span> age_senesce) <span class="sc">/</span> <span class="dv">10</span>,</span>
<span id="cb35-685"><a href="#cb35-685" aria-hidden="true" tabindex="-1"></a>         <span class="at">age_cat =</span> <span class="fu">factor</span>(<span class="fu">ifelse</span>(age <span class="sc">&lt;</span> age_senesce, <span class="st">"Young"</span>, <span class="st">"Old"</span>),</span>
<span id="cb35-686"><a href="#cb35-686" aria-hidden="true" tabindex="-1"></a>                          <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Young"</span>, <span class="st">"Old"</span>)))</span>
<span id="cb35-687"><a href="#cb35-687" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-688"><a href="#cb35-688" aria-hidden="true" tabindex="-1"></a>sexrat_years <span class="ot">&lt;-</span> <span class="fu">count</span>(pup_sex_data, year_fct)</span>
<span id="cb35-689"><a href="#cb35-689" aria-hidden="true" tabindex="-1"></a>sexrat_pred <span class="ot">&lt;-</span> sexrat_grid <span class="sc">%&gt;%</span> </span>
<span id="cb35-690"><a href="#cb35-690" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">predicted =</span> <span class="fu">predict</span>(sexrat_age_mod, </span>
<span id="cb35-691"><a href="#cb35-691" aria-hidden="true" tabindex="-1"></a>                             <span class="at">newdata =</span> sexrat_grid,</span>
<span id="cb35-692"><a href="#cb35-692" aria-hidden="true" tabindex="-1"></a>                             <span class="at">re.form =</span> <span class="sc">~</span> (<span class="dv">1</span> <span class="sc">|</span> year_fct)),</span>
<span id="cb35-693"><a href="#cb35-693" aria-hidden="true" tabindex="-1"></a>         <span class="at">predicted_se =</span> <span class="fu">suppressWarnings</span>(</span>
<span id="cb35-694"><a href="#cb35-694" aria-hidden="true" tabindex="-1"></a>           <span class="co"># warning: "se.fit computation uses an approximation to estimate the sampling distribution of the parameters"</span></span>
<span id="cb35-695"><a href="#cb35-695" aria-hidden="true" tabindex="-1"></a>           <span class="fu">predict</span>(sexrat_age_mod, </span>
<span id="cb35-696"><a href="#cb35-696" aria-hidden="true" tabindex="-1"></a>                   <span class="at">newdata =</span> sexrat_grid,</span>
<span id="cb35-697"><a href="#cb35-697" aria-hidden="true" tabindex="-1"></a>                   <span class="at">re.form =</span> <span class="cn">NA</span>,</span>
<span id="cb35-698"><a href="#cb35-698" aria-hidden="true" tabindex="-1"></a>                   <span class="at">se.fit =</span> <span class="cn">TRUE</span>),</span>
<span id="cb35-699"><a href="#cb35-699" aria-hidden="true" tabindex="-1"></a>         )<span class="sc">$</span>se.fit,</span>
<span id="cb35-700"><a href="#cb35-700" aria-hidden="true" tabindex="-1"></a>         <span class="at">predicted_pop =</span> <span class="fu">predict</span>(sexrat_age_mod, </span>
<span id="cb35-701"><a href="#cb35-701" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">newdata =</span> sexrat_grid,</span>
<span id="cb35-702"><a href="#cb35-702" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">re.form =</span> <span class="cn">NA</span>),</span>
<span id="cb35-703"><a href="#cb35-703" aria-hidden="true" tabindex="-1"></a>         <span class="at">conf_lo =</span> predicted <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> predicted_se,</span>
<span id="cb35-704"><a href="#cb35-704" aria-hidden="true" tabindex="-1"></a>         <span class="at">conf_hi =</span> predicted <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> predicted_se) <span class="sc">%&gt;%</span> </span>
<span id="cb35-705"><a href="#cb35-705" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(sexrat_years, <span class="at">by =</span> <span class="st">"year_fct"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-706"><a href="#cb35-706" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age, age_cat) <span class="sc">%&gt;%</span> </span>
<span id="cb35-707"><a href="#cb35-707" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">c</span>(predicted, predicted_pop, conf_lo, conf_hi), </span>
<span id="cb35-708"><a href="#cb35-708" aria-hidden="true" tabindex="-1"></a>                   \(x) <span class="fu">weighted.mean</span>(x, n)),</span>
<span id="cb35-709"><a href="#cb35-709" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-710"><a href="#cb35-710" aria-hidden="true" tabindex="-1"></a>  <span class="co"># invert logit</span></span>
<span id="cb35-711"><a href="#cb35-711" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(predicted, predicted_pop, conf_lo, conf_hi), </span>
<span id="cb35-712"><a href="#cb35-712" aria-hidden="true" tabindex="-1"></a>                <span class="fu">family</span>(sexrat_age_mod)<span class="sc">$</span>linkinv)) <span class="sc">%&gt;%</span> </span>
<span id="cb35-713"><a href="#cb35-713" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(n_sexrat, <span class="at">by =</span> <span class="st">"age"</span>)</span>
<span id="cb35-714"><a href="#cb35-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-715"><a href="#cb35-715" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions for each year (random effect)</span></span>
<span id="cb35-716"><a href="#cb35-716" aria-hidden="true" tabindex="-1"></a>sexrat_years <span class="ot">&lt;-</span> <span class="fu">ggpredict</span>(</span>
<span id="cb35-717"><a href="#cb35-717" aria-hidden="true" tabindex="-1"></a>  sexrat_age_mod,</span>
<span id="cb35-718"><a href="#cb35-718" aria-hidden="true" tabindex="-1"></a>  <span class="at">terms =</span> <span class="fu">c</span>(<span class="st">"age10 [all]"</span>, <span class="st">"age_cat"</span>, <span class="st">"year_fct [all]"</span>),</span>
<span id="cb35-719"><a href="#cb35-719" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"random"</span>,</span>
<span id="cb35-720"><a href="#cb35-720" aria-hidden="true" tabindex="-1"></a>  <span class="at">interval =</span> <span class="st">"confidence"</span></span>
<span id="cb35-721"><a href="#cb35-721" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-722"><a href="#cb35-722" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb35-723"><a href="#cb35-723" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age =</span> x <span class="sc">*</span> <span class="dv">10</span> <span class="sc">+</span> age_senesce,</span>
<span id="cb35-724"><a href="#cb35-724" aria-hidden="true" tabindex="-1"></a>         <span class="at">age_cat =</span> group,</span>
<span id="cb35-725"><a href="#cb35-725" aria-hidden="true" tabindex="-1"></a>         <span class="at">year_fct =</span> facet) <span class="sc">%&gt;%</span> </span>
<span id="cb35-726"><a href="#cb35-726" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>((age_cat <span class="sc">==</span> <span class="st">"Young"</span> <span class="sc">&amp;</span> age <span class="sc">&lt;</span> age_senesce) <span class="sc">|</span></span>
<span id="cb35-727"><a href="#cb35-727" aria-hidden="true" tabindex="-1"></a>           (age_cat <span class="sc">==</span> <span class="st">"Old"</span> <span class="sc">&amp;</span> age <span class="sc">&gt;=</span> age_senesce),</span>
<span id="cb35-728"><a href="#cb35-728" aria-hidden="true" tabindex="-1"></a>         age <span class="sc">&lt;=</span> <span class="dv">20</span>)</span>
<span id="cb35-729"><a href="#cb35-729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-730"><a href="#cb35-730" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(sexrat_pred, <span class="fu">aes</span>(age, predicted)) <span class="sc">+</span></span>
<span id="cb35-731"><a href="#cb35-731" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Individual years</span></span>
<span id="cb35-732"><a href="#cb35-732" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> <span class="fu">interaction</span>(age_cat, year_fct)),</span>
<span id="cb35-733"><a href="#cb35-733" aria-hidden="true" tabindex="-1"></a>            sexrat_years,</span>
<span id="cb35-734"><a href="#cb35-734" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb35-735"><a href="#cb35-735" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Weighted model (confidence interval and mean response)</span></span>
<span id="cb35-736"><a href="#cb35-736" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">fill =</span> age_cat, <span class="at">ymin =</span> conf_lo, <span class="at">ymax =</span> conf_hi), </span>
<span id="cb35-737"><a href="#cb35-737" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb35-738"><a href="#cb35-738" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> age_cat, <span class="at">group =</span> age_cat),</span>
<span id="cb35-739"><a href="#cb35-739" aria-hidden="true" tabindex="-1"></a>            <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb35-740"><a href="#cb35-740" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Population-level mean response</span></span>
<span id="cb35-741"><a href="#cb35-741" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> predicted_pop, <span class="at">group =</span> age_cat),</span>
<span id="cb35-742"><a href="#cb35-742" aria-hidden="true" tabindex="-1"></a>            <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">linewidth =</span> <span class="fl">1.2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb35-743"><a href="#cb35-743" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Raw data</span></span>
<span id="cb35-744"><a href="#cb35-744" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">y =</span> perc_male, </span>
<span id="cb35-745"><a href="#cb35-745" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ymin =</span> male_lwr, </span>
<span id="cb35-746"><a href="#cb35-746" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ymax =</span> male_upr),</span>
<span id="cb35-747"><a href="#cb35-747" aria-hidden="true" tabindex="-1"></a>                  sexrat_summ) <span class="sc">+</span></span>
<span id="cb35-748"><a href="#cb35-748" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> age_senesce <span class="sc">-</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb35-749"><a href="#cb35-749" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Male offspring"</span>, </span>
<span id="cb35-750"><a href="#cb35-750" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> scales<span class="sc">::</span>percent,</span>
<span id="cb35-751"><a href="#cb35-751" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="fl">0.97</span>)) <span class="sc">+</span></span>
<span id="cb35-752"><a href="#cb35-752" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#7fbc41"</span>, <span class="st">"#de77ae"</span>)) <span class="sc">+</span></span>
<span id="cb35-753"><a href="#cb35-753" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#7fbc41"</span>, <span class="st">"#de77ae"</span>)) <span class="sc">+</span></span>
<span id="cb35-754"><a href="#cb35-754" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Maternal age (years)"</span>) <span class="sc">+</span></span>
<span id="cb35-755"><a href="#cb35-755" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb35-756"><a href="#cb35-756" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> n), <span class="at">y =</span> .<span class="dv">97</span>, <span class="at">vjust =</span> <span class="dv">0</span>)</span>
<span id="cb35-757"><a href="#cb35-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-758"><a href="#cb35-758" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-759"><a href="#cb35-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-760"><a href="#cb35-760" aria-hidden="true" tabindex="-1"></a>Sample size n = <span class="in">`r nrow(pup_sex_data)`</span> observations of <span class="in">`r n_distinct(pup_sex_data$animalID)`</span> individuals.</span>
<span id="cb35-761"><a href="#cb35-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-762"><a href="#cb35-762" aria-hidden="true" tabindex="-1"></a>**Note**: In the above figure, the population-level and weighted-average lie directly on top of each other. This is because the random effect of year has very little impact on offspring sex ratio, which makes sense biologically. It's easy to imagine scenarios where reproduction would vary year-to-year, but harder to think of a mechanism linking year and offspring sex ratio.</span>
<span id="cb35-763"><a href="#cb35-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-764"><a href="#cb35-764" aria-hidden="true" tabindex="-1"></a><span class="fu">### H4: Phenology</span></span>
<span id="cb35-765"><a href="#cb35-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-766"><a href="#cb35-766" aria-hidden="true" tabindex="-1"></a>Does the timing of breeding and molting suggest a mechanistic explanation for observed patterns in reproductive and maternal-effect senescence?</span>
<span id="cb35-767"><a href="#cb35-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-768"><a href="#cb35-768" aria-hidden="true" tabindex="-1"></a>We fit a generalized linear mixed-effects model with the duration of a phase (molting or breeding) as the response variable and age, interacting with phase, as the predictor, using year as a random effect. We attempted to fit a model with random effects for both year and individual, but that failed to converge. We assumed the effect of year on phase duration (molting or breeding) was greater than the effect of individual, so we retained year as the random effect.</span>
<span id="cb35-769"><a href="#cb35-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-770"><a href="#cb35-770" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb35-771"><a href="#cb35-771" aria-hidden="true" tabindex="-1"></a>\begin{align}</span>
<span id="cb35-772"><a href="#cb35-772" aria-hidden="true" tabindex="-1"></a>d &amp;\sim NB(\mu, k) <span class="sc">\\</span></span>
<span id="cb35-773"><a href="#cb35-773" aria-hidden="true" tabindex="-1"></a>e^\mu &amp;= \beta_0 + \beta_p a + Zy</span>
<span id="cb35-774"><a href="#cb35-774" aria-hidden="true" tabindex="-1"></a>\end{align}</span>
<span id="cb35-775"><a href="#cb35-775" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb35-776"><a href="#cb35-776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-777"><a href="#cb35-777" aria-hidden="true" tabindex="-1"></a>Where: $d$ is the duration of the phase in days, $NB$ is the negative binomial distribution with location $\mu$ and dispersion $k$, $\beta_0$ is the intercept, $\beta_p$ is the coefficient for age ($a$) by phase (i.e., for $p$ in "molting" or "breeding"), $y$ is the year, and $Z$ is the design matrix relating $y$ to $e^\mu$.</span>
<span id="cb35-778"><a href="#cb35-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-781"><a href="#cb35-781" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-782"><a href="#cb35-782" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: pheno-model</span></span>
<span id="cb35-783"><a href="#cb35-783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-784"><a href="#cb35-784" aria-hidden="true" tabindex="-1"></a>seal_phenology <span class="ot">&lt;-</span> sealdat <span class="sc">%&gt;%</span> </span>
<span id="cb35-785"><a href="#cb35-785" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2011</span>, </span>
<span id="cb35-786"><a href="#cb35-786" aria-hidden="true" tabindex="-1"></a>         moltdur <span class="sc">&gt;=</span> <span class="dv">7</span>, </span>
<span id="cb35-787"><a href="#cb35-787" aria-hidden="true" tabindex="-1"></a>         age <span class="sc">&lt;=</span> <span class="dv">20</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-788"><a href="#cb35-788" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">BA =</span> firstobsbreeddoy, </span>
<span id="cb35-789"><a href="#cb35-789" aria-hidden="true" tabindex="-1"></a>         <span class="at">BD =</span> firstobsbreeddoy <span class="sc">+</span> breeddur, </span>
<span id="cb35-790"><a href="#cb35-790" aria-hidden="true" tabindex="-1"></a>         <span class="at">MA =</span> lastobsmoltdoy <span class="sc">-</span> moltdur, </span>
<span id="cb35-791"><a href="#cb35-791" aria-hidden="true" tabindex="-1"></a>         <span class="at">MD =</span> lastobsmoltdoy) <span class="sc">%&gt;%</span> </span>
<span id="cb35-792"><a href="#cb35-792" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(age, BA, BD, MA, MD) </span>
<span id="cb35-793"><a href="#cb35-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-794"><a href="#cb35-794" aria-hidden="true" tabindex="-1"></a>pheno_model <span class="ot">&lt;-</span> seal_phenology <span class="sc">%&gt;%</span> </span>
<span id="cb35-795"><a href="#cb35-795" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(animalID, </span>
<span id="cb35-796"><a href="#cb35-796" aria-hidden="true" tabindex="-1"></a>            year_fct, </span>
<span id="cb35-797"><a href="#cb35-797" aria-hidden="true" tabindex="-1"></a>            <span class="at">age10 =</span> (age <span class="sc">-</span> age_senesce) <span class="sc">/</span> <span class="dv">10</span>, </span>
<span id="cb35-798"><a href="#cb35-798" aria-hidden="true" tabindex="-1"></a>            <span class="at">age_cat =</span> <span class="fu">factor</span>(age <span class="sc">&gt;=</span> age_senesce, </span>
<span id="cb35-799"><a href="#cb35-799" aria-hidden="true" tabindex="-1"></a>                          <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Young"</span>, <span class="st">"Old"</span>)),</span>
<span id="cb35-800"><a href="#cb35-800" aria-hidden="true" tabindex="-1"></a>            moltdur, </span>
<span id="cb35-801"><a href="#cb35-801" aria-hidden="true" tabindex="-1"></a>            breeddur) <span class="sc">%&gt;%</span> </span>
<span id="cb35-802"><a href="#cb35-802" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(moltdur<span class="sc">:</span>breeddur, </span>
<span id="cb35-803"><a href="#cb35-803" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"phase"</span>, </span>
<span id="cb35-804"><a href="#cb35-804" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"dur_days"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-805"><a href="#cb35-805" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glmer</span>(dur_days <span class="sc">~</span> age10<span class="sc">:</span>phase<span class="sc">:</span>age_cat <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> year_fct) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> animalID), </span>
<span id="cb35-806"><a href="#cb35-806" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> ., </span>
<span id="cb35-807"><a href="#cb35-807" aria-hidden="true" tabindex="-1"></a>        <span class="at">family =</span> <span class="fu">Gamma</span>(<span class="at">link =</span> <span class="st">"log"</span>))</span>
<span id="cb35-808"><a href="#cb35-808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-809"><a href="#cb35-809" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-810"><a href="#cb35-810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-813"><a href="#cb35-813" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-814"><a href="#cb35-814" aria-hidden="true" tabindex="-1"></a><span class="co">#Make sample size data frame</span></span>
<span id="cb35-815"><a href="#cb35-815" aria-hidden="true" tabindex="-1"></a>n_phen_age <span class="ot">&lt;-</span> <span class="fu">count</span>(seal_phenology, age)</span>
<span id="cb35-816"><a href="#cb35-816" aria-hidden="true" tabindex="-1"></a>n_phen_year <span class="ot">&lt;-</span> <span class="fu">count</span>(seal_phenology, year_fct)</span>
<span id="cb35-817"><a href="#cb35-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-818"><a href="#cb35-818" aria-hidden="true" tabindex="-1"></a>pheno_grid <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(</span>
<span id="cb35-819"><a href="#cb35-819" aria-hidden="true" tabindex="-1"></a>  <span class="at">age =</span> <span class="dv">4</span><span class="sc">:</span><span class="dv">20</span>,</span>
<span id="cb35-820"><a href="#cb35-820" aria-hidden="true" tabindex="-1"></a>  <span class="at">year_fct =</span> <span class="fu">factor</span>(<span class="dv">2011</span><span class="sc">:</span><span class="dv">2023</span>), </span>
<span id="cb35-821"><a href="#cb35-821" aria-hidden="true" tabindex="-1"></a>  <span class="at">phase =</span> <span class="fu">c</span>(<span class="st">"breeddur"</span>, <span class="st">"moltdur"</span>)</span>
<span id="cb35-822"><a href="#cb35-822" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-823"><a href="#cb35-823" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age10 =</span> (age <span class="sc">-</span> age_senesce) <span class="sc">/</span> <span class="dv">10</span>,</span>
<span id="cb35-824"><a href="#cb35-824" aria-hidden="true" tabindex="-1"></a>         <span class="at">age_cat =</span> <span class="fu">factor</span>(<span class="fu">ifelse</span>(age <span class="sc">&lt;</span> age_senesce, <span class="st">"Young"</span>, <span class="st">"Old"</span>),</span>
<span id="cb35-825"><a href="#cb35-825" aria-hidden="true" tabindex="-1"></a>                          <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Young"</span>, <span class="st">"Old"</span>)))</span>
<span id="cb35-826"><a href="#cb35-826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-827"><a href="#cb35-827" aria-hidden="true" tabindex="-1"></a><span class="co"># #population level mean</span></span>
<span id="cb35-828"><a href="#cb35-828" aria-hidden="true" tabindex="-1"></a><span class="co"># phen_plot_pred &lt;- ggpredict(</span></span>
<span id="cb35-829"><a href="#cb35-829" aria-hidden="true" tabindex="-1"></a><span class="co">#   pheno_model, </span></span>
<span id="cb35-830"><a href="#cb35-830" aria-hidden="true" tabindex="-1"></a><span class="co">#   terms = c("age10 [all]", "age_cat", "phase", "year_fct [all]")</span></span>
<span id="cb35-831"><a href="#cb35-831" aria-hidden="true" tabindex="-1"></a><span class="co"># ) %&gt;% </span></span>
<span id="cb35-832"><a href="#cb35-832" aria-hidden="true" tabindex="-1"></a><span class="co">#   as_tibble() %&gt;%</span></span>
<span id="cb35-833"><a href="#cb35-833" aria-hidden="true" tabindex="-1"></a><span class="co">#   transmute(age = x * 10 + age_senesce,</span></span>
<span id="cb35-834"><a href="#cb35-834" aria-hidden="true" tabindex="-1"></a><span class="co">#             age_cat = group,</span></span>
<span id="cb35-835"><a href="#cb35-835" aria-hidden="true" tabindex="-1"></a><span class="co">#             dur_days = predicted,</span></span>
<span id="cb35-836"><a href="#cb35-836" aria-hidden="true" tabindex="-1"></a><span class="co">#             dur_days_lwr = conf.low,</span></span>
<span id="cb35-837"><a href="#cb35-837" aria-hidden="true" tabindex="-1"></a><span class="co">#             dur_days_upr = conf.high,</span></span>
<span id="cb35-838"><a href="#cb35-838" aria-hidden="true" tabindex="-1"></a><span class="co">#             phase = facet,</span></span>
<span id="cb35-839"><a href="#cb35-839" aria-hidden="true" tabindex="-1"></a><span class="co">#             year_fct = panel) %&gt;% </span></span>
<span id="cb35-840"><a href="#cb35-840" aria-hidden="true" tabindex="-1"></a><span class="co">#   left_join(n_phen_year, by = "year_fct") %&gt;% </span></span>
<span id="cb35-841"><a href="#cb35-841" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter((age_cat == "Young" &amp; age &lt; age_senesce) |</span></span>
<span id="cb35-842"><a href="#cb35-842" aria-hidden="true" tabindex="-1"></a><span class="co">#            (age_cat == "Old" &amp; age &gt;= age_senesce))</span></span>
<span id="cb35-843"><a href="#cb35-843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-844"><a href="#cb35-844" aria-hidden="true" tabindex="-1"></a><span class="co">#weighted model</span></span>
<span id="cb35-845"><a href="#cb35-845" aria-hidden="true" tabindex="-1"></a>pheno_pred <span class="ot">&lt;-</span> pheno_grid <span class="sc">%&gt;%</span> </span>
<span id="cb35-846"><a href="#cb35-846" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">predicted =</span> <span class="fu">predict</span>(pheno_model, </span>
<span id="cb35-847"><a href="#cb35-847" aria-hidden="true" tabindex="-1"></a>                             <span class="at">newdata =</span> pheno_grid,</span>
<span id="cb35-848"><a href="#cb35-848" aria-hidden="true" tabindex="-1"></a>                             <span class="at">re.form =</span> <span class="sc">~</span> (<span class="dv">1</span> <span class="sc">|</span> year_fct)),</span>
<span id="cb35-849"><a href="#cb35-849" aria-hidden="true" tabindex="-1"></a>         <span class="at">predicted_se =</span> <span class="fu">suppressWarnings</span>(</span>
<span id="cb35-850"><a href="#cb35-850" aria-hidden="true" tabindex="-1"></a>           <span class="co"># warning: "se.fit computation uses an approximation to estimate the sampling distribution of the parameters"</span></span>
<span id="cb35-851"><a href="#cb35-851" aria-hidden="true" tabindex="-1"></a>           <span class="fu">predict</span>(pheno_model, </span>
<span id="cb35-852"><a href="#cb35-852" aria-hidden="true" tabindex="-1"></a>                   <span class="at">newdata =</span> pheno_grid,</span>
<span id="cb35-853"><a href="#cb35-853" aria-hidden="true" tabindex="-1"></a>                   <span class="at">re.form =</span> <span class="cn">NA</span>,</span>
<span id="cb35-854"><a href="#cb35-854" aria-hidden="true" tabindex="-1"></a>                   <span class="at">se.fit =</span> <span class="cn">TRUE</span>),</span>
<span id="cb35-855"><a href="#cb35-855" aria-hidden="true" tabindex="-1"></a>         )<span class="sc">$</span>se.fit,</span>
<span id="cb35-856"><a href="#cb35-856" aria-hidden="true" tabindex="-1"></a>         <span class="at">predicted_pop =</span> <span class="fu">predict</span>(pheno_model, </span>
<span id="cb35-857"><a href="#cb35-857" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">newdata =</span> pheno_grid,</span>
<span id="cb35-858"><a href="#cb35-858" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">re.form =</span> <span class="cn">NA</span>),</span>
<span id="cb35-859"><a href="#cb35-859" aria-hidden="true" tabindex="-1"></a>         <span class="at">conf_lo =</span> predicted <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> predicted_se,</span>
<span id="cb35-860"><a href="#cb35-860" aria-hidden="true" tabindex="-1"></a>         <span class="at">conf_hi =</span> predicted <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> predicted_se) <span class="sc">%&gt;%</span> </span>
<span id="cb35-861"><a href="#cb35-861" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(n_phen_year, <span class="at">by =</span> <span class="st">"year_fct"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-862"><a href="#cb35-862" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age, age_cat, phase) <span class="sc">%&gt;%</span> </span>
<span id="cb35-863"><a href="#cb35-863" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">c</span>(predicted, predicted_pop, conf_lo, conf_hi), </span>
<span id="cb35-864"><a href="#cb35-864" aria-hidden="true" tabindex="-1"></a>                   \(x) <span class="fu">weighted.mean</span>(x, n)),</span>
<span id="cb35-865"><a href="#cb35-865" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-866"><a href="#cb35-866" aria-hidden="true" tabindex="-1"></a>  <span class="co"># invert logit</span></span>
<span id="cb35-867"><a href="#cb35-867" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(predicted, predicted_pop, conf_lo, conf_hi), </span>
<span id="cb35-868"><a href="#cb35-868" aria-hidden="true" tabindex="-1"></a>                <span class="fu">family</span>(pheno_model)<span class="sc">$</span>linkinv)) <span class="sc">%&gt;%</span> </span>
<span id="cb35-869"><a href="#cb35-869" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(n_phen_age, <span class="at">by =</span> <span class="st">"age"</span>) </span>
<span id="cb35-870"><a href="#cb35-870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-871"><a href="#cb35-871" aria-hidden="true" tabindex="-1"></a><span class="co">#random effect of year</span></span>
<span id="cb35-872"><a href="#cb35-872" aria-hidden="true" tabindex="-1"></a>phen_pred_years <span class="ot">&lt;-</span> pheno_grid <span class="sc">%&gt;%</span> </span>
<span id="cb35-873"><a href="#cb35-873" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">predicted =</span> <span class="fu">predict</span>(pheno_model, </span>
<span id="cb35-874"><a href="#cb35-874" aria-hidden="true" tabindex="-1"></a>                             <span class="at">newdata =</span> pheno_grid,</span>
<span id="cb35-875"><a href="#cb35-875" aria-hidden="true" tabindex="-1"></a>                             <span class="at">type =</span> <span class="st">"response"</span>,</span>
<span id="cb35-876"><a href="#cb35-876" aria-hidden="true" tabindex="-1"></a>                             <span class="at">re.form =</span> <span class="sc">~</span> (<span class="dv">1</span> <span class="sc">|</span> year_fct)))</span>
<span id="cb35-877"><a href="#cb35-877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-878"><a href="#cb35-878" aria-hidden="true" tabindex="-1"></a><span class="co">#raw data</span></span>
<span id="cb35-879"><a href="#cb35-879" aria-hidden="true" tabindex="-1"></a>pheno_raw <span class="ot">&lt;-</span> seal_phenology <span class="sc">%&gt;%</span> </span>
<span id="cb35-880"><a href="#cb35-880" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(breeddur, moltdur, age) <span class="sc">%&gt;%</span> </span>
<span id="cb35-881"><a href="#cb35-881" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(breeddur, moltdur), </span>
<span id="cb35-882"><a href="#cb35-882" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"phase"</span>, </span>
<span id="cb35-883"><a href="#cb35-883" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"dur_days"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-884"><a href="#cb35-884" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age, phase) <span class="sc">%&gt;%</span> </span>
<span id="cb35-885"><a href="#cb35-885" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb35-886"><a href="#cb35-886" aria-hidden="true" tabindex="-1"></a>            <span class="at">dur_days_se =</span> <span class="fu">sd</span>(dur_days) <span class="sc">/</span> <span class="fu">sqrt</span>(n),</span>
<span id="cb35-887"><a href="#cb35-887" aria-hidden="true" tabindex="-1"></a>            <span class="at">dur_days =</span> <span class="fu">mean</span>(dur_days),</span>
<span id="cb35-888"><a href="#cb35-888" aria-hidden="true" tabindex="-1"></a>            <span class="at">dur_days_lwr =</span> dur_days <span class="sc">-</span> dur_days_se,</span>
<span id="cb35-889"><a href="#cb35-889" aria-hidden="true" tabindex="-1"></a>            <span class="at">dur_days_upr =</span> dur_days <span class="sc">+</span> dur_days_se,</span>
<span id="cb35-890"><a href="#cb35-890" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb35-891"><a href="#cb35-891" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-892"><a href="#cb35-892" aria-hidden="true" tabindex="-1"></a>breed_duration_plot <span class="ot">&lt;-</span> pheno_pred <span class="sc">%&gt;%</span> </span>
<span id="cb35-893"><a href="#cb35-893" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(phase <span class="sc">==</span> <span class="st">"breeddur"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-894"><a href="#cb35-894" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(age)) <span class="sc">+</span></span>
<span id="cb35-895"><a href="#cb35-895" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Predictions by year</span></span>
<span id="cb35-896"><a href="#cb35-896" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(age, predicted, <span class="at">group =</span> <span class="fu">interaction</span>(phase, age_cat, year_fct)), </span>
<span id="cb35-897"><a href="#cb35-897" aria-hidden="true" tabindex="-1"></a>            <span class="fu">filter</span>(phen_pred_years, phase <span class="sc">==</span> <span class="st">"breeddur"</span>),</span>
<span id="cb35-898"><a href="#cb35-898" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span> </span>
<span id="cb35-899"><a href="#cb35-899" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Population-level mean response</span></span>
<span id="cb35-900"><a href="#cb35-900" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> predicted_pop, <span class="at">group =</span> age_cat),</span>
<span id="cb35-901"><a href="#cb35-901" aria-hidden="true" tabindex="-1"></a>            <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">linewidth =</span> <span class="fl">1.2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb35-902"><a href="#cb35-902" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Weighted model (CI + mean)</span></span>
<span id="cb35-903"><a href="#cb35-903" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> conf_lo, <span class="at">ymax =</span> conf_hi, <span class="at">fill =</span> age_cat),</span>
<span id="cb35-904"><a href="#cb35-904" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb35-905"><a href="#cb35-905" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> predicted, <span class="at">color =</span> age_cat, <span class="at">linetype =</span> age_cat)) <span class="sc">+</span></span>
<span id="cb35-906"><a href="#cb35-906" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Summarized data</span></span>
<span id="cb35-907"><a href="#cb35-907" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">y =</span> dur_days, </span>
<span id="cb35-908"><a href="#cb35-908" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ymin =</span> dur_days_lwr, </span>
<span id="cb35-909"><a href="#cb35-909" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ymax =</span> dur_days_upr),</span>
<span id="cb35-910"><a href="#cb35-910" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(pheno_raw, phase <span class="sc">==</span> <span class="st">"breeddur"</span>),</span>
<span id="cb35-911"><a href="#cb35-911" aria-hidden="true" tabindex="-1"></a>                  <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.5</span>), </span>
<span id="cb35-912"><a href="#cb35-912" aria-hidden="true" tabindex="-1"></a>                  <span class="at">size =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb35-913"><a href="#cb35-913" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> age_senesce <span class="sc">-</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb35-914"><a href="#cb35-914" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> n), <span class="at">y =</span> <span class="fl">36.5</span>, <span class="at">vjust =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb35-915"><a href="#cb35-915" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"solid"</span>, <span class="st">"dashed"</span>)) <span class="sc">+</span></span>
<span id="cb35-916"><a href="#cb35-916" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#7fbc41"</span>, <span class="st">"#de77ae"</span>)) <span class="sc">+</span></span>
<span id="cb35-917"><a href="#cb35-917" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#7fbc41"</span>, <span class="st">"#de77ae"</span>)) <span class="sc">+</span></span>
<span id="cb35-918"><a href="#cb35-918" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">15</span>, <span class="dv">40</span>)) <span class="sc">+</span></span>
<span id="cb35-919"><a href="#cb35-919" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Breeding haul out (days)"</span>) <span class="sc">+</span></span>
<span id="cb35-920"><a href="#cb35-920" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb35-921"><a href="#cb35-921" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>), </span>
<span id="cb35-922"><a href="#cb35-922" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb35-923"><a href="#cb35-923" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-924"><a href="#cb35-924" aria-hidden="true" tabindex="-1"></a>molt_duration_plot <span class="ot">&lt;-</span> pheno_pred <span class="sc">%&gt;%</span> </span>
<span id="cb35-925"><a href="#cb35-925" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(phase <span class="sc">==</span> <span class="st">"moltdur"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-926"><a href="#cb35-926" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(age)) <span class="sc">+</span></span>
<span id="cb35-927"><a href="#cb35-927" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Predictions by year</span></span>
<span id="cb35-928"><a href="#cb35-928" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(age, predicted, <span class="at">group =</span> <span class="fu">interaction</span>(phase, age_cat, year_fct)), </span>
<span id="cb35-929"><a href="#cb35-929" aria-hidden="true" tabindex="-1"></a>            <span class="fu">filter</span>(phen_pred_years, phase <span class="sc">==</span> <span class="st">"moltdur"</span>),</span>
<span id="cb35-930"><a href="#cb35-930" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span> </span>
<span id="cb35-931"><a href="#cb35-931" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Population-level mean response</span></span>
<span id="cb35-932"><a href="#cb35-932" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> predicted_pop, <span class="at">group =</span> age_cat),</span>
<span id="cb35-933"><a href="#cb35-933" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">linewidth =</span> <span class="fl">1.2</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb35-934"><a href="#cb35-934" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Weighted model (CI + mean)</span></span>
<span id="cb35-935"><a href="#cb35-935" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> conf_lo, <span class="at">ymax =</span> conf_hi, <span class="at">fill =</span> age_cat),</span>
<span id="cb35-936"><a href="#cb35-936" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb35-937"><a href="#cb35-937" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> predicted, <span class="at">color =</span> age_cat, <span class="at">linetype =</span> age_cat)) <span class="sc">+</span></span>
<span id="cb35-938"><a href="#cb35-938" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Summarized data</span></span>
<span id="cb35-939"><a href="#cb35-939" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">y =</span> dur_days, </span>
<span id="cb35-940"><a href="#cb35-940" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ymin =</span> dur_days_lwr, </span>
<span id="cb35-941"><a href="#cb35-941" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ymax =</span> dur_days_upr),</span>
<span id="cb35-942"><a href="#cb35-942" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(pheno_raw, phase <span class="sc">==</span> <span class="st">"moltdur"</span>),</span>
<span id="cb35-943"><a href="#cb35-943" aria-hidden="true" tabindex="-1"></a>                  <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.5</span>), </span>
<span id="cb35-944"><a href="#cb35-944" aria-hidden="true" tabindex="-1"></a>                  <span class="at">size =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb35-945"><a href="#cb35-945" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> age_senesce <span class="sc">-</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb35-946"><a href="#cb35-946" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> n), <span class="at">y =</span> <span class="fl">36.5</span>, <span class="at">vjust =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb35-947"><a href="#cb35-947" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"solid"</span>, <span class="st">"dashed"</span>)) <span class="sc">+</span></span>
<span id="cb35-948"><a href="#cb35-948" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#7fbc41"</span>, <span class="st">"#de77ae"</span>)) <span class="sc">+</span></span>
<span id="cb35-949"><a href="#cb35-949" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#7fbc41"</span>, <span class="st">"#de77ae"</span>)) <span class="sc">+</span></span>
<span id="cb35-950"><a href="#cb35-950" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">15</span>, <span class="dv">40</span>)) <span class="sc">+</span></span>
<span id="cb35-951"><a href="#cb35-951" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Maternal age (years)"</span>,</span>
<span id="cb35-952"><a href="#cb35-952" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Molt haul out (days)"</span>) <span class="sc">+</span></span>
<span id="cb35-953"><a href="#cb35-953" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb35-954"><a href="#cb35-954" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>))</span>
<span id="cb35-955"><a href="#cb35-955" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-956"><a href="#cb35-956" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-957"><a href="#cb35-957" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-960"><a href="#cb35-960" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-961"><a href="#cb35-961" aria-hidden="true" tabindex="-1"></a>pheno_linkinv <span class="ot">&lt;-</span> <span class="fu">family</span>(pheno_model)<span class="sc">$</span>linkinv</span>
<span id="cb35-962"><a href="#cb35-962" aria-hidden="true" tabindex="-1"></a><span class="fu">expand_grid</span>(</span>
<span id="cb35-963"><a href="#cb35-963" aria-hidden="true" tabindex="-1"></a>  <span class="at">age =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">10</span>),</span>
<span id="cb35-964"><a href="#cb35-964" aria-hidden="true" tabindex="-1"></a>  <span class="at">phase =</span> <span class="fu">c</span>(<span class="st">"moltdur"</span>, <span class="st">"breeddur"</span>)</span>
<span id="cb35-965"><a href="#cb35-965" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-966"><a href="#cb35-966" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_cat =</span> <span class="fu">factor</span>(age <span class="sc">&gt;=</span> age_senesce, </span>
<span id="cb35-967"><a href="#cb35-967" aria-hidden="true" tabindex="-1"></a>                          <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Young"</span>)),</span>
<span id="cb35-968"><a href="#cb35-968" aria-hidden="true" tabindex="-1"></a>         <span class="at">age10 =</span> (age <span class="sc">-</span> age_senesce) <span class="sc">/</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-969"><a href="#cb35-969" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dur_days_eta =</span> <span class="fu">predict</span>(pheno_model, <span class="at">newdata =</span> ., <span class="at">re.form =</span> <span class="cn">NA</span>),</span>
<span id="cb35-970"><a href="#cb35-970" aria-hidden="true" tabindex="-1"></a>         <span class="at">dur_days_se =</span> <span class="fu">suppressWarnings</span>(<span class="fu">predict</span>(pheno_model, </span>
<span id="cb35-971"><a href="#cb35-971" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">newdata =</span> ., </span>
<span id="cb35-972"><a href="#cb35-972" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">re.form =</span> <span class="cn">NA</span>, </span>
<span id="cb35-973"><a href="#cb35-973" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">se.fit =</span> <span class="cn">TRUE</span>)<span class="sc">$</span>se.fit),</span>
<span id="cb35-974"><a href="#cb35-974" aria-hidden="true" tabindex="-1"></a>         <span class="at">dur_days =</span> <span class="fu">pheno_linkinv</span>(dur_days_eta),</span>
<span id="cb35-975"><a href="#cb35-975" aria-hidden="true" tabindex="-1"></a>         <span class="at">dur_days_lwr =</span> <span class="fu">pheno_linkinv</span>(dur_days_eta <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> dur_days_se),</span>
<span id="cb35-976"><a href="#cb35-976" aria-hidden="true" tabindex="-1"></a>         <span class="at">dur_days_upr =</span> <span class="fu">pheno_linkinv</span>(dur_days_eta <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> dur_days_se)) <span class="sc">%&gt;%</span> </span>
<span id="cb35-977"><a href="#cb35-977" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>age10, <span class="sc">-</span>dur_days_eta, <span class="sc">-</span>dur_days_se)</span>
<span id="cb35-978"><a href="#cb35-978" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-979"><a href="#cb35-979" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-980"><a href="#cb35-980" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-983"><a href="#cb35-983" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-984"><a href="#cb35-984" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-phen</span></span>
<span id="cb35-985"><a href="#cb35-985" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb35-986"><a href="#cb35-986" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Neither molting nor breeding haul out duration changed with old age. A: Raw data plotting the observed annual time allocation averaged over all n = 387 individuals. B &amp; C: Points and error bars represent the mean and CI for haul out durations. Sample sizes for each age class are included above the points. Thin gray lines show the mean response for each year of the study (i.e., including the random effect of year). Thick solid and dashed lines represent the mean response and 95% CI of the fitted model, weighted by the number of seals observed per year, with solid lines indicating significant trends. The unweighted fitted model is indicated by a dotted gray line. The weighted model is emphasized because of the large impact of the random effect of year."</span></span>
<span id="cb35-987"><a href="#cb35-987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-988"><a href="#cb35-988" aria-hidden="true" tabindex="-1"></a>phenology_unique_animals <span class="ot">&lt;-</span> <span class="fu">unique</span>(seal_phenology<span class="sc">$</span>animalID)</span>
<span id="cb35-989"><a href="#cb35-989" aria-hidden="true" tabindex="-1"></a>n_phenology <span class="ot">&lt;-</span> seal_phenology <span class="sc">%&gt;%</span> </span>
<span id="cb35-990"><a href="#cb35-990" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(year)</span>
<span id="cb35-991"><a href="#cb35-991" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-992"><a href="#cb35-992" aria-hidden="true" tabindex="-1"></a>phen_dist <span class="ot">&lt;-</span> seal_phenology <span class="sc">%&gt;%</span> </span>
<span id="cb35-993"><a href="#cb35-993" aria-hidden="true" tabindex="-1"></a>  <span class="co"># group_by(age) %&gt;% </span></span>
<span id="cb35-994"><a href="#cb35-994" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(age) <span class="sc">%&gt;%</span> </span>
<span id="cb35-995"><a href="#cb35-995" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> n)) <span class="sc">+</span> </span>
<span id="cb35-996"><a href="#cb35-996" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"grey50"</span>) <span class="sc">+</span> </span>
<span id="cb35-997"><a href="#cb35-997" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Maternal age (years)"</span>, <span class="at">y =</span> <span class="st">"Number of individuals"</span>) <span class="sc">+</span> </span>
<span id="cb35-998"><a href="#cb35-998" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>()</span>
<span id="cb35-999"><a href="#cb35-999" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1000"><a href="#cb35-1000" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1001"><a href="#cb35-1001" aria-hidden="true" tabindex="-1"></a>timing_summary <span class="ot">&lt;-</span> seal_phenology <span class="sc">%&gt;%</span> </span>
<span id="cb35-1002"><a href="#cb35-1002" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age) <span class="sc">%&gt;%</span> </span>
<span id="cb35-1003"><a href="#cb35-1003" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(BA<span class="sc">:</span>MD, mean)) <span class="sc">%&gt;%</span> </span>
<span id="cb35-1004"><a href="#cb35-1004" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>age,  </span>
<span id="cb35-1005"><a href="#cb35-1005" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"event"</span>, </span>
<span id="cb35-1006"><a href="#cb35-1006" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"doy"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-1007"><a href="#cb35-1007" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age) <span class="sc">%&gt;%</span> </span>
<span id="cb35-1008"><a href="#cb35-1008" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_modify</span>(\(data, keys) {</span>
<span id="cb35-1009"><a href="#cb35-1009" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tibble</span>(<span class="at">event =</span> <span class="fu">c</span>(<span class="st">"Foraging"</span>, <span class="st">"Breeding haulout"</span>, <span class="st">"Post-breeding"</span>, <span class="st">"Molt haulout"</span>, <span class="st">"foraging2"</span>),</span>
<span id="cb35-1010"><a href="#cb35-1010" aria-hidden="true" tabindex="-1"></a>           <span class="at">doy =</span> <span class="fu">c</span>(data<span class="sc">$</span>doy, <span class="dv">365</span>) <span class="sc">-</span> <span class="fu">c</span>(<span class="dv">0</span>, data<span class="sc">$</span>doy))</span>
<span id="cb35-1011"><a href="#cb35-1011" aria-hidden="true" tabindex="-1"></a>  }) <span class="sc">%&gt;%</span> </span>
<span id="cb35-1012"><a href="#cb35-1012" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb35-1013"><a href="#cb35-1013" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">event =</span> <span class="fu">factor</span>(event, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Foraging"</span>, </span>
<span id="cb35-1014"><a href="#cb35-1014" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">"Breeding haulout"</span>, </span>
<span id="cb35-1015"><a href="#cb35-1015" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">"Post-breeding"</span>, </span>
<span id="cb35-1016"><a href="#cb35-1016" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">"Molt haulout"</span>, </span>
<span id="cb35-1017"><a href="#cb35-1017" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">"foraging2"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb35-1018"><a href="#cb35-1018" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(n_phen_age, <span class="at">by =</span> <span class="st">"age"</span>)</span>
<span id="cb35-1019"><a href="#cb35-1019" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1020"><a href="#cb35-1020" aria-hidden="true" tabindex="-1"></a>annual_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(timing_summary, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> doy, <span class="at">fill =</span> event)) <span class="sc">+</span> </span>
<span id="cb35-1021"><a href="#cb35-1021" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">reverse =</span> <span class="cn">TRUE</span>),</span>
<span id="cb35-1022"><a href="#cb35-1022" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb35-1023"><a href="#cb35-1023" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">reverse =</span> <span class="cn">TRUE</span>),</span>
<span id="cb35-1024"><a href="#cb35-1024" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb35-1025"><a href="#cb35-1025" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_discrete</span>(</span>
<span id="cb35-1026"><a href="#cb35-1026" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="fu">c</span>(<span class="st">"#829BD1"</span>, <span class="st">"#D05794"</span>, <span class="st">"#829BD1"</span>, <span class="st">"#E09A2D"</span>, <span class="st">"#829BD1"</span>),</span>
<span id="cb35-1027"><a href="#cb35-1027" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"Foraging"</span>, <span class="st">"Breeding haulout"</span>, <span class="st">"Molt haulout"</span>)</span>
<span id="cb35-1028"><a href="#cb35-1028" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb35-1029"><a href="#cb35-1029" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Maternal age (years)"</span>, <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb35-1030"><a href="#cb35-1030" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Day of year"</span>, <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb35-1031"><a href="#cb35-1031" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="st">"Breeding haul out"</span>), </span>
<span id="cb35-1032"><a href="#cb35-1032" aria-hidden="true" tabindex="-1"></a>            <span class="at">x =</span> <span class="dv">9</span>,</span>
<span id="cb35-1033"><a href="#cb35-1033" aria-hidden="true" tabindex="-1"></a>            <span class="at">y =</span> <span class="dv">30</span>,</span>
<span id="cb35-1034"><a href="#cb35-1034" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb35-1035"><a href="#cb35-1035" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="st">"Molting haul out"</span>), </span>
<span id="cb35-1036"><a href="#cb35-1036" aria-hidden="true" tabindex="-1"></a>            <span class="at">x =</span> <span class="dv">9</span>,</span>
<span id="cb35-1037"><a href="#cb35-1037" aria-hidden="true" tabindex="-1"></a>            <span class="at">y =</span> <span class="dv">135</span>,</span>
<span id="cb35-1038"><a href="#cb35-1038" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span> </span>
<span id="cb35-1039"><a href="#cb35-1039" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="st">"Foraging"</span>), </span>
<span id="cb35-1040"><a href="#cb35-1040" aria-hidden="true" tabindex="-1"></a>            <span class="at">x =</span> <span class="dv">8</span>,</span>
<span id="cb35-1041"><a href="#cb35-1041" aria-hidden="true" tabindex="-1"></a>            <span class="at">y =</span> <span class="dv">250</span>,</span>
<span id="cb35-1042"><a href="#cb35-1042" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span> </span>
<span id="cb35-1043"><a href="#cb35-1043" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">"lines"</span>), </span>
<span id="cb35-1044"><a href="#cb35-1044" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"none"</span>) </span>
<span id="cb35-1045"><a href="#cb35-1045" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1046"><a href="#cb35-1046" aria-hidden="true" tabindex="-1"></a>design <span class="ot">&lt;-</span> <span class="st">"</span></span>
<span id="cb35-1047"><a href="#cb35-1047" aria-hidden="true" tabindex="-1"></a><span class="st">  12</span></span>
<span id="cb35-1048"><a href="#cb35-1048" aria-hidden="true" tabindex="-1"></a><span class="st">  13</span></span>
<span id="cb35-1049"><a href="#cb35-1049" aria-hidden="true" tabindex="-1"></a><span class="st">"</span></span>
<span id="cb35-1050"><a href="#cb35-1050" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1051"><a href="#cb35-1051" aria-hidden="true" tabindex="-1"></a>annual_plot <span class="sc">+</span> breed_duration_plot <span class="sc">+</span> molt_duration_plot <span class="sc">+</span> </span>
<span id="cb35-1052"><a href="#cb35-1052" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">tag_levels =</span> <span class="st">"A"</span>) <span class="sc">+</span> </span>
<span id="cb35-1053"><a href="#cb35-1053" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">design =</span> design, </span>
<span id="cb35-1054"><a href="#cb35-1054" aria-hidden="true" tabindex="-1"></a>              <span class="at">widths =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)) </span>
<span id="cb35-1055"><a href="#cb35-1055" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-1056"><a href="#cb35-1056" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1057"><a href="#cb35-1057" aria-hidden="true" tabindex="-1"></a>Sample size n = <span class="in">`r nrow(seal_phenology)`</span> observations of <span class="in">`r n_distinct(phenology_unique_animals)`</span> individuals.</span>
<span id="cb35-1058"><a href="#cb35-1058" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1059"><a href="#cb35-1059" aria-hidden="true" tabindex="-1"></a><span class="fu"># Supplemental Material</span></span>
<span id="cb35-1060"><a href="#cb35-1060" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1061"><a href="#cb35-1061" aria-hidden="true" tabindex="-1"></a><span class="fu">## Detailed model outputs</span></span>
<span id="cb35-1062"><a href="#cb35-1062" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1063"><a href="#cb35-1063" aria-hidden="true" tabindex="-1"></a><span class="fu">### H1: Reproductive senescence</span></span>
<span id="cb35-1064"><a href="#cb35-1064" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1067"><a href="#cb35-1067" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-1068"><a href="#cb35-1068" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: detailed-h1</span></span>
<span id="cb35-1069"><a href="#cb35-1069" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1070"><a href="#cb35-1070" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(breed_age_mod)</span>
<span id="cb35-1071"><a href="#cb35-1071" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1072"><a href="#cb35-1072" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-1073"><a href="#cb35-1073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1074"><a href="#cb35-1074" aria-hidden="true" tabindex="-1"></a><span class="fu">### H2: Maternal effect senescence</span></span>
<span id="cb35-1075"><a href="#cb35-1075" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1078"><a href="#cb35-1078" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-1079"><a href="#cb35-1079" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: detailed-h2</span></span>
<span id="cb35-1080"><a href="#cb35-1080" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1081"><a href="#cb35-1081" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pup_surv_mod)</span>
<span id="cb35-1082"><a href="#cb35-1082" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pup_recr_mod)</span>
<span id="cb35-1083"><a href="#cb35-1083" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1084"><a href="#cb35-1084" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-1085"><a href="#cb35-1085" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1086"><a href="#cb35-1086" aria-hidden="true" tabindex="-1"></a><span class="fu">### H3: Offspring sex ratio</span></span>
<span id="cb35-1087"><a href="#cb35-1087" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1090"><a href="#cb35-1090" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-1091"><a href="#cb35-1091" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: detailed-h3</span></span>
<span id="cb35-1092"><a href="#cb35-1092" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1093"><a href="#cb35-1093" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(sexrat_age_mod)</span>
<span id="cb35-1094"><a href="#cb35-1094" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1095"><a href="#cb35-1095" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-1096"><a href="#cb35-1096" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1097"><a href="#cb35-1097" aria-hidden="true" tabindex="-1"></a><span class="fu">### H4: Phenology</span></span>
<span id="cb35-1098"><a href="#cb35-1098" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1101"><a href="#cb35-1101" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-1102"><a href="#cb35-1102" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: detailed-h4</span></span>
<span id="cb35-1103"><a href="#cb35-1103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1104"><a href="#cb35-1104" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pheno_model)</span>
<span id="cb35-1105"><a href="#cb35-1105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1106"><a href="#cb35-1106" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-1107"><a href="#cb35-1107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1108"><a href="#cb35-1108" aria-hidden="true" tabindex="-1"></a><span class="fu">## Models' sensitivity to age of senescence</span></span>
<span id="cb35-1109"><a href="#cb35-1109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1112"><a href="#cb35-1112" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-1113"><a href="#cb35-1113" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: mod-sens</span></span>
<span id="cb35-1114"><a href="#cb35-1114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1115"><a href="#cb35-1115" aria-hidden="true" tabindex="-1"></a>fit_models <span class="ot">&lt;-</span> <span class="cf">function</span>(a) {</span>
<span id="cb35-1116"><a href="#cb35-1116" aria-hidden="true" tabindex="-1"></a>  age_senesce <span class="ot">&lt;-</span> a</span>
<span id="cb35-1117"><a href="#cb35-1117" aria-hidden="true" tabindex="-1"></a>  sealdat <span class="ot">&lt;-</span> sealdat <span class="sc">%&gt;%</span> </span>
<span id="cb35-1118"><a href="#cb35-1118" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">age_cat =</span> <span class="fu">factor</span>(age <span class="sc">&gt;=</span> age_senesce, </span>
<span id="cb35-1119"><a href="#cb35-1119" aria-hidden="true" tabindex="-1"></a>                            <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Young"</span>, <span class="st">"Old"</span>)))</span>
<span id="cb35-1120"><a href="#cb35-1120" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-1121"><a href="#cb35-1121" aria-hidden="true" tabindex="-1"></a>  <span class="co"># H1</span></span>
<span id="cb35-1122"><a href="#cb35-1122" aria-hidden="true" tabindex="-1"></a>  breed_age_mod <span class="ot">&lt;-</span> <span class="fu">glmer</span>(</span>
<span id="cb35-1123"><a href="#cb35-1123" aria-hidden="true" tabindex="-1"></a>    observed_int <span class="sc">~</span> age10 <span class="sc">:</span> age_cat <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> animalID) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> year_fct),</span>
<span id="cb35-1124"><a href="#cb35-1124" aria-hidden="true" tabindex="-1"></a>    sealdat,</span>
<span id="cb35-1125"><a href="#cb35-1125" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">"binomial"</span>,</span>
<span id="cb35-1126"><a href="#cb35-1126" aria-hidden="true" tabindex="-1"></a>    <span class="at">control =</span> <span class="fu">glmerControl</span>(<span class="at">optimizer =</span> <span class="st">"bobyqa"</span>)</span>
<span id="cb35-1127"><a href="#cb35-1127" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb35-1128"><a href="#cb35-1128" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-1129"><a href="#cb35-1129" aria-hidden="true" tabindex="-1"></a>  <span class="co"># H2</span></span>
<span id="cb35-1130"><a href="#cb35-1130" aria-hidden="true" tabindex="-1"></a>  surv_recr_data <span class="ot">&lt;-</span> sealdat <span class="sc">%&gt;%</span> </span>
<span id="cb35-1131"><a href="#cb35-1131" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_na</span>(pupID) <span class="sc">%&gt;%</span> </span>
<span id="cb35-1132"><a href="#cb35-1132" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(pupyearborn <span class="sc">&lt;=</span> <span class="dv">2016</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-1133"><a href="#cb35-1133" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">pup_surv_int =</span> <span class="fu">as.integer</span>(pup_survived),</span>
<span id="cb35-1134"><a href="#cb35-1134" aria-hidden="true" tabindex="-1"></a>           <span class="at">pup_recr_int =</span> <span class="fu">as.integer</span>(puprecruited)) </span>
<span id="cb35-1135"><a href="#cb35-1135" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-1136"><a href="#cb35-1136" aria-hidden="true" tabindex="-1"></a>  pup_surv_mod <span class="ot">&lt;-</span> <span class="fu">glmer</span>(</span>
<span id="cb35-1137"><a href="#cb35-1137" aria-hidden="true" tabindex="-1"></a>    pup_surv_int <span class="sc">~</span> age10 <span class="sc">:</span> age_cat <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> animalID) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> year_fct),</span>
<span id="cb35-1138"><a href="#cb35-1138" aria-hidden="true" tabindex="-1"></a>    surv_recr_data,</span>
<span id="cb35-1139"><a href="#cb35-1139" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">"binomial"</span>,</span>
<span id="cb35-1140"><a href="#cb35-1140" aria-hidden="true" tabindex="-1"></a>    <span class="at">control =</span> <span class="fu">glmerControl</span>(<span class="at">optimizer =</span> <span class="st">"bobyqa"</span>)</span>
<span id="cb35-1141"><a href="#cb35-1141" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb35-1142"><a href="#cb35-1142" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-1143"><a href="#cb35-1143" aria-hidden="true" tabindex="-1"></a>  pup_recr_mod <span class="ot">&lt;-</span> <span class="fu">glmer</span>(</span>
<span id="cb35-1144"><a href="#cb35-1144" aria-hidden="true" tabindex="-1"></a>    pup_recr_int <span class="sc">~</span> age10 <span class="sc">:</span> age_cat <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> year_fct),</span>
<span id="cb35-1145"><a href="#cb35-1145" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(surv_recr_data, pupsex <span class="sc">==</span> <span class="st">"F"</span>),</span>
<span id="cb35-1146"><a href="#cb35-1146" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">"binomial"</span>,</span>
<span id="cb35-1147"><a href="#cb35-1147" aria-hidden="true" tabindex="-1"></a>    <span class="at">control =</span> <span class="fu">glmerControl</span>(<span class="at">optimizer =</span> <span class="st">"bobyqa"</span>)</span>
<span id="cb35-1148"><a href="#cb35-1148" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb35-1149"><a href="#cb35-1149" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-1150"><a href="#cb35-1150" aria-hidden="true" tabindex="-1"></a>  <span class="co"># H3</span></span>
<span id="cb35-1151"><a href="#cb35-1151" aria-hidden="true" tabindex="-1"></a>  pup_sex_data <span class="ot">&lt;-</span> sealdat <span class="sc">%&gt;%</span> </span>
<span id="cb35-1152"><a href="#cb35-1152" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(pupsex <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"M"</span>, <span class="st">"F"</span>), </span>
<span id="cb35-1153"><a href="#cb35-1153" aria-hidden="true" tabindex="-1"></a>           age <span class="sc">&lt;</span> <span class="dv">19</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-1154"><a href="#cb35-1154" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">is_male =</span> <span class="fu">as.integer</span>(pupsex <span class="sc">==</span> <span class="st">"M"</span>))</span>
<span id="cb35-1155"><a href="#cb35-1155" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-1156"><a href="#cb35-1156" aria-hidden="true" tabindex="-1"></a>  sexrat_age_mod <span class="ot">&lt;-</span> <span class="fu">glmer</span>(</span>
<span id="cb35-1157"><a href="#cb35-1157" aria-hidden="true" tabindex="-1"></a>    is_male <span class="sc">~</span> age10 <span class="sc">:</span> age_cat <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> animalID) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> year_fct),</span>
<span id="cb35-1158"><a href="#cb35-1158" aria-hidden="true" tabindex="-1"></a>    pup_sex_data,</span>
<span id="cb35-1159"><a href="#cb35-1159" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">"binomial"</span></span>
<span id="cb35-1160"><a href="#cb35-1160" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb35-1161"><a href="#cb35-1161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1162"><a href="#cb35-1162" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb35-1163"><a href="#cb35-1163" aria-hidden="true" tabindex="-1"></a>    <span class="at">h1 =</span> <span class="fu">summary</span>(breed_age_mod)<span class="sc">$</span>coefficients,</span>
<span id="cb35-1164"><a href="#cb35-1164" aria-hidden="true" tabindex="-1"></a>    <span class="at">h2_surv =</span> <span class="fu">summary</span>(pup_surv_mod)<span class="sc">$</span>coefficients,</span>
<span id="cb35-1165"><a href="#cb35-1165" aria-hidden="true" tabindex="-1"></a>    <span class="at">h2_recr =</span> <span class="fu">summary</span>(pup_recr_mod)<span class="sc">$</span>coefficients,</span>
<span id="cb35-1166"><a href="#cb35-1166" aria-hidden="true" tabindex="-1"></a>    <span class="at">h3 =</span> <span class="fu">summary</span>(sexrat_age_mod)<span class="sc">$</span>coefficients,</span>
<span id="cb35-1167"><a href="#cb35-1167" aria-hidden="true" tabindex="-1"></a>    <span class="at">h1_aic =</span> <span class="fu">AIC</span>(breed_age_mod),</span>
<span id="cb35-1168"><a href="#cb35-1168" aria-hidden="true" tabindex="-1"></a>    <span class="at">h2_surv_aic =</span> <span class="fu">AIC</span>(pup_surv_mod),</span>
<span id="cb35-1169"><a href="#cb35-1169" aria-hidden="true" tabindex="-1"></a>    <span class="at">h2_recr_aic =</span> <span class="fu">AIC</span>(pup_recr_mod),</span>
<span id="cb35-1170"><a href="#cb35-1170" aria-hidden="true" tabindex="-1"></a>    <span class="at">h3_aic =</span> <span class="fu">AIC</span>(sexrat_age_mod)</span>
<span id="cb35-1171"><a href="#cb35-1171" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb35-1172"><a href="#cb35-1172" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-1173"><a href="#cb35-1173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1174"><a href="#cb35-1174" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit models with cut-off at ages 8-13</span></span>
<span id="cb35-1175"><a href="#cb35-1175" aria-hidden="true" tabindex="-1"></a>cutoff <span class="ot">&lt;-</span> <span class="dv">6</span><span class="sc">:</span><span class="dv">14</span></span>
<span id="cb35-1176"><a href="#cb35-1176" aria-hidden="true" tabindex="-1"></a>mod_sens <span class="ot">&lt;-</span> <span class="fu">map</span>(cutoff, fit_models)</span>
<span id="cb35-1177"><a href="#cb35-1177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1178"><a href="#cb35-1178" aria-hidden="true" tabindex="-1"></a><span class="co"># Are hypotheses supported by the model? note to future readers...this part could have been done way easier, and you will have to trust our process that this was the path of least resistence for us at the point of final revisions!</span></span>
<span id="cb35-1179"><a href="#cb35-1179" aria-hidden="true" tabindex="-1"></a>extract_p <span class="ot">&lt;-</span> <span class="cf">function</span>(h, <span class="at">tails =</span> <span class="dv">1</span>) {</span>
<span id="cb35-1180"><a href="#cb35-1180" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (tails <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb35-1181"><a href="#cb35-1181" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map_dbl</span>(mod_sens, \(m) <span class="fu">pnorm</span>(m[[h]][<span class="st">"age10:age_catOld"</span>, <span class="st">"z value"</span>]))</span>
<span id="cb35-1182"><a href="#cb35-1182" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (tails <span class="sc">==</span> <span class="dv">2</span>) {</span>
<span id="cb35-1183"><a href="#cb35-1183" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map_dbl</span>(mod_sens, \(m) <span class="dv">2</span> <span class="sc">*</span> <span class="fu">pnorm</span>(m[[h]][<span class="st">"age10:age_catOld"</span>, <span class="st">"z value"</span>],</span>
<span id="cb35-1184"><a href="#cb35-1184" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">lower.tail =</span> (m[[h]][<span class="st">"age10:age_catOld"</span>, <span class="st">"z value"</span>] <span class="sc">&lt;</span> <span class="dv">0</span>)</span>
<span id="cb35-1185"><a href="#cb35-1185" aria-hidden="true" tabindex="-1"></a>                                     ))</span>
<span id="cb35-1186"><a href="#cb35-1186" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb35-1187"><a href="#cb35-1187" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"tails must be 1 or 2"</span>)</span>
<span id="cb35-1188"><a href="#cb35-1188" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb35-1189"><a href="#cb35-1189" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-1190"><a href="#cb35-1190" aria-hidden="true" tabindex="-1"></a>extract_aic <span class="ot">&lt;-</span> <span class="cf">function</span>(h) {</span>
<span id="cb35-1191"><a href="#cb35-1191" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dbl</span>(mod_sens, <span class="fu">paste</span>(h, <span class="st">"aic"</span>, <span class="at">sep =</span> <span class="st">"_"</span>))</span>
<span id="cb35-1192"><a href="#cb35-1192" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-1193"><a href="#cb35-1193" aria-hidden="true" tabindex="-1"></a>p_tbl <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">age_cutoff =</span> cutoff, </span>
<span id="cb35-1194"><a href="#cb35-1194" aria-hidden="true" tabindex="-1"></a>                <span class="st">"H1 (breeding)"</span> <span class="ot">=</span> <span class="fu">extract_p</span>(<span class="st">"h1"</span>, <span class="at">tails =</span> <span class="dv">2</span>),</span>
<span id="cb35-1195"><a href="#cb35-1195" aria-hidden="true" tabindex="-1"></a>                <span class="st">"H2a (survival)"</span> <span class="ot">=</span> <span class="fu">extract_p</span>(<span class="st">"h2_surv"</span>, <span class="at">tails =</span> <span class="dv">2</span>),</span>
<span id="cb35-1196"><a href="#cb35-1196" aria-hidden="true" tabindex="-1"></a>                <span class="st">"H2b (recruitment)"</span> <span class="ot">=</span> <span class="fu">extract_p</span>(<span class="st">"h2_recr"</span>, <span class="at">tails =</span> <span class="dv">2</span>),</span>
<span id="cb35-1197"><a href="#cb35-1197" aria-hidden="true" tabindex="-1"></a>                <span class="st">"H3 (sex ratio; 2 tail)"</span> <span class="ot">=</span> <span class="fu">extract_p</span>(<span class="st">"h3"</span>, <span class="at">tails =</span> <span class="dv">2</span>))</span>
<span id="cb35-1198"><a href="#cb35-1198" aria-hidden="true" tabindex="-1"></a>aic_weight <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb35-1199"><a href="#cb35-1199" aria-hidden="true" tabindex="-1"></a>  rellik <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.5</span> <span class="sc">*</span> (x <span class="sc">-</span> <span class="fu">min</span>(x)))</span>
<span id="cb35-1200"><a href="#cb35-1200" aria-hidden="true" tabindex="-1"></a>  rellik <span class="sc">/</span> <span class="fu">sum</span>(rellik)</span>
<span id="cb35-1201"><a href="#cb35-1201" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-1202"><a href="#cb35-1202" aria-hidden="true" tabindex="-1"></a>aic_tbl <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">age_cutoff =</span> cutoff,</span>
<span id="cb35-1203"><a href="#cb35-1203" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"H1 (breeding)"</span> <span class="ot">=</span> <span class="fu">extract_aic</span>(<span class="st">"h1"</span>),</span>
<span id="cb35-1204"><a href="#cb35-1204" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"H2a (survival)"</span> <span class="ot">=</span> <span class="fu">extract_aic</span>(<span class="st">"h2_surv"</span>),</span>
<span id="cb35-1205"><a href="#cb35-1205" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"H2b (recruitment)"</span> <span class="ot">=</span> <span class="fu">extract_aic</span>(<span class="st">"h2_recr"</span>),</span>
<span id="cb35-1206"><a href="#cb35-1206" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"H3 (sex ratio)"</span> <span class="ot">=</span> <span class="fu">extract_aic</span>(<span class="st">"h3"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb35-1207"><a href="#cb35-1207" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="sc">-</span>age_cutoff, aic_weight))</span>
<span id="cb35-1208"><a href="#cb35-1208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1209"><a href="#cb35-1209" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(p_tbl)</span>
<span id="cb35-1210"><a href="#cb35-1210" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(aic_tbl)</span>
<span id="cb35-1211"><a href="#cb35-1211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1212"><a href="#cb35-1212" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-1213"><a href="#cb35-1213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1216"><a href="#cb35-1216" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-1217"><a href="#cb35-1217" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-mod-sens</span></span>
<span id="cb35-1218"><a href="#cb35-1218" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Model sensitivity to onset of senescence. Age at onset of senescence on the x-axis, p-value for the coefficient of the interaction (age category = post-senescence) x (response variable) on the y-axis. Statistical significance (p = 0.05) indicated by dashed line. Hypotheses H1 (reproductive senescence), H2b (maternal-effect senescence; offspring recruitment), and H3 (offspring sex ratio) were insensitive to choice of age for onset of senescence. Hypothesis H2a (maternal-effect senescence; offspring survival) was significantly supported for onset of senescence age 11+. At age 10, the p-vale for the coefficient of the interaction (age category = post-senescence) x (offspring survival) was 0.058."</span></span>
<span id="cb35-1219"><a href="#cb35-1219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1220"><a href="#cb35-1220" aria-hidden="true" tabindex="-1"></a>p_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb35-1221"><a href="#cb35-1221" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>age_cutoff, <span class="at">names_to =</span> <span class="st">"hypothesis"</span>, <span class="at">values_to =</span> <span class="st">"p"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb35-1222"><a href="#cb35-1222" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hypgrp =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(hypothesis, <span class="st">"H3"</span>), </span>
<span id="cb35-1223"><a href="#cb35-1223" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"H3 (sex ratio)"</span>, </span>
<span id="cb35-1224"><a href="#cb35-1224" aria-hidden="true" tabindex="-1"></a>                         hypothesis)) <span class="sc">%&gt;%</span> </span>
<span id="cb35-1225"><a href="#cb35-1225" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(age_cutoff, p)) <span class="sc">+</span></span>
<span id="cb35-1226"><a href="#cb35-1226" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> hypothesis <span class="sc">==</span> <span class="st">"H3 (sex ratio; 2 tail)"</span>)) <span class="sc">+</span></span>
<span id="cb35-1227"><a href="#cb35-1227" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.05</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb35-1228"><a href="#cb35-1228" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(x, y, <span class="at">label =</span> tag),</span>
<span id="cb35-1229"><a href="#cb35-1229" aria-hidden="true" tabindex="-1"></a>            <span class="fu">tibble</span>(<span class="at">hypgrp =</span> <span class="fu">colnames</span>(p_tbl)[<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>],</span>
<span id="cb35-1230"><a href="#cb35-1230" aria-hidden="true" tabindex="-1"></a>                   <span class="at">tag =</span> LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>],</span>
<span id="cb35-1231"><a href="#cb35-1231" aria-hidden="true" tabindex="-1"></a>                   <span class="at">x =</span> <span class="dv">8</span>, <span class="at">y =</span> <span class="dv">3</span>),</span>
<span id="cb35-1232"><a href="#cb35-1232" aria-hidden="true" tabindex="-1"></a>            <span class="at">vjust =</span> <span class="dv">1</span>,</span>
<span id="cb35-1233"><a href="#cb35-1233" aria-hidden="true" tabindex="-1"></a>            <span class="at">fontface =</span> <span class="st">"bold"</span>) <span class="sc">+</span></span>
<span id="cb35-1234"><a href="#cb35-1234" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span>number) <span class="sc">+</span></span>
<span id="cb35-1235"><a href="#cb35-1235" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"grey50"</span>)) <span class="sc">+</span></span>
<span id="cb35-1236"><a href="#cb35-1236" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Senescence onset (years)"</span>) <span class="sc">+</span></span>
<span id="cb35-1237"><a href="#cb35-1237" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">y =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb35-1238"><a href="#cb35-1238" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>hypgrp) <span class="sc">+</span></span>
<span id="cb35-1239"><a href="#cb35-1239" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb35-1240"><a href="#cb35-1240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1241"><a href="#cb35-1241" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-1242"><a href="#cb35-1242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1243"><a href="#cb35-1243" aria-hidden="true" tabindex="-1"></a><span class="fu">## Selective appearance and disappearance</span></span>
<span id="cb35-1244"><a href="#cb35-1244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1245"><a href="#cb35-1245" aria-hidden="true" tabindex="-1"></a>Age-dependent life history shifts can result from within- or between-animal changes <span class="co">[</span><span class="ot">@vandepol2006</span><span class="co">]</span>. We hypothesized age-dependent changes in reproduction were due to senescence, i.e. within-animal changes. However, it is possible that selective appearance or disappearance of animals in the population can create the same pattern. For example, if animals the breed more frequently have lower survival, then older animals will reproduce less frequently not because of senescence but rather because infrequent breeders disproportionately survive to older ages (i.e. selective disappearance). We tested whether our significant results (reproductive senescence, maternal effect senescence in pup survival) were influenced by selective appearance and disappearance, following the methods of @vandepol2006, by adding terms for age at first and last reproduction, respectively. If our results are due to selective appearance/disappearance instead of senescence, then the 95% CI for the coefficient of age in the old age class in these models will overlap 0.</span>
<span id="cb35-1246"><a href="#cb35-1246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1249"><a href="#cb35-1249" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-1250"><a href="#cb35-1250" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-selective</span></span>
<span id="cb35-1251"><a href="#cb35-1251" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "The coefficient for age in the old age class in models accounting for selective appearance and disappearance. Red and blue indicate  reproductive senescence (H1) and maternal effect senescence (H2a), respectively. Compared to the base model, the appearance model includes a term for age at first reproduction, the disappearance model includes a term for age at last reproduction, and the combined model includes both."</span></span>
<span id="cb35-1252"><a href="#cb35-1252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1253"><a href="#cb35-1253" aria-hidden="true" tabindex="-1"></a>h1_selective_models <span class="ot">&lt;-</span> <span class="fu">map</span>(</span>
<span id="cb35-1254"><a href="#cb35-1254" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb35-1255"><a href="#cb35-1255" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Base model</span></span>
<span id="cb35-1256"><a href="#cb35-1256" aria-hidden="true" tabindex="-1"></a>    observed_int <span class="sc">~</span> age10 <span class="sc">:</span> age_cat <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> animalID) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> year_fct),</span>
<span id="cb35-1257"><a href="#cb35-1257" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Selective appearance</span></span>
<span id="cb35-1258"><a href="#cb35-1258" aria-hidden="true" tabindex="-1"></a>    observed_int <span class="sc">~</span> age10 <span class="sc">:</span> age_cat <span class="sc">+</span> firstrepro <span class="sc">+</span> </span>
<span id="cb35-1259"><a href="#cb35-1259" aria-hidden="true" tabindex="-1"></a>      (<span class="dv">1</span> <span class="sc">|</span> animalID) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> year_fct),</span>
<span id="cb35-1260"><a href="#cb35-1260" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Selective disappearance</span></span>
<span id="cb35-1261"><a href="#cb35-1261" aria-hidden="true" tabindex="-1"></a>    observed_int <span class="sc">~</span> age10 <span class="sc">:</span> age_cat <span class="sc">+</span> lastrepro <span class="sc">+</span> </span>
<span id="cb35-1262"><a href="#cb35-1262" aria-hidden="true" tabindex="-1"></a>      (<span class="dv">1</span> <span class="sc">|</span> animalID) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> year_fct),</span>
<span id="cb35-1263"><a href="#cb35-1263" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Selective appearance and disappearance</span></span>
<span id="cb35-1264"><a href="#cb35-1264" aria-hidden="true" tabindex="-1"></a>    observed_int <span class="sc">~</span> age10 <span class="sc">:</span> age_cat <span class="sc">+</span> firstrepro <span class="sc">+</span> lastrepro <span class="sc">+</span></span>
<span id="cb35-1265"><a href="#cb35-1265" aria-hidden="true" tabindex="-1"></a>      (<span class="dv">1</span> <span class="sc">|</span> animalID) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> year_fct)</span>
<span id="cb35-1266"><a href="#cb35-1266" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb35-1267"><a href="#cb35-1267" aria-hidden="true" tabindex="-1"></a>  \(form) {</span>
<span id="cb35-1268"><a href="#cb35-1268" aria-hidden="true" tabindex="-1"></a>    <span class="fu">glmer</span>(form, </span>
<span id="cb35-1269"><a href="#cb35-1269" aria-hidden="true" tabindex="-1"></a>          <span class="fu">drop_na</span>(sealdat, lastrepro), </span>
<span id="cb35-1270"><a href="#cb35-1270" aria-hidden="true" tabindex="-1"></a>          <span class="at">family =</span> <span class="st">"binomial"</span>, </span>
<span id="cb35-1271"><a href="#cb35-1271" aria-hidden="true" tabindex="-1"></a>          <span class="at">control =</span> <span class="fu">glmerControl</span>(<span class="at">optimizer =</span> <span class="st">"bobyqa"</span>))</span>
<span id="cb35-1272"><a href="#cb35-1272" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb35-1273"><a href="#cb35-1273" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-1274"><a href="#cb35-1274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1275"><a href="#cb35-1275" aria-hidden="true" tabindex="-1"></a>h2_selective_models <span class="ot">&lt;-</span> <span class="fu">map</span>(</span>
<span id="cb35-1276"><a href="#cb35-1276" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb35-1277"><a href="#cb35-1277" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Base model</span></span>
<span id="cb35-1278"><a href="#cb35-1278" aria-hidden="true" tabindex="-1"></a>    pup_surv_int <span class="sc">~</span> age10 <span class="sc">:</span> age_cat <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> animalID) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> year_fct),</span>
<span id="cb35-1279"><a href="#cb35-1279" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Selective appearance</span></span>
<span id="cb35-1280"><a href="#cb35-1280" aria-hidden="true" tabindex="-1"></a>    pup_surv_int <span class="sc">~</span> age10 <span class="sc">:</span> age_cat <span class="sc">+</span> firstrepro <span class="sc">+</span> </span>
<span id="cb35-1281"><a href="#cb35-1281" aria-hidden="true" tabindex="-1"></a>      (<span class="dv">1</span> <span class="sc">|</span> animalID) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> year_fct),</span>
<span id="cb35-1282"><a href="#cb35-1282" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Selective disappearance</span></span>
<span id="cb35-1283"><a href="#cb35-1283" aria-hidden="true" tabindex="-1"></a>    pup_surv_int <span class="sc">~</span> age10 <span class="sc">:</span> age_cat <span class="sc">+</span> lastrepro <span class="sc">+</span> </span>
<span id="cb35-1284"><a href="#cb35-1284" aria-hidden="true" tabindex="-1"></a>      (<span class="dv">1</span> <span class="sc">|</span> animalID) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> year_fct),</span>
<span id="cb35-1285"><a href="#cb35-1285" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Selective appearance and disappearance</span></span>
<span id="cb35-1286"><a href="#cb35-1286" aria-hidden="true" tabindex="-1"></a>    pup_surv_int <span class="sc">~</span> age10 <span class="sc">:</span> age_cat <span class="sc">+</span> firstrepro <span class="sc">+</span> lastrepro <span class="sc">+</span></span>
<span id="cb35-1287"><a href="#cb35-1287" aria-hidden="true" tabindex="-1"></a>      (<span class="dv">1</span> <span class="sc">|</span> animalID) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> year_fct)</span>
<span id="cb35-1288"><a href="#cb35-1288" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb35-1289"><a href="#cb35-1289" aria-hidden="true" tabindex="-1"></a>  \(form) {</span>
<span id="cb35-1290"><a href="#cb35-1290" aria-hidden="true" tabindex="-1"></a>    <span class="fu">glmer</span>(form, </span>
<span id="cb35-1291"><a href="#cb35-1291" aria-hidden="true" tabindex="-1"></a>          <span class="fu">drop_na</span>(surv_recr_data, lastrepro), </span>
<span id="cb35-1292"><a href="#cb35-1292" aria-hidden="true" tabindex="-1"></a>          <span class="at">family =</span> <span class="st">"binomial"</span>, </span>
<span id="cb35-1293"><a href="#cb35-1293" aria-hidden="true" tabindex="-1"></a>          <span class="at">control =</span> <span class="fu">glmerControl</span>(<span class="at">optimizer =</span> <span class="st">"bobyqa"</span>))</span>
<span id="cb35-1294"><a href="#cb35-1294" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb35-1295"><a href="#cb35-1295" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-1296"><a href="#cb35-1296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1297"><a href="#cb35-1297" aria-hidden="true" tabindex="-1"></a>get_old_coef <span class="ot">&lt;-</span> <span class="cf">function</span>(model) {</span>
<span id="cb35-1298"><a href="#cb35-1298" aria-hidden="true" tabindex="-1"></a>  old_coef <span class="ot">&lt;-</span> <span class="fu">summary</span>(model)<span class="sc">$</span>coefficients[<span class="st">"age10:age_catOld"</span>, <span class="st">"Estimate"</span>]</span>
<span id="cb35-1299"><a href="#cb35-1299" aria-hidden="true" tabindex="-1"></a>  old_se <span class="ot">&lt;-</span> <span class="fu">summary</span>(model)<span class="sc">$</span>coefficients[<span class="st">"age10:age_catOld"</span>, <span class="st">"Std. Error"</span>]</span>
<span id="cb35-1300"><a href="#cb35-1300" aria-hidden="true" tabindex="-1"></a>  ci <span class="ot">&lt;-</span> old_coef <span class="sc">+</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.96</span>, <span class="fl">1.96</span>) <span class="sc">*</span> old_se</span>
<span id="cb35-1301"><a href="#cb35-1301" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">mean =</span> old_coef, </span>
<span id="cb35-1302"><a href="#cb35-1302" aria-hidden="true" tabindex="-1"></a>         <span class="at">lwr =</span> ci[<span class="dv">1</span>], </span>
<span id="cb35-1303"><a href="#cb35-1303" aria-hidden="true" tabindex="-1"></a>         <span class="at">upr =</span> ci[<span class="dv">2</span>])</span>
<span id="cb35-1304"><a href="#cb35-1304" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-1305"><a href="#cb35-1305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1306"><a href="#cb35-1306" aria-hidden="true" tabindex="-1"></a>h1_selective_coef <span class="ot">&lt;-</span> <span class="fu">map</span>(h1_selective_models, get_old_coef) <span class="sc">%&gt;%</span> </span>
<span id="cb35-1307"><a href="#cb35-1307" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list_rbind</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb35-1308"><a href="#cb35-1308" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">c</span>(<span class="st">"Base"</span>, <span class="st">"Appearance"</span>, <span class="st">"Disappearance"</span>, <span class="st">"Combined"</span>),</span>
<span id="cb35-1309"><a href="#cb35-1309" aria-hidden="true" tabindex="-1"></a>         <span class="at">hypothesis =</span> <span class="st">"H1"</span>) </span>
<span id="cb35-1310"><a href="#cb35-1310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1311"><a href="#cb35-1311" aria-hidden="true" tabindex="-1"></a>h2_selective_coef <span class="ot">&lt;-</span> <span class="fu">map</span>(h2_selective_models, get_old_coef) <span class="sc">%&gt;%</span> </span>
<span id="cb35-1312"><a href="#cb35-1312" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list_rbind</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb35-1313"><a href="#cb35-1313" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">c</span>(<span class="st">"Base"</span>, <span class="st">"Appearance"</span>, <span class="st">"Disappearance"</span>, <span class="st">"Combined"</span>), </span>
<span id="cb35-1314"><a href="#cb35-1314" aria-hidden="true" tabindex="-1"></a>         <span class="at">hypothesis =</span> <span class="st">"H2"</span>) </span>
<span id="cb35-1315"><a href="#cb35-1315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1316"><a href="#cb35-1316" aria-hidden="true" tabindex="-1"></a>selective_coef <span class="ot">&lt;-</span> <span class="fu">rbind</span>(h1_selective_coef, h2_selective_coef) <span class="sc">%&gt;%</span> </span>
<span id="cb35-1317"><a href="#cb35-1317" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">factor</span>(model, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Base"</span>, <span class="st">"Appearance"</span>, <span class="st">"Disappearance"</span>, <span class="st">"Combined"</span>)))</span>
<span id="cb35-1318"><a href="#cb35-1318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1319"><a href="#cb35-1319" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(selective_coef, <span class="fu">aes</span>(hypothesis, mean, <span class="at">color =</span> model)) <span class="sc">+</span> </span>
<span id="cb35-1320"><a href="#cb35-1320" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lwr, <span class="at">ymax =</span> upr), <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb35-1321"><a href="#cb35-1321" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb35-1322"><a href="#cb35-1322" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">y =</span> <span class="dv">0</span>) <span class="sc">+</span> </span>
<span id="cb35-1323"><a href="#cb35-1323" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Coefficient"</span>, <span class="at">x =</span> <span class="st">"Model"</span>) <span class="sc">+</span> </span>
<span id="cb35-1324"><a href="#cb35-1324" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.title =</span> <span class="fu">element_blank</span>())</span>
<span id="cb35-1325"><a href="#cb35-1325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1326"><a href="#cb35-1326" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-1327"><a href="#cb35-1327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1328"><a href="#cb35-1328" aria-hidden="true" tabindex="-1"></a>There was no evidence for selective appearance or disappearance influencing the relationship between maternal age and probability of reproduction or offspring survival. The 95% CI of the coefficient for age in the old age class did not overlap 0 for either hypothesis in any of the selective (dis)appearance models <span class="co">[</span><span class="ot">@fig-selective</span><span class="co">]</span>. Therefore the observed patterns are consistent with the senescence hypothesis (i.e., within-animal change with age).</span>
<span id="cb35-1329"><a href="#cb35-1329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1330"><a href="#cb35-1330" aria-hidden="true" tabindex="-1"></a><span class="fu">## Chronological versus biological age</span></span>
<span id="cb35-1331"><a href="#cb35-1331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1334"><a href="#cb35-1334" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-1335"><a href="#cb35-1335" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: bioage</span></span>
<span id="cb35-1336"><a href="#cb35-1336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1337"><a href="#cb35-1337" aria-hidden="true" tabindex="-1"></a>bioage_senesce <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">7</span></span>
<span id="cb35-1338"><a href="#cb35-1338" aria-hidden="true" tabindex="-1"></a>sealdat2 <span class="ot">&lt;-</span> sealdat <span class="sc">%&gt;%</span> </span>
<span id="cb35-1339"><a href="#cb35-1339" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(lastobs) <span class="sc">%&gt;%</span> </span>
<span id="cb35-1340"><a href="#cb35-1340" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">bioage =</span> age <span class="sc">-</span> lastobs,</span>
<span id="cb35-1341"><a href="#cb35-1341" aria-hidden="true" tabindex="-1"></a>         <span class="at">bioage10 =</span> (bioage <span class="sc">-</span> bioage_senesce) <span class="sc">/</span> <span class="dv">10</span>,</span>
<span id="cb35-1342"><a href="#cb35-1342" aria-hidden="true" tabindex="-1"></a>         <span class="at">bioage_cat =</span> <span class="fu">factor</span>(bioage <span class="sc">&lt;</span> bioage_senesce,</span>
<span id="cb35-1343"><a href="#cb35-1343" aria-hidden="true" tabindex="-1"></a>                             <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Old"</span>, <span class="st">"Young"</span>)))</span>
<span id="cb35-1344"><a href="#cb35-1344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1345"><a href="#cb35-1345" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-1346"><a href="#cb35-1346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1347"><a href="#cb35-1347" aria-hidden="true" tabindex="-1"></a>The chronological age of an individual may not reflect their biological age because aging rates vary within populations <span class="co">[</span><span class="ot">@martin2011</span><span class="co">]</span>. Years-to-death, a proxy for biological age, may therefore be a better predictor for senescence patterns than chronological age. We repeated our analysis for the reproductive senescence hypothesis using biological age, setting the breakpoint for senescence at biological age -7 years (i.e. 7 years prior to final observation), based on visual inspection of the raw data. This required us to limit our sample to animals with known longevity (i.e., last observation in 2020 or earlier), which reduced our sample size to <span class="in">`r nrow(sealdat2)`</span> observations of <span class="in">`r n_distinct(sealdat2$animalID)`</span> distinct animals. Subsequently, we fit the model for breakpoints at all biological ages -12 to -3 years, to assess whether our results were sensitive to the choice of breakpoint. Finally, we re-fit the chronological reproductive senescence model using the known-longevity dataset and compared chronological versus biological age models using AIC.</span>
<span id="cb35-1348"><a href="#cb35-1348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1351"><a href="#cb35-1351" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-1352"><a href="#cb35-1352" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: bioage-mod</span></span>
<span id="cb35-1353"><a href="#cb35-1353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1354"><a href="#cb35-1354" aria-hidden="true" tabindex="-1"></a><span class="co"># Biological age model</span></span>
<span id="cb35-1355"><a href="#cb35-1355" aria-hidden="true" tabindex="-1"></a>breed_bioage_mod <span class="ot">&lt;-</span> <span class="fu">glmer</span>(</span>
<span id="cb35-1356"><a href="#cb35-1356" aria-hidden="true" tabindex="-1"></a>  observed_int <span class="sc">~</span> bioage10 <span class="sc">:</span> bioage_cat <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> animalID) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> year_fct),</span>
<span id="cb35-1357"><a href="#cb35-1357" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sealdat2, bioage <span class="sc">&lt;</span> <span class="dv">0</span>),</span>
<span id="cb35-1358"><a href="#cb35-1358" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="st">"binomial"</span>,</span>
<span id="cb35-1359"><a href="#cb35-1359" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">glmerControl</span>(<span class="at">optimizer =</span> <span class="st">"bobyqa"</span>)</span>
<span id="cb35-1360"><a href="#cb35-1360" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-1361"><a href="#cb35-1361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1362"><a href="#cb35-1362" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(breed_bioage_mod)<span class="sc">$</span>coefficients</span>
<span id="cb35-1363"><a href="#cb35-1363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1364"><a href="#cb35-1364" aria-hidden="true" tabindex="-1"></a>bioage_est <span class="ot">&lt;-</span> <span class="fu">summary</span>(breed_bioage_mod)<span class="sc">$</span>coef[<span class="st">"bioage10:bioage_catOld"</span>, <span class="st">"Estimate"</span>]</span>
<span id="cb35-1365"><a href="#cb35-1365" aria-hidden="true" tabindex="-1"></a>bioage_se <span class="ot">&lt;-</span> <span class="fu">summary</span>(breed_bioage_mod)<span class="sc">$</span>coef[<span class="st">"bioage10:bioage_catOld"</span>, <span class="st">"Std. Error"</span>]</span>
<span id="cb35-1366"><a href="#cb35-1366" aria-hidden="true" tabindex="-1"></a>bioage_coef <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">"%0.3f (%0.3f - %0.3f)"</span>, </span>
<span id="cb35-1367"><a href="#cb35-1367" aria-hidden="true" tabindex="-1"></a>                       bioage_est,</span>
<span id="cb35-1368"><a href="#cb35-1368" aria-hidden="true" tabindex="-1"></a>                       bioage_est <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> bioage_se,</span>
<span id="cb35-1369"><a href="#cb35-1369" aria-hidden="true" tabindex="-1"></a>                       bioage_est <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> bioage_se)</span>
<span id="cb35-1370"><a href="#cb35-1370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1371"><a href="#cb35-1371" aria-hidden="true" tabindex="-1"></a>old_z <span class="ot">&lt;-</span> <span class="fu">summary</span>(breed_bioage_mod)<span class="sc">$</span>coefficients[<span class="st">"bioage10:bioage_catOld"</span>, <span class="st">"z value"</span>]</span>
<span id="cb35-1372"><a href="#cb35-1372" aria-hidden="true" tabindex="-1"></a>bioage_pval <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">"%0.3f"</span>, <span class="fu">pnorm</span>(<span class="sc">-</span>old_z))</span>
<span id="cb35-1373"><a href="#cb35-1373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1374"><a href="#cb35-1374" aria-hidden="true" tabindex="-1"></a><span class="co"># Breakpoint comparison</span></span>
<span id="cb35-1375"><a href="#cb35-1375" aria-hidden="true" tabindex="-1"></a>p_by_tau <span class="ot">&lt;-</span> <span class="fu">map_dbl</span>(<span class="sc">-</span><span class="dv">12</span><span class="sc">:-</span><span class="dv">3</span>, \(tau) {</span>
<span id="cb35-1376"><a href="#cb35-1376" aria-hidden="true" tabindex="-1"></a>  mod <span class="ot">&lt;-</span> sealdat <span class="sc">%&gt;%</span></span>
<span id="cb35-1377"><a href="#cb35-1377" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_na</span>(lastobs) <span class="sc">%&gt;%</span></span>
<span id="cb35-1378"><a href="#cb35-1378" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">bioage =</span> age <span class="sc">-</span> lastobs,</span>
<span id="cb35-1379"><a href="#cb35-1379" aria-hidden="true" tabindex="-1"></a>           <span class="at">bioage10 =</span> (bioage <span class="sc">-</span> tau) <span class="sc">/</span> <span class="dv">10</span>,</span>
<span id="cb35-1380"><a href="#cb35-1380" aria-hidden="true" tabindex="-1"></a>           <span class="at">bioage_cat =</span> <span class="fu">factor</span>(bioage <span class="sc">&lt;</span> tau,</span>
<span id="cb35-1381"><a href="#cb35-1381" aria-hidden="true" tabindex="-1"></a>                               <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Old"</span>, <span class="st">"Young"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb35-1382"><a href="#cb35-1382" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(bioage <span class="sc">&lt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-1383"><a href="#cb35-1383" aria-hidden="true" tabindex="-1"></a>    <span class="fu">glmer</span>(</span>
<span id="cb35-1384"><a href="#cb35-1384" aria-hidden="true" tabindex="-1"></a>      observed_int <span class="sc">~</span> bioage10 <span class="sc">:</span> bioage_cat <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> animalID) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> year_fct),</span>
<span id="cb35-1385"><a href="#cb35-1385" aria-hidden="true" tabindex="-1"></a>      .,</span>
<span id="cb35-1386"><a href="#cb35-1386" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> <span class="st">"binomial"</span>,</span>
<span id="cb35-1387"><a href="#cb35-1387" aria-hidden="true" tabindex="-1"></a>      <span class="at">control =</span> <span class="fu">glmerControl</span>(<span class="at">optimizer =</span> <span class="st">"bobyqa"</span>)</span>
<span id="cb35-1388"><a href="#cb35-1388" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb35-1389"><a href="#cb35-1389" aria-hidden="true" tabindex="-1"></a>  old_z <span class="ot">&lt;-</span> <span class="fu">summary</span>(mod)<span class="sc">$</span>coef[<span class="st">"bioage10:bioage_catOld"</span>, <span class="st">"z value"</span>] </span>
<span id="cb35-1390"><a href="#cb35-1390" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pnorm</span>(old_z)</span>
<span id="cb35-1391"><a href="#cb35-1391" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb35-1392"><a href="#cb35-1392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1393"><a href="#cb35-1393" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="st">`</span><span class="at">Biological age threshold</span><span class="st">`</span> <span class="ot">=</span> <span class="sc">-</span><span class="dv">12</span><span class="sc">:-</span><span class="dv">3</span>,</span>
<span id="cb35-1394"><a href="#cb35-1394" aria-hidden="true" tabindex="-1"></a>       <span class="st">`</span><span class="at">p value</span><span class="st">`</span> <span class="ot">=</span> p_by_tau)</span>
<span id="cb35-1395"><a href="#cb35-1395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1396"><a href="#cb35-1396" aria-hidden="true" tabindex="-1"></a><span class="co"># Model comparison</span></span>
<span id="cb35-1397"><a href="#cb35-1397" aria-hidden="true" tabindex="-1"></a>breed_age_mod2 <span class="ot">&lt;-</span> <span class="fu">glmer</span>(</span>
<span id="cb35-1398"><a href="#cb35-1398" aria-hidden="true" tabindex="-1"></a>  observed_int <span class="sc">~</span> age10 <span class="sc">:</span> age_cat <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> animalID) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> year_fct),</span>
<span id="cb35-1399"><a href="#cb35-1399" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sealdat2, bioage <span class="sc">&lt;</span> <span class="dv">0</span>),</span>
<span id="cb35-1400"><a href="#cb35-1400" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="st">"binomial"</span>,</span>
<span id="cb35-1401"><a href="#cb35-1401" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">glmerControl</span>(<span class="at">optimizer =</span> <span class="st">"bobyqa"</span>)</span>
<span id="cb35-1402"><a href="#cb35-1402" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-1403"><a href="#cb35-1403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1404"><a href="#cb35-1404" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-1405"><a href="#cb35-1405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1408"><a href="#cb35-1408" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-1409"><a href="#cb35-1409" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: chrono-bio-aic</span></span>
<span id="cb35-1410"><a href="#cb35-1410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1411"><a href="#cb35-1411" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(breed_bioage_mod, breed_age_mod2) <span class="sc">%&gt;%</span> </span>
<span id="cb35-1412"><a href="#cb35-1412" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb35-1413"><a href="#cb35-1413" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dAIC =</span> AIC <span class="sc">-</span> <span class="fu">min</span>(AIC),</span>
<span id="cb35-1414"><a href="#cb35-1414" aria-hidden="true" tabindex="-1"></a>         <span class="at">rellik =</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.5</span> <span class="sc">*</span> dAIC),</span>
<span id="cb35-1415"><a href="#cb35-1415" aria-hidden="true" tabindex="-1"></a>         <span class="at">weight =</span> rellik <span class="sc">/</span> <span class="fu">sum</span>(rellik),</span>
<span id="cb35-1416"><a href="#cb35-1416" aria-hidden="true" tabindex="-1"></a>         <span class="at">model =</span> <span class="fu">c</span>(<span class="st">"Biological age"</span>, <span class="st">"Chronological age"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb35-1417"><a href="#cb35-1417" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(model, AIC, dAIC, weight) <span class="sc">%&gt;%</span> </span>
<span id="cb35-1418"><a href="#cb35-1418" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span>
<span id="cb35-1419"><a href="#cb35-1419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1420"><a href="#cb35-1420" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-1421"><a href="#cb35-1421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1424"><a href="#cb35-1424" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-1425"><a href="#cb35-1425" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-bio-age</span></span>
<span id="cb35-1426"><a href="#cb35-1426" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Breeding probability over biological age. Points and error bars are the mean ± SE of observed breeding proportions within age classes. The vertical dashed line indicates the threshold for senescence. Solid lines and ribbons are the mean and 95% CI of the population-level breeding probability, estimated by a GLMM with random effects for individual and year. The dashed lines represent the mean of yearly breeding probabilities, weighted by the number of seals observed each year, which should match the observed data more closely than the population-level probabilities."</span></span>
<span id="cb35-1427"><a href="#cb35-1427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1428"><a href="#cb35-1428" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize the raw data</span></span>
<span id="cb35-1429"><a href="#cb35-1429" aria-hidden="true" tabindex="-1"></a>bioage_summ <span class="ot">&lt;-</span> sealdat2 <span class="sc">%&gt;%</span></span>
<span id="cb35-1430"><a href="#cb35-1430" aria-hidden="true" tabindex="-1"></a>  <span class="co"># exclude n=1 age class</span></span>
<span id="cb35-1431"><a href="#cb35-1431" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(bioage <span class="sc">&gt;=</span> <span class="sc">-</span><span class="dv">15</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-1432"><a href="#cb35-1432" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(bioage) <span class="sc">%&gt;%</span> </span>
<span id="cb35-1433"><a href="#cb35-1433" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n_obs =</span> <span class="fu">n</span>(), </span>
<span id="cb35-1434"><a href="#cb35-1434" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_breed =</span> <span class="fu">sum</span>(observed_int),</span>
<span id="cb35-1435"><a href="#cb35-1435" aria-hidden="true" tabindex="-1"></a>            <span class="at">perc_breed =</span> n_breed <span class="sc">/</span> n_obs, </span>
<span id="cb35-1436"><a href="#cb35-1436" aria-hidden="true" tabindex="-1"></a>            <span class="at">breed_lwr =</span> <span class="fu">binom.test</span>(n_breed, n_obs)<span class="sc">$</span>conf.int[<span class="dv">1</span>], </span>
<span id="cb35-1437"><a href="#cb35-1437" aria-hidden="true" tabindex="-1"></a>            <span class="at">breed_upr =</span> <span class="fu">binom.test</span>(n_breed, n_obs)<span class="sc">$</span>conf.int[<span class="dv">2</span>])</span>
<span id="cb35-1438"><a href="#cb35-1438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1439"><a href="#cb35-1439" aria-hidden="true" tabindex="-1"></a><span class="co"># Create ANNUAL (i.e. rand effect of year only) predictions</span></span>
<span id="cb35-1440"><a href="#cb35-1440" aria-hidden="true" tabindex="-1"></a>bioage_pred_years <span class="ot">&lt;-</span> <span class="fu">ggpredict</span>(</span>
<span id="cb35-1441"><a href="#cb35-1441" aria-hidden="true" tabindex="-1"></a>  breed_bioage_mod, </span>
<span id="cb35-1442"><a href="#cb35-1442" aria-hidden="true" tabindex="-1"></a>  <span class="at">terms =</span> <span class="fu">c</span>(<span class="st">"bioage10 [all]"</span>, <span class="st">"bioage_cat"</span>, <span class="st">"year_fct"</span>),</span>
<span id="cb35-1443"><a href="#cb35-1443" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"random"</span></span>
<span id="cb35-1444"><a href="#cb35-1444" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-1445"><a href="#cb35-1445" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb35-1446"><a href="#cb35-1446" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">bioage =</span> x <span class="sc">*</span> <span class="dv">10</span> <span class="sc">+</span> bioage_senesce,</span>
<span id="cb35-1447"><a href="#cb35-1447" aria-hidden="true" tabindex="-1"></a>         <span class="at">bioage_cat =</span> <span class="fu">factor</span>(group, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Young"</span>, <span class="st">"Old"</span>)),</span>
<span id="cb35-1448"><a href="#cb35-1448" aria-hidden="true" tabindex="-1"></a>         <span class="at">year_fct =</span> <span class="fu">factor</span>(facet)) <span class="sc">%&gt;%</span> </span>
<span id="cb35-1449"><a href="#cb35-1449" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>((bioage_cat <span class="sc">==</span> <span class="st">"Young"</span> <span class="sc">&amp;</span> bioage <span class="sc">&lt;</span> bioage_senesce) <span class="sc">|</span></span>
<span id="cb35-1450"><a href="#cb35-1450" aria-hidden="true" tabindex="-1"></a>           (bioage_cat <span class="sc">==</span> <span class="st">"Old"</span> <span class="sc">&amp;</span> bioage <span class="sc">&gt;=</span> bioage_senesce),</span>
<span id="cb35-1451"><a href="#cb35-1451" aria-hidden="true" tabindex="-1"></a>         bioage <span class="sc">&gt;=</span> <span class="sc">-</span><span class="dv">15</span>)</span>
<span id="cb35-1452"><a href="#cb35-1452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1453"><a href="#cb35-1453" aria-hidden="true" tabindex="-1"></a><span class="co"># Create WEIGHTED-AVERAGE predictions using years' random effects</span></span>
<span id="cb35-1454"><a href="#cb35-1454" aria-hidden="true" tabindex="-1"></a><span class="co"># ggpredict can't do that for confidence intervals</span></span>
<span id="cb35-1455"><a href="#cb35-1455" aria-hidden="true" tabindex="-1"></a><span class="co"># create prediction grid</span></span>
<span id="cb35-1456"><a href="#cb35-1456" aria-hidden="true" tabindex="-1"></a>bioage_grid <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(</span>
<span id="cb35-1457"><a href="#cb35-1457" aria-hidden="true" tabindex="-1"></a>  <span class="at">bioage =</span> <span class="sc">-</span><span class="dv">15</span><span class="sc">:-</span><span class="dv">1</span>,</span>
<span id="cb35-1458"><a href="#cb35-1458" aria-hidden="true" tabindex="-1"></a>  <span class="at">year_fct =</span> <span class="fu">factor</span>(<span class="dv">1988</span><span class="sc">:</span><span class="dv">2018</span>)</span>
<span id="cb35-1459"><a href="#cb35-1459" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-1460"><a href="#cb35-1460" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">bioage10 =</span> (bioage <span class="sc">-</span> bioage_senesce) <span class="sc">/</span> <span class="dv">10</span>,</span>
<span id="cb35-1461"><a href="#cb35-1461" aria-hidden="true" tabindex="-1"></a>         <span class="at">bioage_cat =</span> <span class="fu">factor</span>(<span class="fu">ifelse</span>(bioage <span class="sc">&lt;</span> bioage_senesce, <span class="st">"Young"</span>, <span class="st">"Old"</span>),</span>
<span id="cb35-1462"><a href="#cb35-1462" aria-hidden="true" tabindex="-1"></a>                          <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Young"</span>, <span class="st">"Old"</span>)))</span>
<span id="cb35-1463"><a href="#cb35-1463" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-1464"><a href="#cb35-1464" aria-hidden="true" tabindex="-1"></a>bioage_years <span class="ot">&lt;-</span> <span class="fu">count</span>(sealdat2, year_fct)</span>
<span id="cb35-1465"><a href="#cb35-1465" aria-hidden="true" tabindex="-1"></a>bioage_pred_wgt <span class="ot">&lt;-</span> bioage_grid <span class="sc">%&gt;%</span> </span>
<span id="cb35-1466"><a href="#cb35-1466" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">predicted =</span> <span class="fu">predict</span>(breed_bioage_mod, </span>
<span id="cb35-1467"><a href="#cb35-1467" aria-hidden="true" tabindex="-1"></a>                             <span class="at">newdata =</span> bioage_grid,</span>
<span id="cb35-1468"><a href="#cb35-1468" aria-hidden="true" tabindex="-1"></a>                             <span class="at">re.form =</span> <span class="sc">~</span> (<span class="dv">1</span> <span class="sc">|</span> year_fct)),</span>
<span id="cb35-1469"><a href="#cb35-1469" aria-hidden="true" tabindex="-1"></a>         <span class="at">predicted_se =</span> <span class="fu">suppressWarnings</span>(</span>
<span id="cb35-1470"><a href="#cb35-1470" aria-hidden="true" tabindex="-1"></a>           <span class="co"># warning: "se.fit computation uses an approximation to estimate the sampling distribution of the parameters"</span></span>
<span id="cb35-1471"><a href="#cb35-1471" aria-hidden="true" tabindex="-1"></a>           <span class="fu">predict</span>(breed_bioage_mod, </span>
<span id="cb35-1472"><a href="#cb35-1472" aria-hidden="true" tabindex="-1"></a>                   <span class="at">newdata =</span> bioage_grid,</span>
<span id="cb35-1473"><a href="#cb35-1473" aria-hidden="true" tabindex="-1"></a>                   <span class="at">re.form =</span> <span class="cn">NA</span>,</span>
<span id="cb35-1474"><a href="#cb35-1474" aria-hidden="true" tabindex="-1"></a>                   <span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb35-1475"><a href="#cb35-1475" aria-hidden="true" tabindex="-1"></a>         )<span class="sc">$</span>se.fit,</span>
<span id="cb35-1476"><a href="#cb35-1476" aria-hidden="true" tabindex="-1"></a>         <span class="at">predicted_pop =</span> <span class="fu">predict</span>(breed_bioage_mod, </span>
<span id="cb35-1477"><a href="#cb35-1477" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">newdata =</span> bioage_grid,</span>
<span id="cb35-1478"><a href="#cb35-1478" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">re.form =</span> <span class="cn">NA</span>),</span>
<span id="cb35-1479"><a href="#cb35-1479" aria-hidden="true" tabindex="-1"></a>         <span class="at">conf_lo =</span> predicted <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> predicted_se,</span>
<span id="cb35-1480"><a href="#cb35-1480" aria-hidden="true" tabindex="-1"></a>         <span class="at">conf_hi =</span> predicted <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> predicted_se) <span class="sc">%&gt;%</span> </span>
<span id="cb35-1481"><a href="#cb35-1481" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(bioage_years, <span class="at">by =</span> <span class="st">"year_fct"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-1482"><a href="#cb35-1482" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(bioage, bioage_cat) <span class="sc">%&gt;%</span> </span>
<span id="cb35-1483"><a href="#cb35-1483" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">c</span>(predicted, predicted_pop, conf_lo, conf_hi), </span>
<span id="cb35-1484"><a href="#cb35-1484" aria-hidden="true" tabindex="-1"></a>                   \(x) <span class="fu">weighted.mean</span>(x, n)),</span>
<span id="cb35-1485"><a href="#cb35-1485" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-1486"><a href="#cb35-1486" aria-hidden="true" tabindex="-1"></a>  <span class="co"># invert logit</span></span>
<span id="cb35-1487"><a href="#cb35-1487" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(predicted, predicted_pop, conf_lo, conf_hi), </span>
<span id="cb35-1488"><a href="#cb35-1488" aria-hidden="true" tabindex="-1"></a>                <span class="fu">family</span>(breed_bioage_mod)<span class="sc">$</span>linkinv)) <span class="sc">%&gt;%</span> </span>
<span id="cb35-1489"><a href="#cb35-1489" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">count</span>(sealdat2, bioage), <span class="at">by =</span> <span class="st">"bioage"</span>)</span>
<span id="cb35-1490"><a href="#cb35-1490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1491"><a href="#cb35-1491" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(bioage_pred_wgt, <span class="fu">aes</span>(bioage, predicted)) <span class="sc">+</span></span>
<span id="cb35-1492"><a href="#cb35-1492" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Predictions for individual years</span></span>
<span id="cb35-1493"><a href="#cb35-1493" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> <span class="fu">interaction</span>(bioage_cat, year_fct)),</span>
<span id="cb35-1494"><a href="#cb35-1494" aria-hidden="true" tabindex="-1"></a>            bioage_pred_years,</span>
<span id="cb35-1495"><a href="#cb35-1495" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb35-1496"><a href="#cb35-1496" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Weighted model (CI and mean response)</span></span>
<span id="cb35-1497"><a href="#cb35-1497" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">fill =</span> bioage_cat, <span class="at">ymin =</span> conf_lo, <span class="at">ymax =</span> conf_hi), </span>
<span id="cb35-1498"><a href="#cb35-1498" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb35-1499"><a href="#cb35-1499" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> bioage_cat),</span>
<span id="cb35-1500"><a href="#cb35-1500" aria-hidden="true" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb35-1501"><a href="#cb35-1501" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Population-level mean response</span></span>
<span id="cb35-1502"><a href="#cb35-1502" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> predicted_pop, <span class="at">group =</span> bioage_cat),</span>
<span id="cb35-1503"><a href="#cb35-1503" aria-hidden="true" tabindex="-1"></a>            <span class="at">linetype =</span> <span class="st">"dotted"</span>,</span>
<span id="cb35-1504"><a href="#cb35-1504" aria-hidden="true" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="fl">1.2</span>,</span>
<span id="cb35-1505"><a href="#cb35-1505" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb35-1506"><a href="#cb35-1506" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Summarized raw data</span></span>
<span id="cb35-1507"><a href="#cb35-1507" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">y =</span> perc_breed,</span>
<span id="cb35-1508"><a href="#cb35-1508" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ymin =</span> breed_lwr,</span>
<span id="cb35-1509"><a href="#cb35-1509" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ymax =</span> breed_upr),</span>
<span id="cb35-1510"><a href="#cb35-1510" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(bioage_summ, bioage <span class="sc">&lt;</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb35-1511"><a href="#cb35-1511" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">y =</span> perc_breed,</span>
<span id="cb35-1512"><a href="#cb35-1512" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ymin =</span> breed_lwr,</span>
<span id="cb35-1513"><a href="#cb35-1513" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ymax =</span> breed_upr),</span>
<span id="cb35-1514"><a href="#cb35-1514" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> <span class="st">"grey50"</span>,</span>
<span id="cb35-1515"><a href="#cb35-1515" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(bioage_summ, bioage <span class="sc">==</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb35-1516"><a href="#cb35-1516" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> bioage_senesce <span class="sc">-</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb35-1517"><a href="#cb35-1517" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sample size labels</span></span>
<span id="cb35-1518"><a href="#cb35-1518" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> n_obs),</span>
<span id="cb35-1519"><a href="#cb35-1519" aria-hidden="true" tabindex="-1"></a>            <span class="fu">filter</span>(bioage_summ, bioage <span class="sc">&lt;</span> <span class="dv">0</span>), </span>
<span id="cb35-1520"><a href="#cb35-1520" aria-hidden="true" tabindex="-1"></a>            <span class="at">y =</span> <span class="dv">1</span>, </span>
<span id="cb35-1521"><a href="#cb35-1521" aria-hidden="true" tabindex="-1"></a>            <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb35-1522"><a href="#cb35-1522" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> n_obs),</span>
<span id="cb35-1523"><a href="#cb35-1523" aria-hidden="true" tabindex="-1"></a>            <span class="fu">filter</span>(bioage_summ, bioage <span class="sc">==</span> <span class="dv">0</span>), </span>
<span id="cb35-1524"><a href="#cb35-1524" aria-hidden="true" tabindex="-1"></a>            <span class="at">y =</span> <span class="dv">1</span>, </span>
<span id="cb35-1525"><a href="#cb35-1525" aria-hidden="true" tabindex="-1"></a>            <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>,</span>
<span id="cb35-1526"><a href="#cb35-1526" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"grey50"</span>) <span class="sc">+</span></span>
<span id="cb35-1527"><a href="#cb35-1527" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Breeding probability"</span>, </span>
<span id="cb35-1528"><a href="#cb35-1528" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> scales<span class="sc">::</span>percent,</span>
<span id="cb35-1529"><a href="#cb35-1529" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="fl">1.02</span>),</span>
<span id="cb35-1530"><a href="#cb35-1530" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="fl">0.4</span>, <span class="fl">1.0</span>, <span class="at">by =</span> <span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb35-1531"><a href="#cb35-1531" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#7fbc41"</span>, <span class="st">"#de77ae"</span>)) <span class="sc">+</span></span>
<span id="cb35-1532"><a href="#cb35-1532" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#7fbc41"</span>, <span class="st">"#de77ae"</span>)) <span class="sc">+</span></span>
<span id="cb35-1533"><a href="#cb35-1533" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Biological age (years)"</span>) <span class="sc">+</span></span>
<span id="cb35-1534"><a href="#cb35-1534" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb35-1535"><a href="#cb35-1535" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-1536"><a href="#cb35-1536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1537"><a href="#cb35-1537" aria-hidden="true" tabindex="-1"></a>The biological age model did not support the reproductive senescence hypothesis. The coefficient for biological age among older animals (biological age <span class="sc">\&gt;</span> -7 years) was <span class="in">`r bioage_coef`</span> (95% CI) which was not significantly different than 0 (*p* = `r bioage_pval`). Choice of breakpoint for senescence did not affect the significance of this coefficient. For breakpoints -12 to -3 years, *p* reached a minimum at biological age -7 years (see table above).</span>
<span id="cb35-1538"><a href="#cb35-1538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1539"><a href="#cb35-1539" aria-hidden="true" tabindex="-1"></a>The chronological age model outperformed the biological age model according to AIC.</span>
<span id="cb35-1540"><a href="#cb35-1540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1541"><a href="#cb35-1541" aria-hidden="true" tabindex="-1"></a>Based on these results, we find there is evidence to support the reproductive senescence hypothesis based on chronological age. The biological age proxy, years-to-death, should be a better predictor of senescence than chronological age if most mortality is age-related. However, adult elephant seal mortality is largely influenced by extrinsic factors, primarily food availability <span class="co">[</span><span class="ot">@colegrove2005; @holser2021</span><span class="co">]</span>. Poor foraging conditions during El Niño years, for example, may increase mortality rates among animals whose biological age is not yet advanced. As result, the years-to-death proxy for biological age likely conflates many biologically young and old animals that died due to extrinsic factors. More accurate measures of biological age, such as telomere length <span class="co">[</span><span class="ot">@jylhävä2017</span><span class="co">]</span>, may be necessary to investigate senescence in elephant seals and other species with high extrinsic sources of mortality from a non-chronological perspective.</span>
<span id="cb35-1542"><a href="#cb35-1542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1543"><a href="#cb35-1543" aria-hidden="true" tabindex="-1"></a><span class="fu">## Detection frequency</span></span>
<span id="cb35-1544"><a href="#cb35-1544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1545"><a href="#cb35-1545" aria-hidden="true" tabindex="-1"></a>Not all seals were detected in all years. A non-detection year during the seal's lifespan (i.e. an unobserved year between the first and last observed years) could represent an unobserved animal at Año Nuevo or temporary emigration. In either case, the animal may or may not have reproduced that year. By excluding these unobserved animals, our inferences for H1 (reproductive senescence) may be biased if detectability varies with age and/or by breeding state. Here, we assess those potential biases.</span>
<span id="cb35-1546"><a href="#cb35-1546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1549"><a href="#cb35-1549" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-1550"><a href="#cb35-1550" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: seal-detections</span></span>
<span id="cb35-1551"><a href="#cb35-1551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1552"><a href="#cb35-1552" aria-hidden="true" tabindex="-1"></a><span class="co"># Are seal detections changing with age?</span></span>
<span id="cb35-1553"><a href="#cb35-1553" aria-hidden="true" tabindex="-1"></a>detection_seals <span class="ot">&lt;-</span> sealdat <span class="sc">%&gt;%</span> </span>
<span id="cb35-1554"><a href="#cb35-1554" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(age <span class="sc">&lt;=</span> <span class="dv">20</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-1555"><a href="#cb35-1555" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fill in non-resighted years</span></span>
<span id="cb35-1556"><a href="#cb35-1556" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(animalID) <span class="sc">%&gt;%</span> </span>
<span id="cb35-1557"><a href="#cb35-1557" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Keep only animals seen at least 2 years apart (i.e. if only seen in consecutive years remove them)</span></span>
<span id="cb35-1558"><a href="#cb35-1558" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year_range =</span> <span class="fu">max</span>(year) <span class="sc">-</span> <span class="fu">min</span>(year)) <span class="sc">%&gt;%</span> </span>
<span id="cb35-1559"><a href="#cb35-1559" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year_range <span class="sc">&gt;</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-1560"><a href="#cb35-1560" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>year_range) <span class="sc">%&gt;%</span> </span>
<span id="cb35-1561"><a href="#cb35-1561" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Interpolate seen/not seen</span></span>
<span id="cb35-1562"><a href="#cb35-1562" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="fu">tibble</span>(<span class="at">year2 =</span> (yearborn[<span class="dv">1</span>] <span class="sc">+</span> <span class="dv">4</span>)<span class="sc">:</span>(<span class="fu">max</span>(year) <span class="sc">-</span> <span class="dv">1</span>), <span class="co"># from age 4 to year prior last obs</span></span>
<span id="cb35-1563"><a href="#cb35-1563" aria-hidden="true" tabindex="-1"></a>                 <span class="at">observed =</span> <span class="fu">as.integer</span>(year2 <span class="sc">%in%</span> year),</span>
<span id="cb35-1564"><a href="#cb35-1564" aria-hidden="true" tabindex="-1"></a>                 <span class="at">age =</span> year2 <span class="sc">-</span> yearborn[<span class="dv">1</span>],</span>
<span id="cb35-1565"><a href="#cb35-1565" aria-hidden="true" tabindex="-1"></a>                 <span class="at">age10 =</span> (age <span class="sc">-</span> age_senesce) <span class="sc">/</span> <span class="dv">10</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb35-1566"><a href="#cb35-1566" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb35-1567"><a href="#cb35-1567" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">year =</span> year2) <span class="sc">%&gt;%</span> </span>
<span id="cb35-1568"><a href="#cb35-1568" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">1988</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-1569"><a href="#cb35-1569" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_cat =</span> <span class="fu">factor</span>(age <span class="sc">&gt;=</span> age_senesce, </span>
<span id="cb35-1570"><a href="#cb35-1570" aria-hidden="true" tabindex="-1"></a>                          <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Young"</span>, <span class="st">"Old"</span>)),</span>
<span id="cb35-1571"><a href="#cb35-1571" aria-hidden="true" tabindex="-1"></a>         <span class="at">year_fct =</span> <span class="fu">factor</span>(year)) <span class="sc">%&gt;%</span> </span>
<span id="cb35-1572"><a href="#cb35-1572" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">select</span>(sealdat, animalID, year, observed_int),</span>
<span id="cb35-1573"><a href="#cb35-1573" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"animalID"</span>, <span class="st">"year"</span>))</span>
<span id="cb35-1574"><a href="#cb35-1574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1575"><a href="#cb35-1575" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary: mean and 95% CI </span></span>
<span id="cb35-1576"><a href="#cb35-1576" aria-hidden="true" tabindex="-1"></a>detection_summ <span class="ot">&lt;-</span> detection_seals <span class="sc">%&gt;%</span> </span>
<span id="cb35-1577"><a href="#cb35-1577" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age, age_cat) <span class="sc">%&gt;%</span> </span>
<span id="cb35-1578"><a href="#cb35-1578" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb35-1579"><a href="#cb35-1579" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_observed =</span> <span class="fu">sum</span>(observed),</span>
<span id="cb35-1580"><a href="#cb35-1580" aria-hidden="true" tabindex="-1"></a>            <span class="at">observed_mean =</span> n_observed <span class="sc">/</span> n,</span>
<span id="cb35-1581"><a href="#cb35-1581" aria-hidden="true" tabindex="-1"></a>            <span class="at">observed_lwr =</span> <span class="fu">binom.test</span>(n_observed, n)<span class="sc">$</span>conf.int[<span class="dv">1</span>],</span>
<span id="cb35-1582"><a href="#cb35-1582" aria-hidden="true" tabindex="-1"></a>            <span class="at">observed_upr =</span> <span class="fu">binom.test</span>(n_observed, n)<span class="sc">$</span>conf.int[<span class="dv">2</span>],</span>
<span id="cb35-1583"><a href="#cb35-1583" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb35-1584"><a href="#cb35-1584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1585"><a href="#cb35-1585" aria-hidden="true" tabindex="-1"></a>detection_mod <span class="ot">&lt;-</span> <span class="fu">glmer</span>(</span>
<span id="cb35-1586"><a href="#cb35-1586" aria-hidden="true" tabindex="-1"></a>  observed <span class="sc">~</span> age10<span class="sc">:</span>age_cat <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> year_fct) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> animalID), </span>
<span id="cb35-1587"><a href="#cb35-1587" aria-hidden="true" tabindex="-1"></a>  detection_seals, </span>
<span id="cb35-1588"><a href="#cb35-1588" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> binomial</span>
<span id="cb35-1589"><a href="#cb35-1589" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-1590"><a href="#cb35-1590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1591"><a href="#cb35-1591" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(detection_mod)</span>
<span id="cb35-1592"><a href="#cb35-1592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1593"><a href="#cb35-1593" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-1594"><a href="#cb35-1594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1595"><a href="#cb35-1595" aria-hidden="true" tabindex="-1"></a>First, we tested whether detection probability was related to age. We found detection probalities decreased with age (i.e., older seals are less likely to be detected). For this analysis, we excluded the last year each animal was observed. Then, for all years between animals' age 4 year to the year prior to final observation, we determined whether each animal was detected. We estimated the effect of age on detection probability using a GLMM (binomial response, logit link) with an interaction between age and age category (young = age <span class="sc">\&lt;</span> 11, old = age <span class="sc">\&gt;</span> 11) and random effects for year and animal (<span class="co">[</span><span class="ot">@fig-unobserved</span><span class="co">]</span>). The coefficient for age was not significantly different than 0 for animals older than 11, but detection probability decreased significantly with age up to age 11. The change in detection probability from age 11 to 19 was 70.1% (61.7 - 77.3%) to 59.9% (44.4% - 73.7%).</span>
<span id="cb35-1596"><a href="#cb35-1596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1599"><a href="#cb35-1599" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-1600"><a href="#cb35-1600" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-unobserved</span></span>
<span id="cb35-1601"><a href="#cb35-1601" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Detection probabilities decreased with age for young, but not old, animals. Points and error bars represent the proportion of detected animals with 95% CI. The green and pink lines and shaded areas are the mean and 95% CI probability of an animal being detected (GLMM with random effect of year, weighted by number of seals observed each year), color-coded by age category. The dotted line is the mean response of the unweighted predictions. Numbers at the top indicate number of seals of each age. See text for model details.</span></span>
<span id="cb35-1602"><a href="#cb35-1602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1603"><a href="#cb35-1603" aria-hidden="true" tabindex="-1"></a><span class="co"># Prediction grid</span></span>
<span id="cb35-1604"><a href="#cb35-1604" aria-hidden="true" tabindex="-1"></a>detection_grid <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(<span class="at">age =</span> <span class="dv">4</span><span class="sc">:</span><span class="dv">19</span>, </span>
<span id="cb35-1605"><a href="#cb35-1605" aria-hidden="true" tabindex="-1"></a>                              <span class="at">year_fct =</span> <span class="fu">factor</span>(<span class="dv">1989</span><span class="sc">:</span><span class="dv">2022</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb35-1606"><a href="#cb35-1606" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age10 =</span> (age <span class="sc">-</span> age_senesce) <span class="sc">/</span> <span class="dv">10</span>,</span>
<span id="cb35-1607"><a href="#cb35-1607" aria-hidden="true" tabindex="-1"></a>         <span class="at">age_cat =</span> <span class="fu">factor</span>(age <span class="sc">&gt;=</span> age_senesce, </span>
<span id="cb35-1608"><a href="#cb35-1608" aria-hidden="true" tabindex="-1"></a>                          <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Young"</span>, <span class="st">"Old"</span>)))</span>
<span id="cb35-1609"><a href="#cb35-1609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1610"><a href="#cb35-1610" aria-hidden="true" tabindex="-1"></a><span class="co"># Seal detection predictions (weighted model)</span></span>
<span id="cb35-1611"><a href="#cb35-1611" aria-hidden="true" tabindex="-1"></a>detection_pred <span class="ot">&lt;-</span> detection_grid <span class="sc">%&gt;%</span> </span>
<span id="cb35-1612"><a href="#cb35-1612" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">predicted =</span> <span class="fu">predict</span>(detection_mod, </span>
<span id="cb35-1613"><a href="#cb35-1613" aria-hidden="true" tabindex="-1"></a>                             <span class="at">newdata =</span> .,</span>
<span id="cb35-1614"><a href="#cb35-1614" aria-hidden="true" tabindex="-1"></a>                             <span class="at">re.form =</span> <span class="sc">~</span> (<span class="dv">1</span> <span class="sc">|</span> year_fct)),</span>
<span id="cb35-1615"><a href="#cb35-1615" aria-hidden="true" tabindex="-1"></a>         <span class="at">pred_pop =</span> <span class="fu">predict</span>(detection_mod, </span>
<span id="cb35-1616"><a href="#cb35-1616" aria-hidden="true" tabindex="-1"></a>                            <span class="at">newdata =</span> .,</span>
<span id="cb35-1617"><a href="#cb35-1617" aria-hidden="true" tabindex="-1"></a>                            <span class="at">type =</span> <span class="st">"response"</span>,</span>
<span id="cb35-1618"><a href="#cb35-1618" aria-hidden="true" tabindex="-1"></a>                            <span class="at">re.form =</span> <span class="cn">NA</span>),</span>
<span id="cb35-1619"><a href="#cb35-1619" aria-hidden="true" tabindex="-1"></a>         <span class="at">se =</span> <span class="fu">suppressWarnings</span>(<span class="fu">predict</span>(detection_mod, </span>
<span id="cb35-1620"><a href="#cb35-1620" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">newdata =</span> .,</span>
<span id="cb35-1621"><a href="#cb35-1621" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">se.fit =</span> <span class="cn">TRUE</span>,</span>
<span id="cb35-1622"><a href="#cb35-1622" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">re.form =</span> <span class="cn">NA</span>)<span class="sc">$</span>se.fit),</span>
<span id="cb35-1623"><a href="#cb35-1623" aria-hidden="true" tabindex="-1"></a>         <span class="at">conf.low =</span> predicted <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> se,</span>
<span id="cb35-1624"><a href="#cb35-1624" aria-hidden="true" tabindex="-1"></a>         <span class="at">conf.high =</span> predicted <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> se) <span class="sc">%&gt;%</span> </span>
<span id="cb35-1625"><a href="#cb35-1625" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">count</span>(detection_seals, year_fct), <span class="at">by =</span> <span class="st">"year_fct"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-1626"><a href="#cb35-1626" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age, age_cat) <span class="sc">%&gt;%</span> </span>
<span id="cb35-1627"><a href="#cb35-1627" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">c</span>(predicted, pred_pop, conf.low, conf.high), mean), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-1628"><a href="#cb35-1628" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(predicted, conf.low, conf.high), </span>
<span id="cb35-1629"><a href="#cb35-1629" aria-hidden="true" tabindex="-1"></a>                <span class="fu">family</span>(detection_mod)<span class="sc">$</span>linkinv))</span>
<span id="cb35-1630"><a href="#cb35-1630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1631"><a href="#cb35-1631" aria-hidden="true" tabindex="-1"></a><span class="co"># Yearly predictions</span></span>
<span id="cb35-1632"><a href="#cb35-1632" aria-hidden="true" tabindex="-1"></a>detection_pred_years <span class="ot">&lt;-</span> detection_grid <span class="sc">%&gt;%</span> </span>
<span id="cb35-1633"><a href="#cb35-1633" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">predicted =</span> <span class="fu">predict</span>(detection_mod, </span>
<span id="cb35-1634"><a href="#cb35-1634" aria-hidden="true" tabindex="-1"></a>                             <span class="at">newdata =</span> .,</span>
<span id="cb35-1635"><a href="#cb35-1635" aria-hidden="true" tabindex="-1"></a>                             <span class="at">type =</span> <span class="st">"response"</span>,</span>
<span id="cb35-1636"><a href="#cb35-1636" aria-hidden="true" tabindex="-1"></a>                             <span class="at">re.form =</span> <span class="sc">~</span> (<span class="dv">1</span> <span class="sc">|</span> year_fct)))</span>
<span id="cb35-1637"><a href="#cb35-1637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1638"><a href="#cb35-1638" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(detection_pred, <span class="fu">aes</span>(age, <span class="at">color =</span> age_cat, <span class="at">fill =</span> age_cat)) <span class="sc">+</span></span>
<span id="cb35-1639"><a href="#cb35-1639" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Line per year</span></span>
<span id="cb35-1640"><a href="#cb35-1640" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> predicted, <span class="at">group =</span> <span class="fu">interaction</span>(age_cat, year_fct)), </span>
<span id="cb35-1641"><a href="#cb35-1641" aria-hidden="true" tabindex="-1"></a>            detection_pred_years, </span>
<span id="cb35-1642"><a href="#cb35-1642" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb35-1643"><a href="#cb35-1643" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Weighted model</span></span>
<span id="cb35-1644"><a href="#cb35-1644" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high),</span>
<span id="cb35-1645"><a href="#cb35-1645" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fl">0.3</span>, </span>
<span id="cb35-1646"><a href="#cb35-1646" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb35-1647"><a href="#cb35-1647" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> predicted, <span class="at">linetype =</span> age_cat),</span>
<span id="cb35-1648"><a href="#cb35-1648" aria-hidden="true" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb35-1649"><a href="#cb35-1649" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Population-level model</span></span>
<span id="cb35-1650"><a href="#cb35-1650" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> pred_pop), </span>
<span id="cb35-1651"><a href="#cb35-1651" aria-hidden="true" tabindex="-1"></a>            <span class="at">linetype =</span> <span class="st">"dotted"</span>,</span>
<span id="cb35-1652"><a href="#cb35-1652" aria-hidden="true" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="fl">1.1</span>) <span class="sc">+</span></span>
<span id="cb35-1653"><a href="#cb35-1653" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Raw data</span></span>
<span id="cb35-1654"><a href="#cb35-1654" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">y =</span> observed_mean, </span>
<span id="cb35-1655"><a href="#cb35-1655" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ymin =</span> observed_lwr, </span>
<span id="cb35-1656"><a href="#cb35-1656" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ymax =</span> observed_upr),</span>
<span id="cb35-1657"><a href="#cb35-1657" aria-hidden="true" tabindex="-1"></a>                  detection_summ) <span class="sc">+</span></span>
<span id="cb35-1658"><a href="#cb35-1658" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sample size</span></span>
<span id="cb35-1659"><a href="#cb35-1659" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(age, <span class="at">label =</span> n), detection_summ, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb35-1660"><a href="#cb35-1660" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Age"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">4</span>, <span class="dv">19</span>, <span class="at">by =</span> <span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb35-1661"><a href="#cb35-1661" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Detection rate"</span>, </span>
<span id="cb35-1662"><a href="#cb35-1662" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>(<span class="at">accuracy =</span> <span class="dv">1</span>),</span>
<span id="cb35-1663"><a href="#cb35-1663" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>)) <span class="sc">+</span></span>
<span id="cb35-1664"><a href="#cb35-1664" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"solid"</span>, <span class="st">"dashed"</span>)) <span class="sc">+</span></span>
<span id="cb35-1665"><a href="#cb35-1665" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#7fbc41"</span>, <span class="st">"#de77ae"</span>)) <span class="sc">+</span></span>
<span id="cb35-1666"><a href="#cb35-1666" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#7fbc41"</span>, <span class="st">"#de77ae"</span>)) <span class="sc">+</span></span>
<span id="cb35-1667"><a href="#cb35-1667" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb35-1668"><a href="#cb35-1668" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-1669"><a href="#cb35-1669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1672"><a href="#cb35-1672" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-1673"><a href="#cb35-1673" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: haulout</span></span>
<span id="cb35-1674"><a href="#cb35-1674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1675"><a href="#cb35-1675" aria-hidden="true" tabindex="-1"></a>breed_haulout <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(</span>
<span id="cb35-1676"><a href="#cb35-1676" aria-hidden="true" tabindex="-1"></a>  <span class="st">"%i - %i"</span>, </span>
<span id="cb35-1677"><a href="#cb35-1677" aria-hidden="true" tabindex="-1"></a>  <span class="fu">quantile</span>(sealdat<span class="sc">$</span>breeddur[sealdat<span class="sc">$</span>observed_int <span class="sc">==</span> <span class="dv">1</span>], <span class="fl">0.25</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb35-1678"><a href="#cb35-1678" aria-hidden="true" tabindex="-1"></a>  <span class="fu">quantile</span>(sealdat<span class="sc">$</span>breeddur[sealdat<span class="sc">$</span>observed_int <span class="sc">==</span> <span class="dv">1</span>], <span class="fl">0.75</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb35-1679"><a href="#cb35-1679" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-1680"><a href="#cb35-1680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1681"><a href="#cb35-1681" aria-hidden="true" tabindex="-1"></a>non_breed_haulout <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(</span>
<span id="cb35-1682"><a href="#cb35-1682" aria-hidden="true" tabindex="-1"></a>  <span class="st">"%i - %i"</span>, </span>
<span id="cb35-1683"><a href="#cb35-1683" aria-hidden="true" tabindex="-1"></a>  <span class="fu">quantile</span>(sealdat<span class="sc">$</span>breeddur[sealdat<span class="sc">$</span>observed_int <span class="sc">==</span> <span class="dv">0</span>], <span class="fl">0.25</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb35-1684"><a href="#cb35-1684" aria-hidden="true" tabindex="-1"></a>  <span class="fu">quantile</span>(sealdat<span class="sc">$</span>breeddur[sealdat<span class="sc">$</span>observed_int <span class="sc">==</span> <span class="dv">0</span>], <span class="fl">0.75</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb35-1685"><a href="#cb35-1685" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-1686"><a href="#cb35-1686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1687"><a href="#cb35-1687" aria-hidden="true" tabindex="-1"></a>resight_by_observed <span class="ot">&lt;-</span> resight <span class="sc">%&gt;%</span> </span>
<span id="cb35-1688"><a href="#cb35-1688" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">animalID =</span> <span class="fu">as.character</span>(animalID)) <span class="sc">%&gt;%</span> </span>
<span id="cb35-1689"><a href="#cb35-1689" aria-hidden="true" tabindex="-1"></a>  <span class="fu">right_join</span>(<span class="fu">select</span>(sealdat, animalID, year, observed_int), </span>
<span id="cb35-1690"><a href="#cb35-1690" aria-hidden="true" tabindex="-1"></a>             <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"animalID"</span>, <span class="at">season =</span> <span class="st">"year"</span>),</span>
<span id="cb35-1691"><a href="#cb35-1691" aria-hidden="true" tabindex="-1"></a>             <span class="at">relationship =</span> <span class="st">"many-to-many"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-1692"><a href="#cb35-1692" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(animalID, season, observed_int) <span class="sc">%&gt;%</span> </span>
<span id="cb35-1693"><a href="#cb35-1693" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(observed_int) <span class="sc">%&gt;%</span> </span>
<span id="cb35-1694"><a href="#cb35-1694" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n_q1 =</span> <span class="fu">quantile</span>(n, <span class="fl">0.25</span>), </span>
<span id="cb35-1695"><a href="#cb35-1695" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_mean =</span> <span class="fu">mean</span>(n), </span>
<span id="cb35-1696"><a href="#cb35-1696" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_q3 =</span> <span class="fu">quantile</span>(n, <span class="fl">0.75</span>))</span>
<span id="cb35-1697"><a href="#cb35-1697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1698"><a href="#cb35-1698" aria-hidden="true" tabindex="-1"></a>breed_resight <span class="ot">&lt;-</span> <span class="fu">with</span>(resight_by_observed[<span class="dv">2</span>, ],</span>
<span id="cb35-1699"><a href="#cb35-1699" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">sprintf</span>(<span class="st">"%0.1f (%i - %i)"</span>, n_mean, n_q1, n_q3))</span>
<span id="cb35-1700"><a href="#cb35-1700" aria-hidden="true" tabindex="-1"></a>nonbreed_resight <span class="ot">&lt;-</span> <span class="fu">with</span>(resight_by_observed[<span class="dv">1</span>, ],</span>
<span id="cb35-1701"><a href="#cb35-1701" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">sprintf</span>(<span class="st">"%0.1f (%i - %i)"</span>, n_mean, n_q1, n_q3))</span>
<span id="cb35-1702"><a href="#cb35-1702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1703"><a href="#cb35-1703" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-1704"><a href="#cb35-1704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1705"><a href="#cb35-1705" aria-hidden="true" tabindex="-1"></a>The pattern of unobserved animals decreasing with age means it is highly unlikely our inferences about reproductive senescence are due to partial detection.</span>
<span id="cb35-1706"><a href="#cb35-1706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1707"><a href="#cb35-1707" aria-hidden="true" tabindex="-1"></a>Among the animals in this study, breeders hauled out for longer than non-breeders (1st - 3rd quartile: breeders <span class="in">`r breed_haulout`</span> days; non-breeders <span class="in">`r non_breed_haulout`</span> days). This extended period of time on the beach makes them more accessible to observers. Furthermore, northern elephant seals exhibit a high degree of site fidelity. Once they recruit to a breeding colony, temporary emigration is rare. Breeding animals were resighted <span class="in">`r breed_resight`</span> times per year, compared to <span class="in">`r nonbreed_resight`</span> for non-breeders (mean, 1st - 3rd quartile), which suggests that breeders are more readily observable than non-breeders.</span>
<span id="cb35-1708"><a href="#cb35-1708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1709"><a href="#cb35-1709" aria-hidden="true" tabindex="-1"></a><span class="fu">## Breakpoint vs quadratic</span></span>
<span id="cb35-1710"><a href="#cb35-1710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1711"><a href="#cb35-1711" aria-hidden="true" tabindex="-1"></a><span class="fu">### H1: Reproductive senescence</span></span>
<span id="cb35-1712"><a href="#cb35-1712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1715"><a href="#cb35-1715" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-1716"><a href="#cb35-1716" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: quad-h1</span></span>
<span id="cb35-1717"><a href="#cb35-1717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1718"><a href="#cb35-1718" aria-hidden="true" tabindex="-1"></a>breed_age_quad <span class="ot">&lt;-</span> <span class="fu">glmer</span>(</span>
<span id="cb35-1719"><a href="#cb35-1719" aria-hidden="true" tabindex="-1"></a>  observed_int <span class="sc">~</span> <span class="fu">poly</span>(age10, <span class="dv">2</span>, <span class="at">raw =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> animalID) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> year_fct),</span>
<span id="cb35-1720"><a href="#cb35-1720" aria-hidden="true" tabindex="-1"></a>  sealdat,</span>
<span id="cb35-1721"><a href="#cb35-1721" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="st">"binomial"</span>,</span>
<span id="cb35-1722"><a href="#cb35-1722" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">glmerControl</span>(<span class="at">optimizer =</span> <span class="st">"bobyqa"</span>)</span>
<span id="cb35-1723"><a href="#cb35-1723" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-1724"><a href="#cb35-1724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1725"><a href="#cb35-1725" aria-hidden="true" tabindex="-1"></a>h1_age10_peak <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">summary</span>(breed_age_quad)<span class="sc">$</span>coefficients[<span class="dv">2</span>, <span class="dv">1</span>] <span class="sc">/</span> </span>
<span id="cb35-1726"><a href="#cb35-1726" aria-hidden="true" tabindex="-1"></a>  (<span class="dv">2</span> <span class="sc">*</span> <span class="fu">summary</span>(breed_age_quad)<span class="sc">$</span>coefficients[<span class="dv">3</span>, <span class="dv">1</span>])</span>
<span id="cb35-1727"><a href="#cb35-1727" aria-hidden="true" tabindex="-1"></a>h1_age_peak <span class="ot">&lt;-</span> h1_age10_peak <span class="sc">*</span> <span class="dv">10</span> <span class="sc">+</span> age_senesce</span>
<span id="cb35-1728"><a href="#cb35-1728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1729"><a href="#cb35-1729" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(breed_age_quad)<span class="sc">$</span>coefficients</span>
<span id="cb35-1730"><a href="#cb35-1730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1731"><a href="#cb35-1731" aria-hidden="true" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">"Age peak (H1) = %0.1f"</span>, h1_age_peak)</span>
<span id="cb35-1732"><a href="#cb35-1732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1733"><a href="#cb35-1733" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-1734"><a href="#cb35-1734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1735"><a href="#cb35-1735" aria-hidden="true" tabindex="-1"></a><span class="fu">### H2: Maternal effect senescence</span></span>
<span id="cb35-1736"><a href="#cb35-1736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1739"><a href="#cb35-1739" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-1740"><a href="#cb35-1740" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: quad-h2</span></span>
<span id="cb35-1741"><a href="#cb35-1741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1742"><a href="#cb35-1742" aria-hidden="true" tabindex="-1"></a><span class="co"># H2a</span></span>
<span id="cb35-1743"><a href="#cb35-1743" aria-hidden="true" tabindex="-1"></a>surv_age_quad <span class="ot">&lt;-</span> <span class="fu">glmer</span>(</span>
<span id="cb35-1744"><a href="#cb35-1744" aria-hidden="true" tabindex="-1"></a>  pup_surv_int <span class="sc">~</span> <span class="fu">poly</span>(age10, <span class="dv">2</span>, <span class="at">raw =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> animalID) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> year_fct),</span>
<span id="cb35-1745"><a href="#cb35-1745" aria-hidden="true" tabindex="-1"></a>  surv_recr_data,</span>
<span id="cb35-1746"><a href="#cb35-1746" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="st">"binomial"</span>,</span>
<span id="cb35-1747"><a href="#cb35-1747" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">glmerControl</span>(<span class="at">optimizer =</span> <span class="st">"bobyqa"</span>)</span>
<span id="cb35-1748"><a href="#cb35-1748" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-1749"><a href="#cb35-1749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1750"><a href="#cb35-1750" aria-hidden="true" tabindex="-1"></a>h2a_age10_peak <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">summary</span>(surv_age_quad)<span class="sc">$</span>coefficients[<span class="dv">2</span>, <span class="dv">1</span>] <span class="sc">/</span> </span>
<span id="cb35-1751"><a href="#cb35-1751" aria-hidden="true" tabindex="-1"></a>  (<span class="dv">2</span> <span class="sc">*</span> <span class="fu">summary</span>(surv_age_quad)<span class="sc">$</span>coefficients[<span class="dv">3</span>, <span class="dv">1</span>])</span>
<span id="cb35-1752"><a href="#cb35-1752" aria-hidden="true" tabindex="-1"></a>h2a_age_peak <span class="ot">&lt;-</span> h2a_age10_peak <span class="sc">*</span> <span class="dv">10</span> <span class="sc">+</span> age_senesce</span>
<span id="cb35-1753"><a href="#cb35-1753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1754"><a href="#cb35-1754" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(surv_age_quad)<span class="sc">$</span>coefficients</span>
<span id="cb35-1755"><a href="#cb35-1755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1756"><a href="#cb35-1756" aria-hidden="true" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">"Age peak (H2a) = %0.1f"</span>, h2a_age_peak)</span>
<span id="cb35-1757"><a href="#cb35-1757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1758"><a href="#cb35-1758" aria-hidden="true" tabindex="-1"></a><span class="co"># H2b</span></span>
<span id="cb35-1759"><a href="#cb35-1759" aria-hidden="true" tabindex="-1"></a>recr_age_quad <span class="ot">&lt;-</span> <span class="fu">glmer</span>(</span>
<span id="cb35-1760"><a href="#cb35-1760" aria-hidden="true" tabindex="-1"></a>  pup_recr_int <span class="sc">~</span> <span class="fu">poly</span>(age10, <span class="dv">2</span>, <span class="at">raw =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> year_fct),</span>
<span id="cb35-1761"><a href="#cb35-1761" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(surv_recr_data, pupsex <span class="sc">==</span> <span class="st">"F"</span>),</span>
<span id="cb35-1762"><a href="#cb35-1762" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="st">"binomial"</span>,</span>
<span id="cb35-1763"><a href="#cb35-1763" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">glmerControl</span>(<span class="at">optimizer =</span> <span class="st">"bobyqa"</span>)</span>
<span id="cb35-1764"><a href="#cb35-1764" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-1765"><a href="#cb35-1765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1766"><a href="#cb35-1766" aria-hidden="true" tabindex="-1"></a>h2b_age10_peak <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">summary</span>(recr_age_quad)<span class="sc">$</span>coefficients[<span class="dv">2</span>, <span class="dv">1</span>] <span class="sc">/</span> </span>
<span id="cb35-1767"><a href="#cb35-1767" aria-hidden="true" tabindex="-1"></a>  (<span class="dv">2</span> <span class="sc">*</span> <span class="fu">summary</span>(recr_age_quad)<span class="sc">$</span>coefficients[<span class="dv">3</span>, <span class="dv">1</span>])</span>
<span id="cb35-1768"><a href="#cb35-1768" aria-hidden="true" tabindex="-1"></a>h2b_age_peak <span class="ot">&lt;-</span> h2b_age10_peak <span class="sc">*</span> <span class="dv">10</span> <span class="sc">+</span> age_senesce</span>
<span id="cb35-1769"><a href="#cb35-1769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1770"><a href="#cb35-1770" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(recr_age_quad)<span class="sc">$</span>coefficients</span>
<span id="cb35-1771"><a href="#cb35-1771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1772"><a href="#cb35-1772" aria-hidden="true" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">"Age peak (H2b) = %0.1f"</span>, h2b_age_peak)</span>
<span id="cb35-1773"><a href="#cb35-1773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1774"><a href="#cb35-1774" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-1775"><a href="#cb35-1775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1776"><a href="#cb35-1776" aria-hidden="true" tabindex="-1"></a><span class="fu">### AIC Comparison</span></span>
<span id="cb35-1777"><a href="#cb35-1777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1780"><a href="#cb35-1780" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-1781"><a href="#cb35-1781" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: quad-aic</span></span>
<span id="cb35-1782"><a href="#cb35-1782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1783"><a href="#cb35-1783" aria-hidden="true" tabindex="-1"></a>aic <span class="ot">&lt;-</span> <span class="cf">function</span>(break_mod, quad_mod, hyp) {</span>
<span id="cb35-1784"><a href="#cb35-1784" aria-hidden="true" tabindex="-1"></a>  <span class="fu">AIC</span>(break_mod, quad_mod) <span class="sc">%&gt;%</span> </span>
<span id="cb35-1785"><a href="#cb35-1785" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb35-1786"><a href="#cb35-1786" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">dAIC =</span> AIC <span class="sc">-</span> <span class="fu">min</span>(AIC),</span>
<span id="cb35-1787"><a href="#cb35-1787" aria-hidden="true" tabindex="-1"></a>         <span class="at">rellik =</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.5</span> <span class="sc">*</span> dAIC),</span>
<span id="cb35-1788"><a href="#cb35-1788" aria-hidden="true" tabindex="-1"></a>         <span class="at">weight =</span> rellik <span class="sc">/</span> <span class="fu">sum</span>(rellik),</span>
<span id="cb35-1789"><a href="#cb35-1789" aria-hidden="true" tabindex="-1"></a>         <span class="at">hypothesis =</span> hyp,</span>
<span id="cb35-1790"><a href="#cb35-1790" aria-hidden="true" tabindex="-1"></a>         <span class="at">model =</span> <span class="fu">c</span>(<span class="st">"Breakpoint"</span>, <span class="st">"Quadratic"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb35-1791"><a href="#cb35-1791" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(hypothesis, model, AIC, weight)</span>
<span id="cb35-1792"><a href="#cb35-1792" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-1793"><a href="#cb35-1793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1794"><a href="#cb35-1794" aria-hidden="true" tabindex="-1"></a><span class="fu">pmap</span>(<span class="fu">list</span>(<span class="at">break_mod =</span> <span class="fu">list</span>(breed_age_mod, pup_surv_mod, pup_recr_mod),</span>
<span id="cb35-1795"><a href="#cb35-1795" aria-hidden="true" tabindex="-1"></a>          <span class="at">quad_mod =</span> <span class="fu">list</span>(breed_age_quad, surv_age_quad, recr_age_quad),</span>
<span id="cb35-1796"><a href="#cb35-1796" aria-hidden="true" tabindex="-1"></a>          <span class="at">hyp =</span> <span class="fu">c</span>(<span class="st">"H1"</span>, <span class="st">"H2a"</span>, <span class="st">"H2b"</span>)),</span>
<span id="cb35-1797"><a href="#cb35-1797" aria-hidden="true" tabindex="-1"></a>     aic) <span class="sc">%&gt;%</span> </span>
<span id="cb35-1798"><a href="#cb35-1798" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list_rbind</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb35-1799"><a href="#cb35-1799" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span>
<span id="cb35-1800"><a href="#cb35-1800" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-1801"><a href="#cb35-1801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1802"><a href="#cb35-1802" aria-hidden="true" tabindex="-1"></a><span class="fu">## Nursing duration</span></span>
<span id="cb35-1803"><a href="#cb35-1803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1804"><a href="#cb35-1804" aria-hidden="true" tabindex="-1"></a>What's the mean and 95% CI duration of nursing? <span class="co">[</span><span class="ot">@reiter1981</span><span class="co">]</span> provide the following information in Table III:</span>
<span id="cb35-1805"><a href="#cb35-1805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1806"><a href="#cb35-1806" aria-hidden="true" tabindex="-1"></a>+-------+----------+----------+----------+----------+----------+----------+----------+</span>
<span id="cb35-1807"><a href="#cb35-1807" aria-hidden="true" tabindex="-1"></a>| 2     | 3        | 4        | 5        | 6        | 7        | 8        | 9        |</span>
<span id="cb35-1808"><a href="#cb35-1808" aria-hidden="true" tabindex="-1"></a>+=======+==========+==========+==========+==========+==========+==========+==========+</span>
<span id="cb35-1809"><a href="#cb35-1809" aria-hidden="true" tabindex="-1"></a>| 22±0  | 23.7±1.6 | 26.6±1.6 | 26.1±1.9 | 26.5±2.2 | 27.1±1.2 | 28.2±0.8 | 28.5±0.7 |</span>
<span id="cb35-1810"><a href="#cb35-1810" aria-hidden="true" tabindex="-1"></a>|       |          |          |          |          |          |          |          |</span>
<span id="cb35-1811"><a href="#cb35-1811" aria-hidden="true" tabindex="-1"></a>| <span class="sc">\(</span>1<span class="sc">\)</span> | <span class="sc">\(</span>9<span class="sc">\)</span>    | <span class="sc">\(</span>24<span class="sc">\)</span>   | <span class="sc">\(</span>12<span class="sc">\)</span>   | <span class="sc">\(</span>6<span class="sc">\)</span>    | <span class="sc">\(</span>8<span class="sc">\)</span>    | <span class="sc">\(</span>5<span class="sc">\)</span>    | <span class="sc">\(</span>2<span class="sc">\)</span>    |</span>
<span id="cb35-1812"><a href="#cb35-1812" aria-hidden="true" tabindex="-1"></a>+-------+----------+----------+----------+----------+----------+----------+----------+</span>
<span id="cb35-1813"><a href="#cb35-1813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1814"><a href="#cb35-1814" aria-hidden="true" tabindex="-1"></a>Where the column names are the age of the seal in years, and row values indicate mean±SD (n). To get the mean and 95% CI duration of nursing, we pooled the samples for mothers age 4 and up (i.e., excluded 2- and 3-year olds).</span>
<span id="cb35-1815"><a href="#cb35-1815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1816"><a href="#cb35-1816" aria-hidden="true" tabindex="-1"></a>The formulas we used for pooling the variances come from <span class="co">[</span><span class="ot">@oneill2014</span><span class="co">]</span>.</span>
<span id="cb35-1817"><a href="#cb35-1817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1820"><a href="#cb35-1820" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-1821"><a href="#cb35-1821" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: pooled-nursing</span></span>
<span id="cb35-1822"><a href="#cb35-1822" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1823"><a href="#cb35-1823" aria-hidden="true" tabindex="-1"></a><span class="co"># N, mean, and SD from Reiter et al. (1981) Table III for 4+ yo mothers</span></span>
<span id="cb35-1824"><a href="#cb35-1824" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">24</span>, <span class="dv">12</span>, <span class="dv">6</span>, <span class="dv">8</span>, <span class="dv">5</span>, <span class="dv">2</span>)</span>
<span id="cb35-1825"><a href="#cb35-1825" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">26.6</span>, <span class="fl">26.1</span>, <span class="fl">26.5</span>, <span class="fl">27.1</span>, <span class="fl">28.2</span>, <span class="fl">28.5</span>)</span>
<span id="cb35-1826"><a href="#cb35-1826" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">1.6</span>, <span class="fl">1.9</span>, <span class="fl">2.2</span>, <span class="fl">1.2</span>, <span class="fl">0.8</span>, <span class="fl">0.7</span>)</span>
<span id="cb35-1827"><a href="#cb35-1827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1828"><a href="#cb35-1828" aria-hidden="true" tabindex="-1"></a><span class="co"># Function for pooling two samples</span></span>
<span id="cb35-1829"><a href="#cb35-1829" aria-hidden="true" tabindex="-1"></a>pool_samples <span class="ot">&lt;-</span> <span class="cf">function</span>(sample1, sample2) {</span>
<span id="cb35-1830"><a href="#cb35-1830" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sample1 and sample2 must be numeric vectors of length 3 with names v, m, and n</span></span>
<span id="cb35-1831"><a href="#cb35-1831" aria-hidden="true" tabindex="-1"></a>  is_valid <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb35-1832"><a href="#cb35-1832" aria-hidden="true" tabindex="-1"></a>    <span class="fu">is.numeric</span>(x) <span class="sc">&amp;&amp;</span></span>
<span id="cb35-1833"><a href="#cb35-1833" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.vector</span>(x) <span class="sc">&amp;&amp;</span></span>
<span id="cb35-1834"><a href="#cb35-1834" aria-hidden="true" tabindex="-1"></a>      (<span class="fu">length</span>(x) <span class="sc">==</span> <span class="dv">3</span>) <span class="sc">&amp;&amp;</span></span>
<span id="cb35-1835"><a href="#cb35-1835" aria-hidden="true" tabindex="-1"></a>      <span class="fu">all</span>(<span class="fu">c</span>(<span class="st">"v"</span>, <span class="st">"m"</span>, <span class="st">"n"</span>) <span class="sc">%in%</span> <span class="fu">names</span>(x))</span>
<span id="cb35-1836"><a href="#cb35-1836" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb35-1837"><a href="#cb35-1837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1838"><a href="#cb35-1838" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span>(<span class="fu">is_valid</span>(sample1) <span class="sc">&amp;&amp;</span> <span class="fu">is_valid</span>(sample2))) </span>
<span id="cb35-1839"><a href="#cb35-1839" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"sample1 and sample2 must be numeric vectors of length 3 with names v, m, and n (variance, mean, and number of elements)"</span>)</span>
<span id="cb35-1840"><a href="#cb35-1840" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-1841"><a href="#cb35-1841" aria-hidden="true" tabindex="-1"></a>  v1 <span class="ot">&lt;-</span> sample1[<span class="st">"v"</span>]</span>
<span id="cb35-1842"><a href="#cb35-1842" aria-hidden="true" tabindex="-1"></a>  m1 <span class="ot">&lt;-</span> sample1[<span class="st">"m"</span>]</span>
<span id="cb35-1843"><a href="#cb35-1843" aria-hidden="true" tabindex="-1"></a>  n1 <span class="ot">&lt;-</span> sample1[<span class="st">"n"</span>]</span>
<span id="cb35-1844"><a href="#cb35-1844" aria-hidden="true" tabindex="-1"></a>  v2 <span class="ot">&lt;-</span> sample2[<span class="st">"v"</span>]</span>
<span id="cb35-1845"><a href="#cb35-1845" aria-hidden="true" tabindex="-1"></a>  m2 <span class="ot">&lt;-</span> sample2[<span class="st">"m"</span>]</span>
<span id="cb35-1846"><a href="#cb35-1846" aria-hidden="true" tabindex="-1"></a>  n2 <span class="ot">&lt;-</span> sample2[<span class="st">"n"</span>]</span>
<span id="cb35-1847"><a href="#cb35-1847" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-1848"><a href="#cb35-1848" aria-hidden="true" tabindex="-1"></a>  n3 <span class="ot">&lt;-</span> n1 <span class="sc">+</span> n2</span>
<span id="cb35-1849"><a href="#cb35-1849" aria-hidden="true" tabindex="-1"></a>  m3 <span class="ot">&lt;-</span> <span class="fu">weighted.mean</span>(<span class="fu">c</span>(m1, m2), <span class="fu">c</span>(n1, n2))</span>
<span id="cb35-1850"><a href="#cb35-1850" aria-hidden="true" tabindex="-1"></a>  v3 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> (n1 <span class="sc">+</span> n2 <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> ((n1 <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> v1 <span class="sc">+</span> (n2 <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> v2 <span class="sc">+</span> n1 <span class="sc">*</span> n2 <span class="sc">/</span> (n1 <span class="sc">+</span> n2) <span class="sc">*</span> (m1 <span class="sc">-</span> m2)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb35-1851"><a href="#cb35-1851" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">c</span>(v3, m3, n3)</span>
<span id="cb35-1852"><a href="#cb35-1852" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(result) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"v"</span>, <span class="st">"m"</span>, <span class="st">"n"</span>)</span>
<span id="cb35-1853"><a href="#cb35-1853" aria-hidden="true" tabindex="-1"></a>  result</span>
<span id="cb35-1854"><a href="#cb35-1854" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-1855"><a href="#cb35-1855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1856"><a href="#cb35-1856" aria-hidden="true" tabindex="-1"></a><span class="co"># Pool the samples iteratively using reduction</span></span>
<span id="cb35-1857"><a href="#cb35-1857" aria-hidden="true" tabindex="-1"></a>samples <span class="ot">&lt;-</span> <span class="fu">pmap</span>(<span class="fu">list</span>(n, m, s), \(.n, .m, .s) <span class="fu">c</span>(<span class="at">v =</span> .s<span class="sc">^</span><span class="dv">2</span>, <span class="at">m =</span> .m, <span class="at">n =</span> .n))</span>
<span id="cb35-1858"><a href="#cb35-1858" aria-hidden="true" tabindex="-1"></a>pooled_samples <span class="ot">&lt;-</span> <span class="fu">reduce</span>(samples, pool_samples)</span>
<span id="cb35-1859"><a href="#cb35-1859" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1860"><a href="#cb35-1860" aria-hidden="true" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">"%0.1f (95%%CI: %0.1f - %0.1f)"</span>, </span>
<span id="cb35-1861"><a href="#cb35-1861" aria-hidden="true" tabindex="-1"></a>        pooled_samples[<span class="st">"m"</span>],</span>
<span id="cb35-1862"><a href="#cb35-1862" aria-hidden="true" tabindex="-1"></a>        pooled_samples[<span class="st">"m"</span>] <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> <span class="fu">sqrt</span>(pooled_samples[<span class="st">"v"</span>]),</span>
<span id="cb35-1863"><a href="#cb35-1863" aria-hidden="true" tabindex="-1"></a>        pooled_samples[<span class="st">"m"</span>] <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> <span class="fu">sqrt</span>(pooled_samples[<span class="st">"v"</span>]))</span>
<span id="cb35-1864"><a href="#cb35-1864" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-1865"><a href="#cb35-1865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1866"><a href="#cb35-1866" aria-hidden="true" tabindex="-1"></a><span class="fu">## Population dynamics</span></span>
<span id="cb35-1867"><a href="#cb35-1867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1868"><a href="#cb35-1868" aria-hidden="true" tabindex="-1"></a>What effect does senescence have on reproduction and offspring survival? First, calculate the total pup production of the age-structured population in one year. Then, let's pretend senescence *doesn't happen*. In this hypothetical population, all animals older than 11 years old reproduce like an 11 year old. How many more pups would that population produce? And how many more of those pups would survive to reproductive age?</span>
<span id="cb35-1869"><a href="#cb35-1869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1870"><a href="#cb35-1870" aria-hidden="true" tabindex="-1"></a>The observed pup production (in the age-structured population) is:</span>
<span id="cb35-1871"><a href="#cb35-1871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1872"><a href="#cb35-1872" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb35-1873"><a href="#cb35-1873" aria-hidden="true" tabindex="-1"></a>\pi_{1a} = \frac{\sum_{a=4}^{20} b_a n_a}{\sum_{a=4}^{20} n_a}</span>
<span id="cb35-1874"><a href="#cb35-1874" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb35-1875"><a href="#cb35-1875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1876"><a href="#cb35-1876" aria-hidden="true" tabindex="-1"></a>Where $\pi_1$ is pup production per mother per year by the age-structured population. $a$ is age, $b$ is estimated breeding percentage, and $n$ is the number of mothers in that age class.</span>
<span id="cb35-1877"><a href="#cb35-1877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1878"><a href="#cb35-1878" aria-hidden="true" tabindex="-1"></a>Hypothetical pup production in a non-senescing population is:</span>
<span id="cb35-1879"><a href="#cb35-1879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1880"><a href="#cb35-1880" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb35-1881"><a href="#cb35-1881" aria-hidden="true" tabindex="-1"></a>\pi_{2a} = \frac{\sum_{a=4}^{11} b_a n_a + \sum_{a=12}^{20} b_{11} n_a}{\sum_{a=4}^{20}n_a}</span>
<span id="cb35-1882"><a href="#cb35-1882" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb35-1883"><a href="#cb35-1883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1884"><a href="#cb35-1884" aria-hidden="true" tabindex="-1"></a>I.e., $b$ does not decline post-age 11.</span>
<span id="cb35-1885"><a href="#cb35-1885" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1886"><a href="#cb35-1886" aria-hidden="true" tabindex="-1"></a>Similarly, the observed and hypothetical quantity of pups that survive to adulthood adds a term $s$ for offspring survival.</span>
<span id="cb35-1887"><a href="#cb35-1887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1888"><a href="#cb35-1888" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb35-1889"><a href="#cb35-1889" aria-hidden="true" tabindex="-1"></a>\pi_{1b} = \frac{\sum_{a=4}^{20} b_a n_a s_a}{\sum_{a=4}^{20} n_a}</span>
<span id="cb35-1890"><a href="#cb35-1890" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb35-1891"><a href="#cb35-1891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1892"><a href="#cb35-1892" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb35-1893"><a href="#cb35-1893" aria-hidden="true" tabindex="-1"></a>\pi_{2b} = \frac{\sum_{a=4}^{11} b_a n_a s_a + \sum_{a=12}^{20} b_{11} n_a s_{11}}{\sum_{a=4}^{20} n_a}</span>
<span id="cb35-1894"><a href="#cb35-1894" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb35-1895"><a href="#cb35-1895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1898"><a href="#cb35-1898" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-1899"><a href="#cb35-1899" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: popdy</span></span>
<span id="cb35-1900"><a href="#cb35-1900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1901"><a href="#cb35-1901" aria-hidden="true" tabindex="-1"></a><span class="co"># a, b, n, and s </span></span>
<span id="cb35-1902"><a href="#cb35-1902" aria-hidden="true" tabindex="-1"></a>popdy_df <span class="ot">&lt;-</span> <span class="fu">count</span>(sealdat, age) <span class="sc">%&gt;%</span> </span>
<span id="cb35-1903"><a href="#cb35-1903" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(age <span class="sc">&lt;=</span> <span class="dv">20</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-1904"><a href="#cb35-1904" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age10 =</span> (age <span class="sc">-</span> age_senesce) <span class="sc">/</span> <span class="dv">10</span>,</span>
<span id="cb35-1905"><a href="#cb35-1905" aria-hidden="true" tabindex="-1"></a>         <span class="at">age_cat =</span> <span class="fu">factor</span>(age <span class="sc">&gt;=</span> age_senesce, </span>
<span id="cb35-1906"><a href="#cb35-1906" aria-hidden="true" tabindex="-1"></a>                          <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Young"</span>, <span class="st">"Old"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb35-1907"><a href="#cb35-1907" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">b =</span> <span class="fu">predict</span>(breed_age_mod, <span class="at">newdata =</span> ., <span class="at">re.form =</span> <span class="cn">NA</span>, <span class="at">type =</span> <span class="st">"response"</span>),</span>
<span id="cb35-1908"><a href="#cb35-1908" aria-hidden="true" tabindex="-1"></a>         <span class="at">s =</span> <span class="fu">predict</span>(pup_surv_mod, <span class="at">newdata =</span> ., <span class="at">re.form =</span> <span class="cn">NA</span>, <span class="at">type =</span> <span class="st">"response"</span>))</span>
<span id="cb35-1909"><a href="#cb35-1909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1910"><a href="#cb35-1910" aria-hidden="true" tabindex="-1"></a><span class="co"># pup production (pi1a and pi2a)</span></span>
<span id="cb35-1911"><a href="#cb35-1911" aria-hidden="true" tabindex="-1"></a>pi1a <span class="ot">&lt;-</span> <span class="fu">with</span>(popdy_df, <span class="fu">sum</span>(b <span class="sc">*</span> n) <span class="sc">/</span> <span class="fu">sum</span>(n)) </span>
<span id="cb35-1912"><a href="#cb35-1912" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1913"><a href="#cb35-1913" aria-hidden="true" tabindex="-1"></a>b11 <span class="ot">&lt;-</span> popdy_df<span class="sc">$</span>b[popdy_df<span class="sc">$</span>age <span class="sc">==</span> <span class="dv">11</span>]</span>
<span id="cb35-1914"><a href="#cb35-1914" aria-hidden="true" tabindex="-1"></a>pi2a <span class="ot">&lt;-</span> <span class="fu">with</span>(popdy_df, <span class="fu">sum</span>(<span class="fu">ifelse</span>(age <span class="sc">&gt;</span> <span class="dv">11</span>, b11, b) <span class="sc">*</span> n) <span class="sc">/</span> <span class="fu">sum</span>(n))</span>
<span id="cb35-1915"><a href="#cb35-1915" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1916"><a href="#cb35-1916" aria-hidden="true" tabindex="-1"></a><span class="co"># Survivng offspring (pi1b and pi2b)</span></span>
<span id="cb35-1917"><a href="#cb35-1917" aria-hidden="true" tabindex="-1"></a>pi1b <span class="ot">&lt;-</span> <span class="fu">with</span>(popdy_df, <span class="fu">sum</span>(b <span class="sc">*</span> n <span class="sc">*</span> s) <span class="sc">/</span> <span class="fu">sum</span>(n))</span>
<span id="cb35-1918"><a href="#cb35-1918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1919"><a href="#cb35-1919" aria-hidden="true" tabindex="-1"></a>s11 <span class="ot">&lt;-</span> popdy_df<span class="sc">$</span>s[popdy_df<span class="sc">$</span>age <span class="sc">==</span> <span class="dv">11</span>]</span>
<span id="cb35-1920"><a href="#cb35-1920" aria-hidden="true" tabindex="-1"></a>pi2b <span class="ot">&lt;-</span> <span class="fu">with</span>(popdy_df, <span class="fu">sum</span>(<span class="fu">ifelse</span>(age <span class="sc">&gt;</span> <span class="dv">11</span>, b11 <span class="sc">*</span> s11, b <span class="sc">*</span> s) <span class="sc">*</span> n) <span class="sc">/</span> <span class="fu">sum</span>(n))</span>
<span id="cb35-1921"><a href="#cb35-1921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1922"><a href="#cb35-1922" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1923"><a href="#cb35-1923" aria-hidden="true" tabindex="-1"></a><span class="fu">str_glue</span>(<span class="st">"</span></span>
<span id="cb35-1924"><a href="#cb35-1924" aria-hidden="true" tabindex="-1"></a><span class="st">pi1a: {round(pi1a, 5)}</span></span>
<span id="cb35-1925"><a href="#cb35-1925" aria-hidden="true" tabindex="-1"></a><span class="st">pi2a: {round(pi2a, 5)}</span></span>
<span id="cb35-1926"><a href="#cb35-1926" aria-hidden="true" tabindex="-1"></a><span class="st">pi1b: {round(pi1b, 5)}</span></span>
<span id="cb35-1927"><a href="#cb35-1927" aria-hidden="true" tabindex="-1"></a><span class="st">pi2b: {round(pi2b, 5)}"</span>)</span>
<span id="cb35-1928"><a href="#cb35-1928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1929"><a href="#cb35-1929" aria-hidden="true" tabindex="-1"></a><span class="fu">str_glue</span>(<span class="st">"</span></span>
<span id="cb35-1930"><a href="#cb35-1930" aria-hidden="true" tabindex="-1"></a><span class="st">delta pi a {round(100 * (pi1a - pi2a) / pi2a, 2)}%,</span></span>
<span id="cb35-1931"><a href="#cb35-1931" aria-hidden="true" tabindex="-1"></a><span class="st">delta pi b {round(100 * (pi1b - pi2b) / pi2b, 2)}%"</span>)</span>
<span id="cb35-1932"><a href="#cb35-1932" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>